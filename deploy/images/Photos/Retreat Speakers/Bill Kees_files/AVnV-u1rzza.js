/*1349661912,173214271*/

if (window.CavalryLogger) { CavalryLogger.start_js(["NLJAb"]); }

__d("legacy:UIControllerRegistry",[],function(a,b,c,d){a.__UIControllerRegistry=a.__UIControllerRegistry||{};},3);
__d("Popover",["event-extensions","Arbiter","ArbiterMixin","ContextualLayer","ContextualLayerHideOnScroll","CSS","DataStore","DOM","Input","KeyStatus","LayerHideOnEscape","Toggler","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ContextualLayer'),j=b('ContextualLayerHideOnScroll'),k=b('CSS'),l=b('DataStore'),m=b('DOM'),n=b('Input'),o=b('KeyStatus'),p=b('LayerHideOnEscape'),q=b('Toggler'),r=b('copyProperties');q.subscribe(['show','hide'],function(t,u){var v=l.get(u.getActive(),'Popover');if(v)if(t==='show'){v.showLayer();}else v.hideLayer();});function s(t,u,v,w){this._root=t;this._triggerElem=u;this._behaviors=v;this._config=w;if(!(u.nodeName==='A'&&u.rel==='toggle'))Event.listen(u,'click',function(){q.bootstrap(u);});u.setAttribute('role','button');l.set(t,'Popover',this);}r(s.prototype,h,{_layer:null,_closeListener:null,ensureInit:function(){if(!this._layer)this._init();},showLayer:function(){this.ensureInit();this._layer.show();q.show(this._root);k.addClass(this._root,'selected');this.inform('show');this._triggerElem.setAttribute('aria-expanded','true');},getLayer:function(){return this._layer;},hideLayer:function(){this._layer.hide();this._triggerElem.setAttribute('aria-expanded','false');},isShown:function(){return this._layer.isShown();},setLayerContent:function(t){this.ensureInit();this._layer.setContent(t);},_init:function(){var t=new i({context:this._triggerElem,position:'below'},m.create('div'));t.enableBehaviors([j,p]);q.createInstance(t.getRoot()).setSticky(false);t.subscribe('hide',this._onLayerHide.bind(this));this._behaviors&&t.enableBehaviors(this._behaviors);this._layer=t;if(this._config.alignh)this._layer.setAlignment(this._config.alignh);if(this._config.layer_content)this._layer.setContent(this._config.layer_content);this.inform('init',null,g.BEHAVIOR_PERSISTENT);},_onLayerHide:function(){q.hide(this._root);k.removeClass(this._root,'selected');this.inform('hide');if(o.isKeyDown())n.focus(this._triggerElem);}});e.exports=s;});
__d("AudienceSelector",["Arbiter","CSS","DOM","DynamicIconSelector","PrivacyConst","Selector","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('DynamicIconSelector'),k=b('PrivacyConst'),l=b('Selector'),m=b('copyProperties');l.subscribe('select',function(p,q){if(!h.hasClass(q.selector,'audienceSelector'))return;var r=l.getOptionValue(q.option);g.inform('AudienceSelector/changed',q);if(r==k.BaseValue.CUSTOM&&!h.hasClass(q.option,'noDialog')){l.toggle(q.selector);return false;}if(h.hasClass(q.selector,'dataTooltip')){var s=i.find(q.option,'.itemAnchor').getAttribute('data-tooltip');l.setButtonTooltip(q.selector,s||null);}if(!h.hasClass(q.option,'specialOption'))return;var t=i.find(q.option,'a').getAttribute('data-type');if(h.hasClass(q.option,'moreOption')){h.addClass(q.selector,t);h.addClass(q.selector,'showSecondaryOptions');return false;}else if(h.hasClass(q.option,'returnOption')){h.removeClass(q.selector,'showSecondaryOptions');h.removeClass(q.selector,'friendList');return false;}});var n={},o={hasTags:function(p){return n.hasOwnProperty(p);},setHasTags:function(p){if(!p)return;n[p]=true;}};g.subscribe('CustomPrivacyOption/update',function(p,q){if(!h.hasClass(q.selector,'audienceSelector'))return;l.setSelected(q.selector,l.getOptionValue(q.option));j.swapIcon(q.selector);l.setButtonTooltip(q.selector,q.tooltip);g.inform('AudienceSelector/update',q.selector);});e.exports=o;});
__d("legacy:ScrollAwareDOM",["ScrollAwareDOM"],function(a,b,c,d){a.ScrollAwareDOM=b('ScrollAwareDOM');},3);
__d("DynamicIconSelector",["Button","CSS","DOM","Selector"],function(a,b,c,d,e,f){var g=b('Button'),h=b('CSS'),i=b('DOM'),j=b('Selector'),k={swapIcon:function(l){var m=j.getSelectedOptions(l)[0],n=m&&i.scry(m,'.itemIcon')[0],o=j.getSelectorButton(l);if(n){g.setIcon(o,n.cloneNode(true));}else{var p=i.scry(o,'.img')[0];p&&i.remove(p);}h.conditionClass(o,'uiSelectorChevronOnly',!n);}};j.subscribe('change',function(l,m){var n=m.selector;if(h.hasClass(n,'dynamicIconSelector'))k.swapIcon(n);});e.exports=k;});
__d("PopoverMenuInterface",["Arbiter","ArbiterMixin","Class","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('copyProperties'),k=b('emptyFunction');function l(){}j(l.prototype,h,{getRoot:k,onShow:k,onHide:k,focusAnItem:k.thatReturnsFalse,blur:k,handleKeydown:k.thatReturnsFalse,done:function(){this.inform('done');}});e.exports=l;});
__d("MenuX",["event-extensions","Class","copyProperties","CSS","DataStore","DOM","HTML","Keys","Parent","PopoverMenuInterface","ScrollableArea","Style","UserAgent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Class'),h=b('copyProperties'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('HTML'),m=b('Keys'),n=b('Parent'),o=b('PopoverMenuInterface'),p=b('ScrollableArea'),q=b('Style'),r=b('UserAgent');function s(t,u,v,w){this.parent.construct(this);this._id=t;this._className=u;this._items=[];for(var x=0;x<v.length;x++)this._items[x]=new v[x].ctor(v[x]);this._config=w;}g.extend(s,o);h(s.prototype,{_focused:null,_root:null,addItem:function(t){this._items.push(t);if(this._root)this._insertItem(t);},getRoot:function(){if(!this._root)this._render();return this._root;},onShow:function(){if(this._config.maxheight)if(!this._scrollableArea){q.set(this._scrollableElems.root,'width',this._scrollableElems.body.offsetWidth+'px');this._scrollableArea=p.fromNative(this._scrollableElems.root,{fade:true});q.set(this._scrollableElems.wrap,'max-height',this._config.maxheight+'px');}else{q.set(this._scrollableElems.root,'width','');q.set(this._scrollableElems.content,'width','');if(r.ie()<=7){q.set(this._scrollableElems.root,'width',this._scrollableElems.content.offsetWidth+'px');}else q.set(this._scrollableElems.root,'width',this._scrollableElems.content.offsetWidth+'px');this._scrollableArea.resize();}},onHide:function(){this.blur();},focusAnItem:function(){return this._attemptFocus(0,1);},blur:function(){if(this._focused){this._focused.blur();this._focused=null;this.inform('blur');}},handleKeydown:function(t){var u=this._items.indexOf(this._focused);switch(t){case m.UP:case m.DOWN:var v=t===m.UP?-1:1;if(u!==-1){return this._attemptFocus(u+v,v);}else if(t===m.UP){return this._attemptFocus(this._items.length-1,-1);}else return this._attemptFocus(0,1);break;case m.SPACE:if(this._items.indexOf(this._focused)!==-1){this._handleItemClick(this._focused);return true;}return false;default:var w=String.fromCharCode(t).toLowerCase(),x;for(var y=u+1;y<this._items.length;y++){x=this._items[y].getAccessKey();if(x&&x.charAt(0).toLowerCase()===w)if(this._focusItem(this._items[y]))return true;}return false;}},_render:function(){this._ul=k.create('ul',{className:'uiMenuX'});this._ul.setAttribute('role','menu');this._items.forEach(this._insertItem.bind(this));Event.listen(this._ul,'click',this._handleClick.bind(this));Event.listen(this._ul,'mouseover',this._handleMouseOver.bind(this));Event.listen(this._ul,'mouseout',this._handleMouseOut.bind(this));var t=this._ul;if(this._config.maxheight){this._scrollableElems=p.renderDOM();k.setContent(this._scrollableElems.content,this._ul);t=this._scrollableElems.root;}var u='uiMenuXWrapper'+(this._className?' '+this._className:'');this._root=k.create('div',{className:u},k.create('div',{className:'uiMenuXBorder'},t));this._id&&this._root.setAttribute('id',this._id);},_handleClick:function(t){var u=this._getItemInstance(t.getTarget());if(u)return this._handleItemClick(u);},_handleItemClick:function(t){this.inform('itemclick',t);if(t.hasAction())this.done();return t.handleClick();},_handleMouseOver:function(t){var u=this._getItemInstance(t.getTarget());u&&this._focusItem(u);},_handleMouseOut:function(t){var u=this._getItemInstance(t.getTarget());if(u&&this._focused===u)this.blur();},_insertItem:function(t){var u=t.getRoot();i.addClass(u,'__MenuXItem');j.set(u,'MenuXItem',t);k.appendContent(this._ul,u);},_attemptFocus:function(t,u){var v=this._items[t];if(v)if(this._focusItem(v)){return true;}else return this._attemptFocus(t+u,u);return false;},_focusItem:function(t){if(t.focus()!==false){if(this._focused!==t){this.blur();this._focused=t;this.inform('focus');}return true;}return false;},_getItemInstance:function(t){var u=n.byClass(t,'__MenuXItem');return u?j.get(u,'MenuXItem'):null;}});e.exports=s;});
__d("MenuXSelectableItem",["Class","copyProperties","CSS","MenuXItem"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('CSS'),j=b('MenuXItem');function k(l){this.parent.construct(this,l);}g.extend(k,j);h(k.prototype,{_selected:false,getLabel:function(){return this._data.label;},getIcon:function(){return this._data.icon;},isSelected:function(){return this._selected;},select:function(){i.addClass(this._root,'checked');this._selected=true;},deselect:function(){i.removeClass(this._root,'checked');this._selected=false;},render:function(){var l=this.parent.render();if(this._data.selected){i.addClass(l,'checked');this._selected=true;}return l;}});e.exports=k;});
__d("PopoverMenu",["event-extensions","Arbiter","ArbiterMixin","ARIA","BehaviorsMixin","Class","Input","Keys","KeyStatus","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ARIA'),j=b('BehaviorsMixin'),k=b('Class'),l=b('Input'),m=b('Keys'),n=b('KeyStatus'),o=b('copyProperties');function p(q,r,s,t){this._popover=q;this._triggerElem=r;this._initialMenu=s;q.subscribe('init',this._onLayerInit.bind(this));q.subscribe('show',this._onPopoverShow.bind(this));q.subscribe('hide',this._onPopoverHide.bind(this));t&&this.enableBehaviors(t);}o(p.prototype,h,j);o(p.prototype,{_popoverShown:false,setMenu:function(q){this._menu=q;var r=q.getRoot();this._popover.setLayerContent(r);q.subscribe('done',this._onMenuDone.bind(this));if(this._popoverShown)this._menu.onShow();i.owns(this._triggerElem,r);this.inform('setMenu',null,g.BEHAVIOR_PERSISTENT);},getPopover:function(){return this._popover;},getTriggerElem:function(){return this._triggerElem;},getMenu:function(){return this._menu;},_onLayerInit:function(){this.setMenu(this._initialMenu);this._popover.getLayer().subscribe('key',this._handleKeyEvent.bind(this));},_onPopoverShow:function(){if(this._menu){this._menu.onShow();if(n.isKeyDown())this._menu.focusAnItem();}this._popoverShown=true;},_onPopoverHide:function(){if(this._menu)this._menu.onHide();this._popoverShown=false;},_handleKeyEvent:function(q,r){var s=Event.getKeyCode(r);switch(s){case m.RETURN:return;case m.UP:case m.DOWN:this._menu.handleKeydown(s);break;default:if(this._menu.handleKeydown(s)===false){this._menu.blur();this._menu.handleKeydown(s);}break;}r.prevent();},_onMenuDone:function(q){this._popover.hideLayer.bind(this._popover).defer();if(n.isKeyDown())l.focus(this._triggerElem);}});e.exports=p;});
__d("PopoverMenuOverlappingBorder",["function-extensions","CSS","DOM","Style","copyProperties"],function(a,b,c,d,e,f){b('function-extensions');var g=b('CSS'),h=b('DOM'),i=b('Style'),j=b('copyProperties');function k(l){this._popoverMenu=l;this._popover=l.getPopover();this._triggerElem=l.getTriggerElem();}j(k.prototype,{_shortBorder:null,_setMenuSubscription:null,_showSubscription:null,_menuSubscription:null,enable:function(){this._setMenuSubscription=this._popoverMenu.subscribe('setMenu',this._onSetMenu.bind(this));},disable:function(){this._popoverMenu.unsubscribe(this._setMenuSubscription);this._setMenuSubscription=null;this._removeBorderSubscriptions();this._removeShortBorder();},_onSetMenu:function(){this._removeBorderSubscriptions();this._menu=this._popoverMenu.getMenu();this._renderShortBorder(this._menu.getRoot());this._showSubscription=this._popover.subscribe('show',this._updateBorder.bind(this));this._menuSubscription=this._menu.subscribe(['change','resize'],Function.prototype.defer.shield(this._updateBorder.bind(this)));this._updateBorder();},_updateBorder:function(){var l=this._menu.getRoot(),m=this._triggerElem.offsetWidth;i.set(l,'min-width',m+'px');var n=Math.max(l.offsetWidth-m,0);i.set(this._shortBorder,'width',n+'px');},_renderShortBorder:function(l){this._shortBorder=h.create('div',{className:'uiMenuXShortBorder'});h.appendContent(l,this._shortBorder);g.addClass(l,'uiMenuXWithShortBorder');},_removeShortBorder:function(){if(this._shortBorder){h.remove(this._shortBorder);this._shortBorder=null;g.removeClass(this._popoverMenu.getMenu().getRoot(),'uiMenuXShortBorder');}},_removeBorderSubscriptions:function(){if(this._showSubscription){this._popover.unsubscribe(this._showSubscription);this._showSubscription=null;}if(this._menuSubscription){this._menu.unsubscribe(this._menuSubscription);this._menuSubscription=null;}}});e.exports=k;});
__d("PrivacyConst",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h={FRIENDS_MINUS_ACQUAINTANCES:127,FACEBOOK_EMPLOYEES:112,CUSTOM:111,EVERYONE:80,NETWORKS_FRIENDS_OF_FRIENDS:60,NETWORKS_FRIENDS:55,FRIENDS_OF_FRIENDS:50,ALL_FRIENDS:40,SELF:10,NOBODY:0},i={EVERYONE:80,NETWORKS_FRIENDS:55,FRIENDS_OF_FRIENDS:50,ALL_FRIENDS:40,SOME_FRIENDS:30,SELF:10,NO_FRIENDS:0},j={BaseValue:h,FriendsValue:i};e.exports=j;});
__d("TypeaheadAreaCore",["Class","InputSelection","TypeaheadCore","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Class'),h=b('InputSelection'),i=b('TypeaheadCore'),j=b('copyProperties'),k=b('emptyFunction');function l(m){this.parent.construct(this,m);this.matcher=new RegExp(this.matcher+'$');this.preventFocusChangeOnTab=true;}g.extend(l,i);j(l.prototype,{prefix:'',suffix:', ',matcher:"\\b[^,]*",click:k,select:function(m){this.parent.select(m);var n=this.element.value,o=this.prefix+m.text+this.suffix;this.expandBounds(n,o);var p=n.substring(0,this.start),q=n.substring(this.end);this.element.value=p+o+q;h.set(this.element,p.length+o.length);},expandBounds:function(m,n){m=m.toLowerCase().trim();n=n.toLowerCase();var o,p,q,r,s=/\s/;p=m.substring(this.start,this.end);q=n.indexOf(p);o=this.start;while(o>=0&&q>=0){r=m.charAt(o-1);if(!r||s.test(r))this.start=o;p=r+p;q=n.indexOf(p);o--;}p=m.substring(this.start,this.end);q=n.indexOf(p);o=this.end;while(o<=m.length&&q>=0){r=m.charAt(o);if(!r||s.test(r))this.end=o;p=p+r;q=n.indexOf(p);o++;}},getRawValue:function(){var m=h.get(this.element).start||0;return this.parent.getValue().substring(0,m);},getValue:function(){var m=this.matcher&&this.matcher.exec(this.getRawValue());if(!m)return '';var n=m[0],o=m.index+n.length;n=n.replace(/^\s/,'');var p=n.length;n=n.replace(/\s$/,'');var q=p-n.length;this.start=o-p;this.end=o+q;return m[1]||m[0];}});e.exports=l;});
__d("AsyncUploadBase",["ArbiterMixin","AsyncRequest","AsyncResponse","Form","UserAgent","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('AsyncResponse'),j=b('Form'),k=b('UserAgent'),l=b('copyProperties');function m(o){this.setURI(o);}m.isSupported=function(){if(k.safari()&&!k.chrome()&&k.windows())return false;return ('FileList' in window)&&('FormData' in window);};l(m.prototype,g,{_limit:10,setAllowCrossOrigin:function(o){this._allowCrossOrigin=!!o;return this;},setData:function(o){this._data=o;return this;},setLimit:function(o){this._limit=o;return this;},setRelativeTo:function(o){this._relativeTo=o;return this;},setStatusElement:function(o){this._statusElement=o;return this;},setURI:function(o){this._uri=o;return this;},_createFileUpload:function(o,p,q){return new n(o,p,q);},_parseFiles:function(o){var p={};for(var q in o){var r=o[q];if(Array.isArray(r)){p[q]=r;}else{p[q]=[];if(r instanceof window.FileList){for(var s=0;s<r.length;s++)p[q].push(r.item(s));}else if(r instanceof window.File||r instanceof window.Blob)p[q].push(r);}}return p;},_processQueue:function(){while(this._pending.length<this._limit){if(!this._waiting.length)break;var o=this._waiting.shift();this._processUpload(o);this._pending.push(o);}},_processUpload:function(o){this.inform('start',o);var p=j.createFormData(o.getData()||this._data);if(o.getFile())p.append(o.getName(),o.getFile());new h().setAllowCrossOrigin(this._allowCrossOrigin).setURI(this._uri).setRawData(p).setRelativeTo(this._relativeTo).setStatusElement(this._statusElement).setHandler(this._success.bind(this,o)).setErrorHandler(this._failure.bind(this,o)).setUploadProgressHandler(this._progress.bind(this,o)).setInitialHandler(this._initial.bind(this,o)).send();},_initial:function(o){this.inform('initial',o);},_success:function(o,p){this.inform('success',o.handleSuccess(p));this._complete(o);},_failure:function(o,p){if(this.inform('failure',o.handleFailure(p))!==false)i.defaultErrorHandler(p);this._complete(o);},_progress:function(o,event){this.inform('progress',o.handleProgress(event));},_complete:function(o){this._pending.remove(o);this._processQueue();if(!this._pending.length)this._inFlight=false;}});var n=function(o,p,q){this._name=o;this._file=p;this._data=q;this._success=null;this._response=null;this._progressEvent=null;};l(n.prototype,{getName:function(){return this._name;},getFile:function(){return this._file;},getData:function(){return this._data;},isComplete:function(){return this._success!==null;},isSuccess:function(){return this._success===true;},getResponse:function(){return this._response;},getProgressEvent:function(){return this._progressEvent;},handleSuccess:function(o){this._success=true;this._response=o;this._progressEvent=null;return this;},handleFailure:function(o){this._success=false;this._response=o;this._progressEvent=null;return this;},handleProgress:function(event){this._progressEvent=event;return this;}});e.exports=m;});
__d("AsyncUploadRequest",["AsyncUploadBase","Class","copyProperties"],function(a,b,c,d,e,f){var g=b('AsyncUploadBase'),h=b('Class'),i=b('copyProperties');function j(k){this.parent.construct(this,k);}j.isSupported=function(){return g.isSupported();};h.extend(j,g);i(j.prototype,{setFiles:function(k){this._files=this._parseFiles(k);return this;},send:function(){if(this._inFlight)return;this._inFlight=true;this._uploads=[];for(var k in this._files)this._files[k].forEach(function(l){this._uploads.push(this._createFileUpload(k,l));}.bind(this));if(this._uploads.length){this._waiting=this._uploads.slice(0);this._pending=[];this._processQueue();}else this._processUpload(this._createFileUpload(null,null));},_complete:function(k){this.parent._complete(k);if(!this._pending.length)this.inform('complete',this._uploads);}});e.exports=j;});
__d("FileForm",["event-extensions","ArbiterMixin","AsyncRequest","AsyncUploadRequest","AsyncResponse","BehaviorsMixin","DataStore","DOMQuery","Env","Form","JSONPTransport","Parent","URI","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('AsyncUploadRequest'),j=b('AsyncResponse'),k=b('BehaviorsMixin'),l=b('DataStore'),m=b('DOMQuery'),n=b('Env'),o=b('Form'),p=b('JSONPTransport'),q=b('Parent'),r=b('URI'),s=b('copyProperties');function t(v){var w={},x=m.scry(v,'input[type="file"]');x.forEach(function(y){w[y.name]=y.files;});return w;}function u(v,w,x){if(v.getAttribute('rel')==='async')throw new Error('FileForm cannot be used with Primer forms.');if(v.getAttribute('method').toUpperCase()!=='POST')throw new Error('FileForm must be used with POST forms.');this._form=v;this._previousEncoding=this._form.enctype;this._form.enctype=this._form.encoding='multipart/form-data';w&&this.enableBehaviors(w);this._options=x||{};this.setAllowCrossOrigin(this._options.allowCrossOrigin);this.setUploadInParallel(this._options.uploadInParallel);this._listener=Event.listen(this._form,'submit',this._submit.bind(this));l.set(this._form,'FileForm',this);}s(u,{EVENTS:['submit','initial','progress','success','failure'],getInstance:function(v){return l.get(v,'FileForm');}});s(u.prototype,g,k,{getRoot:function(){return this._form;},setAllowCrossOrigin:function(v){this._allowCrossOrigin=!!v;return this;},setUploadInParallel:function(v){this._uploadInParallel=!!v;return this;},_submit:function(event){if(this.inform('submit')===false){event.prevent();return;}var v='FormData' in window;if(v)if(!r(this._form.action).isSameOrigin()&&!this._allowCrossOrigin){emptyFunction('Attempted to submit a FileForm via XHR to a different domain '+'without explicitly allowing cross-domain requests; falling back '+'to iframe transport. See: http://fburl.com/cors');v=false;}return v?this._sendViaXHR(event):this._sendViaFrame(event);},_sendViaFrame:function(event){var v=this._request=new h();v.setStatusElement(this._getStatusElement());v.addStatusIndicator();v.setOption('useIframeTransport',true);var w=v.handleResponse.bind(v),x=new p('iframe',this._form.action,w),y=x.getTransportFrame(),z=x.getRequestURI().addQueryData({__iframe:true,__user:n.user});this._form.setAttribute('action',z.toString());this._form.setAttribute('target',y.name);v.setJSONPTransport(x);v.setURI(z);v.setHandler(this.success.bind(this,null));v.setErrorHandler(this.failure.bind(this,null));v.setInitialHandler(this.initial.shield(this,null));},_sendViaXHR:function(event){var v;if(this._uploadInParallel&&i.isSupported()){v=new i().setData(o.serialize(this._form)).setFiles(t(this._form));var w=[v.subscribe('progress',function(x,y){this.progress(y,y.getProgressEvent());}.bind(this)),v.subscribe('initial',function(x,y){this.initial(y,y.getResponse());}.bind(this)),v.subscribe('success',function(x,y){this.success(y,y.getResponse());}.bind(this)),v.subscribe('failure',function(x,y){this.failure(y,y.getResponse());return false;}.bind(this)),v.subscribe('complete',function(){while(w.length)w.pop().unsubscribe();})];}else v=new h().setRawData(o.createFormData(this._form)).setHandler(this.success.bind(this,null)).setErrorHandler(this.failure.bind(this,null)).setUploadProgressHandler(this.progress.bind(this,null)).setInitialHandler(this.initial.shield(this,null));v.setAllowCrossOrigin(this._allowCrossOrigin).setRelativeTo(this._form).setStatusElement(this._getStatusElement()).setURI(this._form.action).send();this._request=v;event.prevent();},initial:function(v){return this.inform('initial',{upload:v});},success:function(v,w){var x={response:w,upload:v};if(this.inform('success',x)!==false)Event.fire(this._form,'success',x);this._cleanup();},failure:function(v,w){var x={response:w,upload:v};if(this.inform('failure',x)!==false)if(Event.fire(this._form,'error',x)!==false)j.defaultErrorHandler(w);this._cleanup();},progress:function(v,event){this.inform('progress',{event:event,upload:v});},abort:function(){if(this._request){this._request.abort();this._cleanup();}},destroy:function(){this._cleanup();this._listener.remove();this._listener=null;this._form.enctype=this._form.encoding=this._previousEncoding;l.remove(this._form,'FileForm');},_cleanup:function(){this._request=null;},_getStatusElement:function(){return q.byClass(this._form,'stat_elem')||this._form;}});e.exports=u;});
__d("PopoverAsyncMenuLoading",["Class","copyProperties","DOM","PopoverMenuInterface"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('DOM'),j=b('PopoverMenuInterface');function k(l){this.parent.construct(this);this._className=l||'';}g.extend(k,j);h(k.prototype,{_root:null,getRoot:function(){if(!this._root)this._root=i.create('div',{className:this._className},i.create('div',{className:'uiMenuXBorder'},i.create('div',{className:'uiMenuX uiMenuXLoading'},i.create('span',{className:'spinner'}))));return this._root;}});e.exports=k;});
__d("PopoverAsyncMenu",["event-extensions","AsyncRequest","Class","CSS","DOM","PopoverAsyncMenuLoading","PopoverMenu","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h=b('Class'),i=b('CSS'),j=b('DOM'),k=b('PopoverAsyncMenuLoading'),l=b('PopoverMenu'),m=b('copyProperties'),n={},o=0;function p(q,r,s,t,u){this._endpoint=t;this._loadingMenu=s;this._instanceId=o++;n[this._instanceId]=this;this._mouseoverListener=Event.listen(r,'mouseover',this._fetchMenu.bind(this));this.parent.construct(this,q,r,null,u);}p.setMenu=function(q,r){n[q].setMenu(r);};h.extend(p,l);m(p.prototype,{_fetched:false,_mouseoverListener:null,_onLayerInit:function(){if(!this._menu)this.setMenu(this._loadingMenu);this._fetchMenu();},_fetchMenu:function(){if(this._fetched)return;new g().setURI(this._endpoint).setData({pmid:this._instanceId}).send();this._fetched=true;if(this._mouseoverListener){this._mouseoverListener.remove();this._mouseoverListener=null;}}});e.exports=p;});
__d("UFIUpdate",["CommentPrelude","CSS","DOM","DOMQuery","HTML","MentionsInput","Parent","ScrollableArea","ScrollAwareDOM"],function(a,b,c,d,e,f){var g=b('CommentPrelude'),h=b('CSS'),i=b('DOM'),j=b('DOMQuery'),k=b('HTML'),l=b('MentionsInput'),m=b('Parent'),n=b('ScrollableArea'),o=b('ScrollAwareDOM'),p={expandFeedback:function(q,r,s){i.scry(q,r).forEach(function(t){g.expand(t,s);});},uncollapseFeedback:function(q){g.uncollapse(m.byTag(i.find(q,'.fbUfi'),'form'));},multiContentReplaceGlobal:function(q,r){this.multiContentReplace(document.documentElement,q,r);},multiContentReplace:function(q,r,s){s=s instanceof k?s.getRootNode():s;i.scry(q,r).forEach(function(t){o.replace(t,s.cloneNode(true));});},refocusCommentBox:function(q,r){var s=i.find(q,'textarea');s.value=s.style.height="";if(r){s.blur();s.focus.defer();}else document.documentElement.onfocusin({target:s});},resetMentionsInput:function(q){var r=l.getInstance(i.find(q,'div.uiMentionsInput'));r&&r.reset();},insertAtBottom:function(q,r,s,t){var u=i.scry(q,'.comment_'+s).length;if(r)u+=i.scry(q,'#'+r).length;if(!u){var v=i.find(q,'.commentList'),w=n.getInstance(v),x=w&&w.isScrolledToBottom();o.appendContent(v,t);x&&w.scrollToBottom(false);}},updateUnsubscribeLink:function(q,r){var s=i.scry(q,'.unsub_link')[0];if(s){i.replace(s,r);}else if(r)i.insertAfter(i.find(q,'.comment_link'),[" \xB7 ",r]);},updateSeenCount:function(q){j.scry(q,'.uiUfiSeenBar').forEach(function(t){h.hide(t);});j.scry(q,'.uiUfiViewSeenCount').forEach(function(t){h.hide(t);});var r=j.scry(q,'.uiUfiLike')[0];if(r&&r.childNodes.length===0)r=null;r=r||j.scry(q,'.uiUfiSeenBar')[0];if(!r)return;var s=j.scry(r,'.uiUfiViewSeenCount')[0];if(!s)return;h.show(s);h.show(r);}};e.exports=p;});
__d("TypeaheadMetrics",["event-extensions","AsyncRequest","Typeahead","copyProperties","emptyFunction"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h=b('Typeahead'),i=b('copyProperties'),j=b('emptyFunction');function k(l){this.extraData={};i(this,l);}i(k.prototype,{endPoint:'/ajax/typeahead/record_basic_metrics.php',init:function(l){this.init=j;this.core=l.getCore();this.view=l.getView();this.data=l.getData();this.stats={};this.sessionActive=false;this._sessionStartEvents=[];this._sessionEndEvents=[];this._reset();this.initEvents();},_reset:function(){this.stats={};this.avgStats={};this.sessionActive=false;this.sid=Math.floor(Date.now()*Math.random());this.data.setQueryData({sid:this.sid});},recordSelect:function(l){var m=l.selected;if(m.uid==null){this.recordStat('selected_id','SELECT_NULL');}else this.recordStat('selected_id',m.uid);this.recordStat('selected_type',m.type);this.recordStat('selected_position',l.index);this.recordStat('selected_with_mouse',l.clicked?1:0);this._sessionEnd();},bindSessionStart:function(l,event,m){if(m)for(var n=0;n<this._sessionStartEvents.length;++n){var o=this._sessionStartEvents[n];o.obj.unsubscribe(o.token);}this._sessionStartEvents.push({obj:l,token:l.subscribe(event,function(p,q){this._sessionStart();}.bind(this))});},bindSessionEnd:function(l,event,m){if(m)for(var n=0;n<this._sessionEndEvents.length;++n){var o=this._sessionEndEvents[n];o.obj.unsubscribe(o.token);}this._sessionEndEvents.push({obj:l,token:l.subscribe(event,function(p,q){this._sessionEnd();}.bind(this))});},initEvents:function(){this.bindSessionStart(this.core,'focus',false);this.bindSessionEnd(this.core,'blur',false);this.view.subscribe('select',function(l,m){this.recordSelect(m);}.bind(this));this.bindSessionEnd(this.view,'select',false);this.view.subscribe('render',function(l,m){this.results=m;}.bind(this));this.data.subscribe('beforeQuery',function(l,m){if(!m.value)return;this.query=m.value;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('beforeFetch',function(l,m){if(m.fetch_context.bootstrap){this.bootstrapBegin=Date.now();}else m.fetch_context.queryBegin=Date.now();}.bind(this));this.data.subscribe('fetchComplete',function(l,m){if(m.fetch_context.bootstrap){this.recordAvgStat('bootstrap_latency',Date.now()-this.bootstrapBegin);var n={};m.response.payload.entries.forEach(function(o){if(!n[o.type]){n[o.type]=1;}else n[o.type]++;});this.recordStat('bootstrap_response_types',n);this.bootstrapped=true;}else this.recordAvgStat('avg_query_latency',Date.now()-m.fetch_context.queryBegin);}.bind(this));this.data.subscribe('dirty',function(l,m){this.bootstrapped=false;});},_sessionStart:function(){if(this.sessionActive)return;this.sessionActive=true;},_sessionEnd:function(){if(!this.sessionActive)return;this.sessionActive=false;this.submit();this._reset();},recordStat:function(l,m){this.stats[l]=m;},recordCountStat:function(l){var m=this.stats[l];this.stats[l]=m?m+1:1;},recordAvgStat:function(l,m){if(this.avgStats[l]){this.avgStats[l][0]+=m;++this.avgStats[l][1];}else this.avgStats[l]=[m,1];},submit:function(){if(Object.keys(this.stats).length){i(this.stats,this.extraData);if(this.results){var l=(this.results).map(function(o,p){return o.uid;});this.recordStat('candidate_results',JSON.stringify(l));}if(this.query)this.recordStat('query',this.query);if(this.sid)this.recordStat('sid',this.sid);if(this.bootstrapped)this.recordStat('bootstrapped',1);for(var m in this.avgStats){var n=this.avgStats[m];this.stats[m]=n[0]/n[1];}new g().setURI(this.endPoint).setMethod('POST').setData({stats:this.stats}).send();this._reset();}}});k.register=function(l,m,n){if(document.activeElement===l){m.init(n);}else var o=Event.listen(l,'focus',function(){m.init(n);o.remove();});};e.exports=k;});
__d("TypeaheadHoistFriends",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._typeahead=i;}g(h.prototype,{_subscription:null,enable:function(){var i=this._typeahead.getView();this._subscription=i.subscribe('beforeRender',function(j,k){var l=[],m=[];for(var n=0;n<k.results.length;++n){var o=k.results[n];if(o.type=='user'&&o.bootstrapped){m.push(o);}else l.push(o);}k.results=m.concat(l);});},disable:function(){this._typeahead.getView().unsubscribe(this._subscription);this._subscription=null;}});e.exports=h;});
__d("legacy:HoistFriendsTypeaheadBehavior",["TypeaheadHoistFriends"],function(a,b,c,d){var e=b('TypeaheadHoistFriends');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.hoistFriends=function(f){f.enableBehavior(e);};},3);
__d("MentionsInputMatchers",[],function(a,b,c,d,e,f){var g=['@','\\uff20','+','\\uff0b'].join(''),h='.,*?$|#{}()\\^\\-\\[\\]\\\\\/!%&\'"~=<>_:;',i='\\b[A-Z][^ A-Z'+h+']',j='([^'+g+h+']|['+h+'][^ '+h+'])',k='(?:^|\\s)(?:['+g+']('+j+'{0,20}))',l='(?:(?:'+i+'+)|'+k+')',m='(?:'+i+'{4,})',n={trigger:new RegExp('['+g+']$'),mainMatcher:new RegExp(k+'$'),autoMatcher:new RegExp(l+'$'),userMatcher:new RegExp(m+'$')};e.exports=n;});
__d("MentionsInput",["event-extensions","function-extensions","Arbiter","ArbiterMixin","Class","CSS","DataStore","DOM","HTML","Input","InputSelection","Parent","htmlize","Style","Typeahead","TypeaheadUtil","UserAgent","copyProperties","MentionsInputMatchers"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('HTML'),n=b('Input'),o=b('InputSelection'),p=b('Parent'),q=b('htmlize'),r=b('Style'),s=b('Typeahead'),t=b('TypeaheadUtil'),u=b('UserAgent'),v=b('copyProperties'),w=b('MentionsInputMatchers');function x(y,z,aa,ba,ca,da){k.set(y,'MentionsInput',this);this._root=y;this._typeahead=z;this._input=aa;var ea=false;try{ea=document.activeElement===this._input;}catch(fa){}if(ea){this.init.bind(this,ba,ca,da).defer();}else var ga=Event.listen(this._input,'focus',function(){this.init.bind(this,ba,ca,da).defer();ga.remove();}.bind(this));}x.getInstance=function(y){var z=p.byClass(y,'uiMentionsInput');return z?k.get(z,'MentionsInput'):null;};v(x.prototype,h,{init:function(y,z,aa){this.init=Function.prototype;this._initialized=true;this._highlighter=l.find(this._root,'.highlighter');this._highlighterInner=this._highlighter.firstChild;this._highlighterContent=l.find(this._root,'.highlighterContent');this._hiddenInput=l.find(this._root,'.mentionsHidden');this._placeholder=this._input.getAttribute('placeholder')||'';this._maxMentions=y.max||6;this._metrics=aa;if(u.firefox()<4){this._input.blur();setTimeout(function(){this._input.focus();}.bind(this));}if(!this._hiddenInput.name){var ba=this._input.name;this._input.name=ba+'_text';this._hiddenInput.name=ba;}this._initEvents();this._initTypeahead();this.reset(z);this.inform('init',null,g.BEHAVIOR_STATE);},reset:function(y){if(!this._initialized)return;this._mentioned={};this._orderedUIDs=[];this._numMentioned=0;this._filterData=null;this._hiddenInput&&(this._hiddenInput.value='');this._highlighterContent&&l.empty(this._highlighterContent);this._highlighterAuxContent&&l.remove(this._highlighterAuxContent);this._highlighterAuxContent=null;n.setPlaceholder(this._input,this._placeholder);r.set(this._typeahead.getElement(),'height','auto');if(y){n.setValue(this._input,y.flattened);for(var z in y.mention_data)this._addToken({uid:z,text:y.mention_data[z],type:'unknown'});}this._updateTypeahead();this._updateWidth();this._update();},getValue:function(){return n.getValue(this._input);},getRawValue:function(){this._update();return n.getValue(this._hiddenInput);},checkValue:function(){var y=this._typeahead.getCore().getValue();if(w.trigger.exec(y)||y==='')this.inform('sessionEnd',{});},getTypeahead:function(){return this._typeahead;},_initEvents:function(){var y=this._update.bind(this);Event.listen(this._input,{input:y,keyup:y,change:y,blur:this._handleBlur.bind(this),focus:this._handleFocus.bind(this)});if(this._metrics){this._metrics._reset();this._metrics.bindSessionStart(this._typeahead,'render',true);this._metrics.bindSessionEnd(this._typeahead.getView(),'select',true);this._metrics.bindSessionEnd(this,'sessionEnd',false);Event.listen(this._input,'keyup',function(event){this.checkValue.bind(this).defer();}.bind(this));}},_initTypeahead:function(){this._typeahead.subscribe('select',function(ca,da){var ea=da.selected;this._addToken({uid:ea.uid,text:ea.text,type:ea.type});this.updateValue();}.bind(this));var y=this._input,z=null,aa=function(){if(z===null){z=n.getSubmitOnEnter(y);n.setSubmitOnEnter(y,false);}},ba=function(){if(z!==null){n.setSubmitOnEnter(y,z);z=null;}};this._typeahead.subscribe('render',aa);this._typeahead.subscribe('reset',ba);this._typeahead.subscribe('highlight',function(ca,da){da.index>=0?aa():ba();});this._typeahead.subscribe('query',function(){this._filterData=null;}.bind(this));this._typeahead.getCore().suffix='';this._handleFocus();},_handleBlur:function(){if(this._filterToken){this._filterToken.remove();this._filterToken=null;}},_handleFocus:function(){if(!this._filterToken)this._filterToken=this._typeahead.getData().addFilter(this._filterResults.bind(this));this._updateWidth();},_filterResults:function(y){if(this._filterData===null){var z=o.get(this._input).start||0;for(var aa=0;aa<this._offsets.length;aa++){var ba=this._offsets[aa];if(z>ba[0]&&z<=ba[1]){this._filterData={caretIsInsideMention:true};return false;}}var ca=this._typeahead.getCore();this._filterData={value:ca.getValue(),rawValue:ca.getRawValue()};}if(this._filterData.caretIsInsideMention)return false;if(w.mainMatcher.test(this._filterData.rawValue))return true;if(y.type!='user')return false;if(w.userMatcher.test(this._filterData.value))return true;return t.isExactMatch(this._filterData.value,this._typeahead.getData().getTextToIndex(y));},_addToken:function(y){var z=y.uid;if(!this._mentioned.hasOwnProperty(z)){this._mentioned[z]=y;this._orderedUIDs.push(z);this._numMentioned++;this._updateTypeahead();}},_removeToken:function(y){if(this._mentioned.hasOwnProperty(y)){delete this._mentioned[y];this._orderedUIDs.remove(y);this._numMentioned--;this._updateTypeahead();}},_reduceToken:function(y,z){var aa=z.split(' '),ba=[];for(var ca=0;ca<aa.length;ca++)if(y.indexOf(aa[ca])!=-1)ba.push(aa[ca]);aa=ba;for(ca=1;ca<aa.length;ca++)for(var da=1;da<aa[ca-1].length+1;da++)if(y.indexOf(aa[ca-1].substr(0,da)+aa[ca])!=-1)aa.splice(ca-1,1);while(y.indexOf(aa.join(' '))==-1)aa.splice(0,1);return aa.join(' ');},_update:function(){var y=this.getValue();if(y==this._value)return;this._updateTokens();this.updateValue();this._updateDirection();},_updateTokens:function(){var y=this.getValue(),z=false;for(var aa=0;aa<this._orderedUIDs.length;++aa){var ba=this._orderedUIDs[aa],ca=this._mentioned[ba],da=ca.text,ea;if(ca.type=='user'&&(ea=this._reduceToken(y,da))!==''){if(ea==da.substring(0,da.lastIndexOf(' '))&&y==this._value.substring(0,this._value.length-1)){y=y.substring(0,y.lastIndexOf(' '));z=true;}ca.text=ea;}else if(!da||y.indexOf(da)==-1||typeof da!=='string')this._removeToken(ba);}this._value=y;if(z)n.setValue(this._input,y);},updateValue:function(){var y=this.getValue(),z=this._orderedUIDs,aa=[],ba,ca,da,ea;for(ea=0;ea<z.length;++ea){ca=this._mentioned[z[ea]].text;y=y.replace(ca,function(fa,ga){aa.push([ga,ga+ca.length]);return ca;});}for(ea=0;ea<z.length;++ea){da=z[ea];ca=this._mentioned[da].text;y=y.replace(ca,'@['+da+':]');}ba=q(y);for(ea=0;ea<z.length;++ea){da=z[ea];ca=this._mentioned[da].text;ba=ba.replace('@['+da+':]','<b>'+q(ca)+'</b>');ca=ca.replace(/[\\\]:]/g,function(fa){return '\\'+fa;});y=y.replace('@['+da+':]','@['+da+':'+ca+']');}if(u.ie()){ba=ba.replace(/ {2}/g,'&nbsp;<wbr />&nbsp;<wbr />');ba=ba.replace(/ (?=[^\/]|\/[^>])/g,'&nbsp;<wbr />');}this._offsets=aa;this._hiddenInput.value=y;l.setContent(this._highlighterContent,m(ba));this._updateHighlighter();this._updateHeight();},_updateDirection:function(){var y=r.get(this._input,'direction');if(y==this._dir)return;this._dir=y;r.set(this._highlighter,'direction',y);if(y=='rtl'){r.set(this._highlighter,'text-align','right');}else r.set(this._highlighter,'text-align','left');},_updateWidth:function(){var y=r.getFloat.curry(this._input),z=this._input.offsetWidth-y('paddingLeft')-y('paddingRight')-y('borderLeftWidth')-y('borderRightWidth');if(u.firefox())z-=2;if(u.ie()<=7){z-=r.getFloat(this._highlighterInner,'paddingLeft');this._highlighter.style.zoom=1;}this._highlighterInner.style.width=Math.max(z,0)+'px';},_updateHeight:function(){if(this._highlighterAuxContent){var y=this._highlighter.offsetHeight,z=this._typeahead.getElement();if(y>z.offsetHeight){r.set(z,'height',y+'px');g.inform('reflow');}}},_updateTypeahead:function(){var y=this._typeahead.getCore(),z=null;if(!this._maxMentions||this._numMentioned<this._maxMentions)z=w.autoMatcher;y.matcher=z;y.setExclusions(this._orderedUIDs);this.inform('update',{mentioned:this._mentioned});},setPlaceholder:function(y){this._placeholder=y;if(!this.hasAuxContent())n.setPlaceholder(this._input,y);},_updateHighlighter:function(){if(this._highlighterContent)j.conditionShow(this._highlighterContent,this._numMentioned>0||this.hasAuxContent());},setAuxContent:function(y){if(this._highlighterContent){if(!this._highlighterAuxContent){this._highlighterAuxContent=l.create('span',{className:'highlighterAuxContent'});l.insertAfter(this._highlighterContent,this._highlighterAuxContent);}l.setContent(this._highlighterAuxContent,y);if(y){n.setPlaceholder(this._input,'');}else n.setPlaceholder(this._input,this._placeholder);this._updateHighlighter();this._updateHeight();}},hasAuxContent:function(){var y=this.getAuxContentRoot();return y&&y.innerHTML.length>0;},getAuxContentRoot:function(){return this._highlighterAuxContent;},addMention:function(y){var z=this.getValue();n.setValue(this._input,z+" "+y.text);this._addToken(y);this._update();},getMentions:function(){return this._mentioned;}});e.exports=x;});
__d("legacy:MentionsInput",["MentionsInput"],function(a,b,c,d){a.MentionsInput=b('MentionsInput');},3);
__d("RequiredFormListener",["event-extensions","Input"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Input');Event.listen(document.documentElement,'submit',function(h){var i=h.getTarget().getElementsByTagName('*');for(var j=0;j<i.length;j++)if(i[j].getAttribute('required')&&g.isEmpty(i[j])){i[j].focus();return false;}},Event.Priority.URGENT);});
__d("legacy:AudienceSelector",["AudienceSelector"],function(a,b,c,d){b('AudienceSelector');},3);
__d("MentionsTypeaheadAreaView",["Class","ContextualTypeaheadView","Parent","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('ContextualTypeaheadView'),i=b('Parent'),j=b('copyProperties');function k(l,m){this.parent.construct(this,l,m);}g.extend(k,h);j(k.prototype,{getContext:function(){return i.byClass(this.element,'uiMentionsInput');}});e.exports=k;});
__d("ErrorDialog",["Dialog","emptyFunction"],function(a,b,c,d,e,f){var g=b('Dialog'),h=b('emptyFunction'),i={showAsyncError:function(j){try{return i.show(j.getErrorSummary(),j.getErrorDescription());}catch(k){alert(j);}},show:function(j,k,l,m){return (new g()).setTitle(j).setBody(k).setButtons([g.OK]).setStackable(true).setModal(true).setHandler(l||h).setButtonsMessage(m||'').show();}};e.exports=i;});