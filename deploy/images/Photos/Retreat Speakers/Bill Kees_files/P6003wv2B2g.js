/*1336802061,169776317*/

if (window.CavalryLogger) { CavalryLogger.start_js(["rPp7Y"]); }

__d("MusicDiagnosticLogger",["Arbiter","JSLogger","MusicConstants","MusicDiagnostics","MusicLogger","Run"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('JSLogger'),i=b('MusicConstants'),j=b('MusicDiagnostics'),k=b('MusicLogger'),l=b('Run'),m=h.create('music_diag'),n='attempt',o='success',p='invalidate',q='pending',r={INSTALL:'install',INSTALL_CANCEL:'install_canceled',LAUNCH:'launch',LAUNCH_CANCEL:'launch_canceled',PLAY:'play',PLAY_ALREADY:'play_already_open',PLAY_INSTALL:'play_install',TOS_SHOWN:'tos_shown',TOS_CANCEL:'tos_canceled',SWITCH_AWAY:'switched_away_from',INCORRECT_ONLINE_STATE:'incorrect_online_state'},s={},t={},u={},v={},w={},x={},y=false;function z(da,ea,fa){var ga=fa.provider;if(!x[ga])return;if(da==='user_action'){switch(fa.action){case j.TOS_SHOWN:aa(ga,r.TOS_SHOWN);break;case j.PLAY_SONG:w[ga]=q;if(t[ga]===q){aa(ga,r.PLAY_INSTALL,n);}else if(s[ga]===q){aa(ga,r.PLAY_ALREADY,n);}else aa(ga,r.PLAY,n);break;case i.DIAGNOSTIC_EVENT.SERVICE_ERROR:if(i.ERROR[fa.code]==='SERVICE_UNAVAILABLE_TECHNICAL_ISSUE')break;case j.TOS_CLICK_CANCEL:case j.INSTALL_CLICK_CANCEL:case j.LAUNCH_CLICK_CANCEL:case j.SWITCHED_PROVIDER:if(w[ga]===q){w[ga]=true;aa(ga,r.PLAY,p);}if(u[ga]===q){u[ga]=true;aa(ga,r.INSTALL,p);}if(fa.action===j.INSTALL_CLICK_CANCEL){aa(ga,r.INSTALL_CANCEL);}else if(fa.action===j.SWITCHED_PROVIDER){aa(ga,r.SWITCH_AWAY);}else if(fa.action===j.LAUNCH_CLICK_CANCEL){aa(ga,r.LAUNCH_CANCEL);}else if(fa.action===j.TOS_CLICK_CANCEL)aa(ga,r.TOS_CANCEL);case j.LAUNCH_NOT_NEEDED:if(v[ga]===q){v[ga]=true;aa(ga,r.LAUNCH,p);}if(fa.action===j.LAUNCH_NOT_NEEDED)s[ga]=q;break;case j.INSTALL_STARTED:t[ga]=q;u[ga]=q;aa(ga,r.INSTALL,n);break;case j.ATTEMPTING_LAUNCH:v[ga]=q;aa(ga,r.LAUNCH,n);break;}}else if(da==='receive'){if(fa.data&&fa.data.playing){if(w[ga]&&w[ga]===q){if(t[ga]===q){t[ga]=false;aa(ga,r.PLAY_INSTALL,o);}else if(s[ga]===q){aa(ga,r.PLAY_ALREADY,o);}else aa(ga,r.PLAY,o);w[ga]=true;}if(u[ga]&&u[ga]===q){aa(ga,r.INSTALL,o);u[ga]=true;}}if(fa.op===i.STATUS_CHANGE_OP.STATUS){if(u[ga]&&u[ga]===q){aa(ga,r.INSTALL,o);u[ga]=true;}if(v[ga]&&v[ga]===q){aa(ga,r.LAUNCH,o);v[ga]=true;}}}else if(da==='state_change')if(fa.to===i.DIAGNOSTIC_EVENT.OFFLINE){s[ga]=false;}else if(fa.data===i.DIAGNOSTIC_EVENT.INCORRECT_ONLINE_STATE)aa(ga,r.INCORRECT_ONLINE_STATE);}function aa(da,ea,fa){var ga=ea;if(fa){ga+='_'+fa;ea+='.'+fa;}m.debug(ga,da);k.log(k.PLATFORM,{type:ea,time:new Date(),provider:da});}function ba(){for(var da in x){if(u[da]===q){u[da]=true;aa(da,r.INSTALL,p);}if(v[da]===q){v[da]=true;aa(da,r.LAUNCH,p);}if(w[da]===q){w[da]=true;aa(da,r.PLAY,p);}}k.dispatchNow(true);}l.onUnload(ba);var ca={init:function(da){x[da]=true;if(y)return;g.subscribe('MusicDiagnostics/state_change',z.curry('state_change'));g.subscribe('MusicDiagnostics/receive',z.curry('receive'));g.subscribe('MusicDiagnostics/user_action',z.curry('user_action'));y=true;}};e.exports=a.MusicDiagnosticLogger||ca;});