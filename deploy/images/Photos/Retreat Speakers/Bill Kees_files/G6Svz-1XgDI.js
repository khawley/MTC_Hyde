/*1349661942,173217057*/

if (window.CavalryLogger) { CavalryLogger.start_js(["ovKup"]); }

__d("SystemEvents",["Arbiter","Env","ErrorUtils","UserAgent","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Env'),i=b('ErrorUtils'),j=b('UserAgent'),k=b('copyProperties'),l=new g(),m=[],n=1000;setInterval(function(){for(var w=0;w<m.length;w++)m[w]();},n,false);function o(){return (/c_user=(\d+)/.test(document.cookie)&&RegExp.$1)||0;}var p=h.user,q=navigator.onLine;function r(){if(!q){q=true;l.inform(l.ONLINE,q);}}function s(){if(q){q=false;l.inform(l.ONLINE,q);}}if(j.ie()){if(j.ie()>=8){window.attachEvent('onload',function(){document.body.ononline=r;document.body.onoffline=s;});}else m.push(function(){(navigator.onLine?r:s)();});}else if(window.addEventListener)if(!j.chrome()){window.addEventListener('online',r,false);window.addEventListener('offline',s,false);}var t=p;m.push(function(){var w=o();if(t!=w){l.inform(l.USER,w);t=w;}});var u=Date.now();function v(){var w=Date.now(),x=w-u,y=x<0||x>10000;u=w;if(y)l.inform(l.TIME_TRAVEL,x);return y;}m.push(v);m.push(function(){if(window.onerror!=i.onerror)window.onerror=i.onerror;});a.SystemEvents=e.exports=k(l,{USER:'SystemEvents/USER',ONLINE:'SystemEvents/ONLINE',TIME_TRAVEL:'SystemEvents/TIME_TRAVEL',isPageOwner:function(w){return (w||o())==p;},isOnline:function(){return j.chrome()||q;},checkTimeTravel:v});},3);
__d("AppRequestReminders",["AsyncRequest","CSS","DOM","ge"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('DOM'),j=b('ge'),k=0,l={},m=1,n=j('OtherAppReqReminder'),o=function(u,v,w){l[v]={node:u,seq:m++,reqCount:w};},p=function(u){k=u;},q=function(u){return u.id.split('_')[1];},r=function(u){var v=j(u),w=v.nextSibling;if(w!==n){h.show(w);k-=l[q(w)].reqCount;}s(k);},s=function(u){new g().setURI('/ajax/reminders/update_count.php').setData({new_count:u}).setMethod('POST').send();},t=function(u,v){if(n&&v&&u>0){i.setContent(j('OtherAppReqLabel'),v);}else if(n){h.hide(n);}else h.hide(j('OtherAppReqReminder'));};f.initNode=o;f.handleRemove=r;f.updateCount=t;f.setTotalOtherCount=p;});
__d("legacy:CounterDisplay",["CounterDisplay"],function(a,b,c,d){a.CounterDisplay=b('CounterDisplay');},3);
function startMessagingNavCountUpdater(a){var b=FutureSideNav.getInstance().getNodeForKey('inbox');if(!b)return;var c=FutureSideNav.getInstance().getNodeForKey('other'),d=DOM.scry(c,'span.count')[0],e=DOM.scry(d,'span.countValue')[0],f=DOM.scry(d,'span.maxCountIndicator')[0];new CounterMaxDisplay('other_unseen',e,d,null,null,true).setMaxCounter(a,f);}function CounterMaxDisplay(){this._maxValue=null;this._maxIndicatorNode=null;var a=[this].concat($A(arguments));return this.parent.construct.apply(this.parent,a);}Class.extend(CounterMaxDisplay,'CounterDisplay');copyProperties(CounterMaxDisplay.prototype,{setMaxCounter:function(a,b){this._maxValue=a;this._maxIndicatorNode=b;},paint:function(){var a=this._maxValue&&this._count>this._maxValue,b=a?this._maxValue:this._count;if(this._maxIndicatorNode){DOM.setContent(this._maxIndicatorNode,a?'+':'');}else if(a)b=b+'+';DOM.setContent(this._valueNode,b);this._toggleNodes();}});
__d("MusicButtonStore",[],function(a,b,c,d,e,f){var g={},h={addButton:function(i,j){g[i]=j;return j;},getButton:function(i){return g[i];},getButtons:function(){return g;},removeButton:function(i){g[i]&&g[i].resetLoadingTimers();delete g[i];}};e.exports=h;});
__d("MusicEvents",["Arbiter"],function(a,b,c,d,e,f){var g=b('Arbiter');e.exports=a.MusicEvents=new g();});
__d("MusicProviders",[],function(a,b,c,d,e,f){e.exports=a.MusicProviders={SPOTIFY:'open.spotify.com'};});
__d("MusicConstants",["Arbiter","MusicEvents","MusicProviders"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('MusicEvents'),i=b('MusicProviders'),j={DEBUG:false,LIVE_LISTEN_MIN_SPOTIFY_VERSION:'spotify-0.6.6.0.g5a9eaca5',enableDebug:function(){this.DEBUG=true;},sameURLs:function(k,l){var m=/\/$/;if(k&&l){k=URI(k);l=URI(l);return k.getDomain()==l.getDomain()&&k.getPath()==l.getPath();}return false;},greaterOrEqualToMinimumVersion:function(k,l){var m=/(?:\d+\.)+/,n=k.match(m)[0].split('.').slice(0,-1),o=l.match(m)[0].split('.').slice(0,-1);if(n.length!==o.length)return false;for(var p=0;p<o.length;p++)if(+n[p]<+o[p]){return false;}else if(+n[p]>+o[p])return true;return true;},sanitizeForProviders:function(k){var l={};for(var m in k)if(this.ALLOWED_EXTERNAL_CONTEXT_PARAMS[m])l[m]=k[m];return l;},OP:{RESUME:'RESUME',PAUSE:'PAUSE',PLAY:'PLAY',VERSION:'VERSION'},STATUS_CHANGE_OP:{STATUS:'STATUS',LOGIN:'LOGIN',REINFORM:'REINFORM'},STATUS_CHANGE_EVENT:{playing:'PLAY_STATE_CHANGED',track:'TRACK_CHANGED'},DIAGNOSTIC_EVENT:{ALL_PAUSED:'ALL_PAUSED',ALL_OFFLINE:'ALL_OFFLINE',OFFLINE:'OFFLINE',ONLINE:'ONLINE',SEARCHING:'SEARCHING',HIT:'HIT',MISS:'MISS',RESIGN:'RESIGN',IFRAME_POLLING:'IFRAME_POLLING',RELAUNCH:'RELAUNCH',STATE_CHANGE:'STATE_CHANGE',WRONG_VERSION:'WRONG_VERSION',SERVICE_ERROR:'SERVICE_ERROR',INCORRECT_ONLINE_STATE:'INCORRECT_ONLINE_STATE',LOG_SEND_OP:'LOG_SEND_OP',REQUEUE_OP:'REQUEUE_OP'},ALLOWED_STATUS_PARAMS:{playing:'playing',track:'track',context:'context',client_version:'client_version',start_time:'start_time',expires_in:'expires_in',open_graph_state:'open_graph_state'},ALLOWED_EXTERNAL_CONTEXT_PARAMS:{uri:true,song:true,radio_station:true,album:true,playlist:true,musician:true,song_list:true,offset:true,title:true,request_id:true,listen_with_friends:true,needs_tos:true},LIVE_LISTEN_OP:{NOW_LEADING:'NOW_LEADING',NOW_LISTENING:'NOW_LISTENING',END_SESSION:'END_SESSION',SONG_PLAYING:'SONG_PLAYING',LISTENER_UPDATE:'LISTENER_UPDATE',QUEUE_SESSION:'QUEUE_SESSION',PLAY_ERROR:'PLAY_ERROR',SESSION_UPDATED:'SESSION_UPDATED',QUEUING_SESSION:'QUEUING_SESSION'},MUSIC_BUTTON:{ACTIVATE:'ACTIVATE'},ERROR:{1:'SERVICE_UNAVAILABLE_WITHOUT_PREMIUM',2:'SERVICE_UNAVAILABLE_WITHOUT_PREMIUM_OR_WAIT',3:'SERVICE_UNAVAILABLE_BILLING_ISSUE',4:'SERVICE_UNAVAILABLE_TECHNICAL_ISSUE',5:'AUDIO_AD_PLAYING',99:'SERVICE_TEMPORARILY_UNAVAILABLE',101:'SONG_UNAVAILABLE_WITHOUT_PURCHASE',102:'SONG_UNAVAILABLE_WITHOUT_PREMIUM',103:'SONG_UNAVAILABLE_INDEFINITELY'}};e.exports=a.MusicConstants||j;});
__d("MusicWaterfallLogger",["JSLogger"],function(a,b,c,d,e,f){var g=b('JSLogger'),h=g.create('music_waterfall'),i={click:function(l){j('click',l);},musicLoadedFromClick:function(l){j('music_loaded_from_click',l);},playPause:function(l){j('play_pause',l);}};function j(l,m){h.debug(l+'_debug',m);h.bump(l);h.bump(l+'_'+k(m));}function k(l){return l?l.replace(/\.|-/g,'_'):'';}e.exports=i;});
__d("MusicButton",["Bootloader","copyProperties","CSS","DOM","MusicButtonStore","MusicConstants","MusicEvents","MusicWaterfallLogger","Parent","Tooltip"],function(a,b,c,d,e,f){var g=b('Bootloader'),h=b('copyProperties'),i=b('CSS'),j=b('DOM'),k=b('MusicButtonStore'),l=b('MusicConstants'),m=b('MusicEvents'),n=b('MusicWaterfallLogger'),o=b('Parent'),p=b('Tooltip'),q=function(r,s,t,u,v,w){this.provider=r;this.buttonElem=s;this.url=t;this.context=u||{};this.mediaType=v;this.setState(this.STATES.OFFLINE);this.tooltip=w||'';m.subscribe(l.MUSIC_BUTTON.ACTIVATE,this.processClick.bind(this));};h(q,{tracksetableTypes:[]});h(q.prototype,{SHOW_LOADING_TIMEOUT:500,HIDE_LOADING_TIMEOUT:4000,RECENTLY_ONLINE_TIMEOUT:6000,STATES:{PLAYING:'music_playing',PAUSED:'music_paused',LOADING:'music_loading',DISABLED:'music_disabled',OFFLINE:'music_offline'},setState:function(r){if(r!==this.STATES.LOADING){this.resetLoadingTimers();this.previousState=this.state||r;}if(r===this.STATES.PLAYING){p.set(this.buttonElem,this.tooltip);}else p.set(this.buttonElem,'');var s=this.buttonElem.parentNode;this.state&&i.removeClass(s,this.state);this.state=r;i.addClass(s,this.state);},isTracksetable:function(r){return q.tracksetableTypes.indexOf(this.mediaType)!==-1;},handleIncomingEvent:function(r,s){clearTimeout(this._showLoadingTimer);if(s&&s.provider&&s.provider!=this.provider)return;switch(r){case l.DIAGNOSTIC_EVENT.ONLINE:case l.STATUS_CHANGE_EVENT.track:case l.STATUS_CHANGE_EVENT.playing:var t=s&&s.track&&s.track.uri,u=s&&s.context&&s.context.uri;if(s&&s.playing&&(l.sameURLs(t,this.url)||l.sameURLs(u,this.url))){this.setState(this.STATES.PLAYING);}else if(this.state===this.STATES.LOADING&&(this.previousState===this.STATES.PAUSED||this.previousState===this.STATES.OFFLINE)){clearTimeout(this._attemptingPlayTimer);this._attemptingPlayTimer=this.setState.bind(this,this.STATES.PAUSED).defer(this.RECENTLY_ONLINE_TIMEOUT,false);}else if(!this._attemptingPlayTimer)this.setState(this.STATES.PAUSED);break;case l.DIAGNOSTIC_EVENT.OFFLINE:this.setState(this.STATES.OFFLINE);break;case l.DIAGNOSTIC_EVENT.ALL_OFFLINE:this.setState(this.STATES.OFFLINE);break;}},processClick:function(r,s){if(s!=this.buttonElem){if(this.state===this.STATES.LOADING)this.previousState&&this.setState(this.previousState);return;}n.click(this.provider);var t=this.isTracksetable()&&o.byClass(this.buttonElem,'music_trackset_container'),u=[];if(t){var v=t.getAttribute('data-trackset-title'),w=this.provider,x=j.scry(t,'.music_button');for(var y=0;y<x.length;y++){var z=k.getButton([x[y].id]);if(z&&z.provider==w&&z.isTracksetable())u.push(z.url);}}if(!a.Music)this.showLoading(true);g.loadModules(['Music'],function(aa){n.musicLoadedFromClick(this.provider);var ba=(t&&u.length>1)?aa.playPauseSongList(this.provider,this.url,u,v,this.context):aa.playPauseSong(this.provider,this.url,this.context);this.showLoading(!ba);}.bind(this));},showLoading:function(r){this.resetLoadingTimers();this._hideLoadingTimer=this._timeout.bind(this,r).defer(this.HIDE_LOADING_TIMEOUT,false);this._showLoadingTimer=this.setState.bind(this,this.STATES.LOADING).defer(this.SHOW_LOADING_TIMEOUT,false);},resetLoadingTimers:function(){clearTimeout(this._hideLoadingTimer);clearTimeout(this._showLoadingTimer);clearTimeout(this._attemptingPlayTimer);this._attemptingPlayTimer=null;},destroy:function(){this.resetLoadingTimers();this.buttonElem=null;},_timeout:function(r){a.Music&&a.Music.reInform([this.provider]);if(!r&&this.state===this.STATES.LOADING)this.setState(this.STATES.PAUSED);}});e.exports=q;});
__d("MusicButtonManager",["event-extensions","DOM","KeyedCallbackManager","Layer","MusicButton","MusicButtonStore","MusicConstants","MusicEvents","Parent","$","copyProperties","ge"],function(a,b,c,d,e,f){b('event-extensions');var g=b('DOM'),h=b('KeyedCallbackManager'),i=b('Layer'),j=b('MusicButton'),k=b('MusicButtonStore'),l=b('MusicConstants'),m=b('MusicEvents'),n=b('Parent'),o=b('$'),p=b('copyProperties'),q=b('ge'),r=new h(),s=null,t={},u=0;function v(event){var ca=event.getTarget(),da=n.byClass(ca,'music_button');da=da||(!event.getModifiers().any&&w(ca));if(!da)return;return x(da,event);}function w(ca){var da=n.byClass(ca,'music_button_trigger')&&n.byClass(ca,'music_button_trigger_group');if(da){var ea=g.scry(da,'.music_button');if(ea.length)return ea[0];}return null;}function x(ca,event){event&&event.stop();m.inform(l.MUSIC_BUTTON.ACTIVATE,ca);return false;}function y(ca){a.Music&&a.Music.reInform(ca);}function z(ca,da){var ea=k.getButtons();for(var fa in ea)if(ea[fa].noGC||q(fa)){ea[fa].handleIncomingEvent(ca,da);}else k.removeButton(fa);}var aa={init:function(ca){if(s)return;s=true;j.tracksetableTypes=ca||[];Event.listen(document.body,'click',v);m.subscribe([l.STATUS_CHANGE_EVENT.playing,l.STATUS_CHANGE_EVENT.track,l.DIAGNOSTIC_EVENT.OFFLINE,l.DIAGNOSTIC_EVENT.ALL_OFFLINE,l.DIAGNOSTIC_EVENT.ONLINE],z);},add:function(ca,da,ea,fa,ga,ha){s||aa.init();var ia=da.id,ja=k.getButton(ia);if(ja)return ja;ja=k.addButton(ia,new j(ca,da,ea,p({button_id:ia},fa),ga,ha));var ka=n.byClass(da,'uiOverlay');if(ka){ja.noGC=true;var la=i.subscribe('destroy',function(ma,na){if(g.contains(na.getRoot(),da)){k.removeButton(ia);i.unsubscribe(la);}});}if(ca&&!t[ca])t[ca]=function(){var ma=Object.keys(t);ma.length&&y(ma);t={};}.defer();return ja;},addButton:function(ca,da,ea,fa,ga,ha){if(!q(da))return;var ia=o(da);return aa.add(ca,ia,ea,fa,ga,ha);},asyncAddMusicButton:function(ca,da){ca.setAttribute('id','music_button_'+u++);ba(ca,da);},tryAddButtonInDOM:function(ca,da){var ea=q(ca);ea&&ba(ea,da);},addMusicData:function(ca,da,ea,fa,ga,ha){r.setResource(ca,{provider:da,uri:ea,context:fa,media_type:ga,tooltip:ha});}};function ba(ca,da){var ea=g.find(ca,'a.button_anchor').getAttribute('href');r.executeOrEnqueue(ea,function(fa){return aa.add(fa.provider,ca,fa.uri,fa.context,fa.media_type,da?fa.tooltip:'');});}e.exports=a.MusicButtonManager||aa;});
__d("legacy:CompactTypeaheadRenderer",["CompactTypeaheadRenderer"],function(a,b,c,d){if(!a.TypeaheadRenderers)a.TypeaheadRenderers={};a.TypeaheadRenderers.compact=b('CompactTypeaheadRenderer');},3);
__d("CacheStorage",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h={memory:k,localstorage:i,sessionstorage:j};function i(){this._store=a.localStorage;}i.available=function(){return !!a.localStorage;};g(i.prototype,{keys:function(){var m=[];for(var n=0;n<this._store.length;n++)m.push(this._store.key(n));return m;},get:function(m){return this._store.getItem(m);},set:function(m,n){this._store.setItem(m,n);},remove:function(m){this._store.removeItem(m);},clear:function(){this._store.clear();}});function j(){this._store=a.sessionStorage;}j.available=function(){return !!a.sessionStorage;};g(j.prototype,{keys:function(){var m=[];for(var n=0;n<this._store.length;n++)m.push(this._store.key(n));return m;},get:function(m){return this._store.getItem(m);},set:function(m,n){this._store.setItem(m,n);},remove:function(m){this._store.removeItem(m);},clear:function(){this._store.clear();}});function k(){this._store={};}k.available=function(){return true;};g(k.prototype,{keys:function(){return Object.keys(this._store);},get:function(m){if(this._store[m]===undefined)return null;return this._store[m];},set:function(m,n){this._store[m]=n;},remove:function(m){if(m in this._store)delete this._store[m];},clear:function(){this._store={};}});function l(m,n){this._key_prefix=n||'_cs_';this._magic_prefix='_@_';if(m=='AUTO'||!m)for(var o in h){var p=h[o];if(p.available()){m=o;break;}}if(m)if(!h[m]||!h[m].available()){this._backend=new k();}else this._backend=new h[m]();}g(l,{getAllStorageTypes:function(){return Object.keys(h);}});g(l.prototype,{keys:function(){var m=[];if(this._backend){var n=this._backend.keys();for(var o=0;o<n.length;o++)if(n[o].substr(0,this._key_prefix.length)==this._key_prefix)m.push(n[o].substr(this._key_prefix.length));return m;}return m;},set:function(m,n){if(this._backend){if(typeof n=='string'){n=this._magic_prefix+n;}else n=JSON.stringify(n);this._backend.set(this._key_prefix+m,n);}},get:function(m,n){var o;if(this._backend){o=this._backend.get(this._key_prefix+m);if(o!==null){if(o.substr(0,this._magic_prefix.length)==this._magic_prefix){o=o.substr(this._magic_prefix.length);}else try{o=JSON.parse(o);}catch(p){o=undefined;}}else o=undefined;}if(o===undefined&&n!==undefined){o=n;if(this._backend){var q;if(typeof o=='string'){q=this._magic_prefix+o;}else q=JSON.stringify(o);this._backend.set(this._key_prefix+m,q);}}return o;},remove:function(m){if(this._backend)this._backend.remove(this._key_prefix+m);}});e.exports=l;});
__d("FBDesktopPlugin",["CacheStorage","DOM","Env","FBDesktopDetect","URI","Style"],function(a,b,c,d,e,f){var g=b('CacheStorage'),h=b('DOM'),i=b('Env'),j=b('FBDesktopDetect'),k=b('URI'),l=b('Style'),m=new g('localstorage','_socialfox_'),n={_plugin:'_not_checked',arbiterInform:function(o,p){var q=JSON.stringify({name:o,payload:p});this._transmitCommand('arbiterinform',q);},bringToFront:function(){this._transmitCommand('bringtofront');},dock:function(){this._transmitCommand('dock');},getPlugin:function(){if(this._plugin==='_not_checked'){this._plugin=null;if(j.isPluginInstalled()){var o=h.create('object',{id:'kiwi_plugin',type:j.mimeType});l.set(o,'width',0);l.set(o,'height',0);var p=h.create('div',{},o);l.set(p,'width',0);l.set(p,'height',0);document.body.appendChild(p);this._plugin=o;}}return this._plugin;},getUserID:function(){var o=this.getPlugin();return o&&'getUserID' in o&&o.getUserID();},getVersion:function(){var o=this.getPlugin();return o&&'getVersion' in o&&o.getVersion();},isAppRunning:function(){var o=this.getPlugin();return o&&'isAppRunning' in o&&o.isAppRunning();},launchApp:function(){var o=this.getPlugin();return o&&'launchApp' in o&&o.launchApp();},login:function(o,p){if(p&&o&&o.length>0){var q=this.getPlugin();if(q){this._transmitCommand('relogin\n'+o+'\n'+p);return;}}},logout:function(o){o=o||"0";var p=this.getPlugin();if(p)p.logout(o);},recheck:function(){if(this._plugin===null)this._plugin='_not_checked';},shouldSuppressBeeper:function(){return this.isAppRunning();},shouldSuppressMessages:function(){var o=this.getUserID();if(o){return o===i.user;}else return this.isAppRunning();},shouldSuppressSidebar:function(){var o=this.getPlugin(),p=o&&'isAppDocked' in o&&o.isAppDocked(),q=m&&m.get('active')==='true';return p||q;},transferAuthToken:function(o,p){if(o&&o.length>0){var q=this.getPlugin();if(q){q.setAccessToken(o,p);var r=setInterval(function(){q.setAccessToken(o,p);},500);setTimeout(function(){clearInterval(r);},10*1000);}}if(this.redirectHome)window.location.href=k().setPath().toString();},_transmitCommand:function(o,p){p=p||'';var q=this.getPlugin();if(q&&'transmitCommand' in q)q.transmitCommand(o,p);}};e.exports=n;});
__d("Dcode",[],function(a,b,c,d,e,f){var g,h={},i={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var k=[];for(var l in i){h[i[l]]=l;k.push(i[l]);}k.reverse();g=new RegExp(k.join("|"),'g');})();var j={encode:function(k){return encodeURIComponent(k).replace(/([_A-Z])|%../g,function(l,m){return m?'%'+m.charCodeAt(0).toString(16):l;}).toLowerCase().replace(g,function(l){return h[l];});},decode:function(k){return decodeURIComponent(k.replace(/[_A-Z]/g,function(l){return i[l];}));}};e.exports=j;});
__d("DocRPC",["ErrorUtils"],function(a,b,c,d,e,f){var g=b('ErrorUtils'),h={_apis:{},_dispatch:function(i){var j;try{i=JSON.parse(i);}catch(k){throw new Error('DocRPC unparsable dispatch: "'+i+'"');}if(h._apis.hasOwnProperty(i.api)){var l=h._apis[i.api];if(l[i.method])j=g.applyWithGuard(l[i.method],l,i.args);}if(j===undefined)j=null;return JSON.stringify(j);},publish:function(i,j){h._apis[j]=i;},proxy:function(i,j,k){var l={};k.forEach(function(m){l[m]=function(){var n={api:j,method:m,args:Array.prototype.slice.call(arguments)},o=i.DocRPC._dispatch(JSON.stringify(n));if(typeof(o)=='string')try{o=JSON.parse(o);}catch(p){throw new Error('DocRPC '+j+'.'+m+' unparsable return: "'+o+'"');}return o;};});return l;}};e.exports=a.DocRPC=h;});
__d("Poller",["AsyncRequest","Cookie","Env","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Cookie'),i=b('Env'),j=b('copyProperties'),k=b('emptyFunction');function l(m,n,o){this._clearOnQuicklingEvent=!o;this._requestCallback=n;this.setTimePeriod(m);}l.MIN_TIME_PERIOD=2000;j(l.prototype,{stop:function(){clearTimeout(this._token);this._token=null;this._cancelRequest();},scheduleRequest:function(){this.stop();if(this._timePeriod)this._token=this._makeRequest.bind(this).defer(this._timePeriod,this._clearOnQuicklingEvent);},requestNow:function(){this.stop();this._makeRequest();},_timePeriod:null,setTimePeriod:function(m){m=m||null;if(m&&(isNaN(m)||m<l.MIN_TIME_PERIOD))return;if(m&&this._timePeriod==null)this._token=this._makeRequest.bind(this).defer(m,this._clearOnQuicklingEvent);this._timePeriod=m;},_makeRequest:function(){this._cancelRequest();if(!this._isLoadUser())return;var m=new g(),n=true;m.setInitialHandler(function(){return n;});this._cancelRequest=function(){n=false;};m.setFinallyHandler(this.scheduleRequest.bind(this));m.setInitialHandler=k;m.setFinallyHandler=k;this._requestCallback(m);if(n)m.send();},_isLoadUser:function(){return i.user==h.get('c_user');},_cancelRequest:k,getTimePeriod:function(){return this._timePeriod;}});e.exports=l;});
__d("setIntervalAcrossTransitions",[],function(a,b,c,d,e,f){function g(h,i){return setInterval(h,i,false);}e.exports=g;});
__d("MercuryEmoji",["Emoji","Emote","MercuryConfig"],function(a,b,c,d,e,f){var g=b('Emoji'),h=b('Emote'),i=c('MercuryConfig'),j={htmlEmojiAndEmote:function(k,l){if(i.MessagingDisplayEmojiGK){return g.htmlEmojiAndEmote(k,l);}else return h.htmlEmote(k,l);}};e.exports=j;});
__d("ChannelSubdomain",["Cookie","JSLogger","UserAgent"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('JSLogger'),i=b('UserAgent'),j=h.create('channel'),k=7,l=null;function m(p){var q=null,r=n(),s,t=i.firefox()?Math.floor(Math.random()*32):0;for(var u=0;u<32;u++){s=(u+t)%32;if(!(r&(1<<s)))break;}p--;if(s<Math.min(32,k*p)){l=s;q=l%k;g.set('sub',r|(1<<l));}else{l=-1;q=null;j.error('subdomain_overflow',{slot:l,max:p});}return q;}function n(){var p=g.get('sub')||0;p=parseInt(p,10);return isNaN(p)?0:p;}function o(){if(l!==null&&l>=0){var p=n()&~(1<<l);if(p){g.set('sub',p);}else g.clear('sub');}}e.exports={allocate:m,clear:o};});
__d("ChannelTransport",["copyProperties","bind","AjaxRequest","URI","JSLogger","DocRPC","ChannelConstants"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('bind'),i=b('AjaxRequest'),j=b('URI'),k=b('JSLogger'),l=b('DocRPC'),m=b('ChannelConstants'),n=k.create('channel');function o(){return (1048576*Math.random()|0).toString(36);}function p(x,y){var z=x.subdomain;z=z===null?'':(z+'-');var aa=new j(y).setDomain(z+x.host+'.facebook.com').setPort(x.port).setSecure(j().isSecure());return aa;}function q(x){var y={partition:x.partition,cb:o()},z=p(x,'/p').setQueryData(y);n.log('start_p',{uri:z.toString()});var aa=new i('GET',z);if(i.supportsCORS())aa.xhr.withCredentials=true;var ba=function(ca){n.log('finish_p',{xhr:ca.toJSON?ca.toJSON():ca});};aa.timeout=x.P_TIMEOUT;aa.onError=aa.onSuccess=ba;aa.send();}function r(x,y,z){var aa=new Image(),ba=0,ca=function(fa){aa.abort();return fa?y():z();};aa.onload=function(){n.log('ping_ok',{duration:Date.now()-ba});ca(true);};aa.onerror=function(){q(x);ca(false);};var da=setTimeout(aa.onerror,10000,false);aa.abort=function(){if(da){clearTimeout(da);da=null;}aa.onload=aa.onerror=null;};var ea={partition:x.partition,cb:o()};ba=Date.now();aa.src=p(x,'/ping').setQueryData(ea);return aa;}function s(x,y,z,aa){var ba=new Date(),ca=(ba-x.userActive)/1000|0;if(ca<0)n.warn('idle_regression',{idleTime:ca,now:ba.getTime(),userActive:x.userActive});var da={channel:x.user_channel,seq:x.seq,partition:x.partition,clientid:x.sessionID,cb:o(),idle:ca};if(ca<60)da.state='active';if(x.streamingCapable){da.mode='stream';da.format='json';}if(x.profile)da.profile=x.profile;var ea=p(x,'/pull').setQueryData(da),fa=new i('GET',ea);if(i.supportsCORS())fa.xhr.withCredentials=true;fa.timeout=x.streamingCapable?x.STREAMING_TIMEOUT:x.LONGPOLL_TIMEOUT;fa.onJSON=y;fa.onSuccess=z;fa.onError=function(){var ga=(this.status==12002&&this._time>=x.MIN_12002_TIMEOUT)||(this.status==504&&this._time>=x.MIN_504_TIMEOUT),ha=ga?z:aa;return ha&&ha.apply(this,arguments);};fa.send();x.inStreaming=x.streamingCapable;return fa;}function t(x){this.manager=x;(this.init&&this.init());}function u(x){t.apply(this,arguments);}g(u.prototype,{logName:'CORS',enterState:function(x,y){if(this._request){this._request.abort();this._request=null;}if(x=='init')setTimeout(h(this.manager,'exitState',{status:m.OK,stateId:y.stateId}),3000,false);if(!/pull|ping/.test(x))return;var z=this.manager;if(x=='ping'){this._request=r(y,h(z,'exitState',{status:m.OK,stateId:y.stateId}),h(z,'exitState',{status:m.ERROR,stateId:y.stateId}));}else if(x=='pull')this._request=s(y,h(z,'_processTransportData',y.stateId),h(z,'exitState',{status:m.OK,stateId:y.stateId}),h(z,'exitState',{status:m.ERROR,stateId:y.stateId}));}});function v(x){n.log('iframe_init_constructor');t.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);l.publish(this,'outerTransport');}g(v.prototype,{logName:'iframe',_initIframe:function(x){n.log('iframe_init_start');window.onchanneliframeready=function(){n.log('iframe_resources');return x.resources;};window.onchanneliframeloaded=function(){n.log('iframe_loaded');};if(x){this._iframeURI=p(x,x.path);if(x.bustIframe){var y={partition:x.partition,cb:o()};this._iframeURI.setQueryData(y);}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);n.log('iframe_uri_set');}catch(z){n.error('iframe_uri_set_error',z);this.exitState({status:m.ERROR,stateId:x.stateId},z+'');}},enterState:function(x,y){if(x=='init'){this._initIframe(y);}else if(/idle|ping|pull/.test(x)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(x!='idle')this.exitState({status:m.ERROR,stateId:y.stateId},'iframe not yet loaded');}else if(x=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(x){if(this.manager.state=='init'&&x.status==m.OK)this._iframeProxy=l.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function w(){this.init=this.init.bind(this);t.apply(this,arguments);}g(w.prototype,{logName:'iframe(inner)',init:function(){l.publish(this,'innerTransport');try{var y=l.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);g(this,y);this.exitState({status:m.OK,stateId:1e+06});}catch(x){n.error('iframe_inner_init_error',x);}},enterState:function(x,y){if(this._request){this._request.abort();this._request=null;}if(x=='ping'){this._request=r(y,h(this,'exitState',{status:m.OK,stateId:y.stateId}),h(this,'exitState',{status:m.ERROR,stateId:y.stateId}));}else if(x=='pull')this._request=s(y,h(this,'_processTransportData',y.stateId),h(this,'exitState',{status:m.OK,stateId:y.stateId}),h(this,'exitState',{status:m.ERROR,stateId:y.stateId}));}});e.exports={getURI:p,Transport:t,CORSTransport:u,IframeTransport:v,IframeInnerTransport:w};});
__d("MovingStat",[],function(a,b,c,d,e,f){function g(h){h=h||60000;var i={t:new Date(),count:0,v:0},j=i,k=0,l=0;function m(){var n=new Date()-h;while(j&&j.next&&j.t<n){k-=j.v;l-=j.count;j=j.next;}}this.add=function(n){k+=n;l++;var o=new Date();if(o-i.t<1000){i.v+=n;i.count++;}else{i.next={t:o,v:n,count:1};i=i.next;m();}};this.tally=function(n){n=n||1000;m();return {sum:k,count:l,timeAverage:k*n/h};};}e.exports=g;});
__d("PresenceUtil",["Cookie","Env","randomInt","tx"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('Env'),i=b('randomInt'),j=b('tx'),k=i(0,4294967295)+1,l={checkMaintenanceError:function(m){if(m.getError()==1356007)return true;return false;},getErrorDescription:function(m){var n=m.getError(),o=m.getErrorDescription();if(!o)o="An error occurred.";if(n==1357001)o="Your session has timed out. Please log in.";return o;},getSessionID:function(){return k;},hasUserCookie:function(){return h.user===g.get('c_user');}};e.exports=l;});
__d("PresenceCookieManager",["Cookie","Dcode","ErrorUtils","Env","JSLogger","PresenceUtil","URI","PresenceInitialData"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('Dcode'),i=b('ErrorUtils'),j=b('Env'),k=b('JSLogger'),l=b('PresenceUtil'),m=b('URI'),n=c('PresenceInitialData'),o=n.cookieVersion,p=n.dictEncode,q='presence',r={},s=null,t=null,u=k.create('presence_cookie');function v(){try{var z=g.get(q);if(s!==z){s=z;t=null;if(z&&z.charAt(0)=='E')z=h.decode(z.substring(1));if(z)t=JSON.parse(z);}if(t&&(!t.user||t.user===j.user))return t;}catch(y){u.warn('getcookie_error');}return null;}function w(){return parseInt(new Date().getTime()/1000,10);}var x={register:function(y,z){r[y]=z;},store:function(){var y=v();if(y&&y.v&&o<y.v)return;var z={v:o,time:w(),user:j.user};for(var aa in r)z[aa]=i.applyWithGuard(r[aa],r,[y&&y[aa]],function(ea){ea.presence_subcookie=aa;});var ba=JSON.stringify(z);if(p)ba='E'+h.encode(ba);if(l.hasUserCookie()){var ca=ba.length;if(ca>1024)u.warn('big_cookie',ca);var da=m.getRequestURI(false).isSecure()&&!!g.get('csm');g.set(q,ba,null,null,da);}},clear:function(){g.clear(q);},getSubCookie:function(y){var z=v();if(!z)return null;return z[y];}};e.exports=x;});
__d("PresenceState",["Arbiter","ErrorUtils","JSLogger","PresenceCookieManager","copyProperties","debounceAcrossTransitions","setIntervalAcrossTransitions","PresenceInitialData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ErrorUtils'),i=b('JSLogger'),j=b('PresenceCookieManager'),k=b('copyProperties'),l=b('debounceAcrossTransitions'),m=b('setIntervalAcrossTransitions'),n=c('PresenceInitialData'),o=n.cookiePollInterval||2000,p=[],q=[],r=null,s=null,t=0,u=null,v=0,w=['sb2','t2','lm2','uct2','tr','tw','at','wml'],x=i.create('presence_state');function y(){return j.getSubCookie('state');}function z(){t=Date.now();j.store();da(s);}var aa=l(z,0);function ba(ia){if(typeof ia=='undefined'||isNaN(ia)||ia==Number.POSITIVE_INFINITY||ia==Number.NEGATIVE_INFINITY)ia=0;return ia;}function ca(ia){var ja={};if(ia){w.forEach(function(ma){ja[ma]=ia[ma];});if(t<ia.ut)x.error('new_cookie',{cookie_time:ia.ut,local_time:t});}ja.ut=t;for(var ka=0,la=p.length;ka<la;ka++)h.applyWithGuard(p[ka],null,[ja]);s=ja;return s;}function da(ia){v++;t=ba(ia.ut);if(!r)r=m(ga,o);s=ia;if(u===null)u=ia;for(var ja=0,ka=q.length;ja<ka;ja++)h.applyWithGuard(q[ja],null,[ia]);v--;}function ea(ia){if(ia&&ia.ut)if(t<ia.ut){return true;}else if(ia.ut<t)x.error('old_cookie',{cookie_time:ia.ut,local_time:t});return false;}function fa(){var ia=y();if(ea(ia))s=ia;return s;}function ga(){var ia=y();if(ea(ia))da(ia);}j.register('state',ca);g.subscribe(i.DUMP_EVENT,function(ia,ja){ja.presence_state={initial:k({},u),state:k({},s),update_time:t,sync_paused:v,poll_time:o};});(function(){var ia=fa();if(ia){da(ia);}else{x.debug('no_cookie_initial');da(ca());return;}})();var ha={doSync:function(ia){if(v)return;if(ia){z();}else aa();},registerStateStorer:function(ia){p.push(ia);},registerStateLoader:function(ia){q.push(ia);},get:function(){return fa();},getInitial:function(){return u;},verifyNumber:ba};e.exports=ha;},3);
__d("ChannelManager",["event-extensions","function-extensions","AjaxRequest","Arbiter","AsyncRequest","ChannelConstants","ChannelSubdomain","ChannelTransport","Cookie","Env","FBAjaxRequest","JSLogger","MovingStat","PresenceCookieManager","PresenceState","PresenceUtil","Run","SystemEvents","URI","UserActivity","UserAgent","copyProperties","createArrayFrom","hasArrayNature","ChannelInitialData"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('AjaxRequest'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('ChannelConstants'),k=b('ChannelSubdomain'),l=b('ChannelTransport'),m=b('Cookie'),n=b('Env'),o=b('FBAjaxRequest'),p=b('JSLogger'),q=b('MovingStat'),r=b('PresenceCookieManager'),s=b('PresenceState'),t=b('PresenceUtil'),u=b('Run'),v=b('SystemEvents'),w=b('URI'),x=b('UserActivity'),y=b('UserAgent'),z=b('copyProperties'),aa=b('createArrayFrom'),ba=b('hasArrayNature'),ca=c('ChannelInitialData'),da,ea=p.create('channel'),fa=null;function ga(sa){fa=sa;}var ha={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'pull',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},ia={userActive:Date.now(),sessionID:(Math.random()*2147483648|0).toString(16),streamingCapable:false,inStreaming:false,LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:30000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:3000,STREAMING_EXIT_STATE_ON_CONTINUE:false},ja=1,ka={},la=0;function ma(sa){return sa.toLowerCase().replace(/[^0-9a-z]+/g,'_');}function na(){return i.lastSuccessTime?Math.round((Date.now()-i.lastSuccessTime)/1000):-1;}function oa(){var sa={};if(da.getConfig('host'))sa[da.getConfig('user_channel')]=da.getConfig('seq',0);return sa;}function pa(){var sa=Date.now(),ta=Date.now(),ua={total:0},va='idle',wa=false;v.subscribe([v.USER,v.ONLINE,v.TIME_TRAVEL],function(za,ab){ra(true);ta=null;da.lastPullTime=Date.now();var bb;switch(za){case v.USER:bb=v.isPageOwner()?j.SYS_OWNER:j.SYS_NONOWNER;break;case v.ONLINE:bb=ab?j.SYS_ONLINE:j.SYS_OFFLINE;break;case v.TIME_TRAVEL:bb=j.SYS_TIMETRAVEL;break;}da.exitState({status:bb,stateId:ja});});var xa=function(za,ab){var bb=Date.now(),cb;if(ab){sa=bb;cb=ab.nextState||ab.state;}else cb=va;v.checkTimeTravel();if(ta){var db=Math.round((bb-ta)/1000);if(db>0){ua[va]=(ua[va]||0)+db;ua.total+=db;}}va=cb;ta=bb;if(!za){ua.lastSuccessTime=na();ua.online=v.isOnline();ea.log('rollup',ua);}};h.subscribe(j.ON_ENTER_STATE,xa);setInterval(xa,60000,false);h.subscribe(p.DUMP_EVENT,function(za,ab){ab.channelRollup=ua;});var ya=function(){if(da.isShutdown()||da.shouldIdle())return;v.checkTimeTravel();var za=Date.now()-(da.lastPullTime||n.start);if(!wa&&za>ia.STALL_THRESHOLD){var ab=na();ea.error('stall',{lastSuccessTime:ab,rollupState:va});wa=true;}var bb=Date.now()-sa;if(da.state=='pull'&&bb>ia.JUMPSTART_THRESHOLD){sa=null;ea.warn('jumpstart',{state:da.state,dormant:bb});da.enterState('init');}};setInterval(ya,10000,false);}function qa(){var sa=Date.now(),ta=1;function ua(){setTimeout(ua,ta*1000,false);var za=da.state;if(za=='idle'&&da.shouldIdle())return;ea.bump('conn_t',ta);if(za=='pull')ea.bump('conn_t_pull',ta);}ua();var va=[15,30,60,120,240],wa=false,xa=false;function ya(za){setTimeout(function(){ea.rate('pullenter_'+za,wa);ea.rate('pullexit_'+za,xa);},za*1000,false);}while(va.length)ya(va.shift());h.subscribe(j.ON_ENTER_STATE,function(za,ab){if(ab.state=='pull')wa=true;sa=Date.now();});h.subscribe(j.ON_EXIT_STATE,function(za,ab){if(ab.state!='pull'||!sa)return;var bb='other';if(ab.status==j.OK){xa=true;bb='ok';}else if(ab.xhr&&ab.xhr.errorType){bb=/ar:(\w+)/.test(ab.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(ab.status))return;var cb=(Date.now()-sa)/1000;if(cb<0){return;}else if(cb>3600)cb=3600;ea.bump('conn_num');ea.bump('conn_exit',cb);ea.bump('conn_num_'+bb);ea.bump('conn_exit_'+bb,cb);});}function ra(sa){if(sa){la=0;ka={};}else la++;}da={state:'idle',nextState:null,lastPullTime:Date.now(),heartbeats:[],setTestCallback:ga,init:function(sa){this.init=function(){};if(typeof(x)!='undefined'){x.subscribe(function(){ia.userActive=Date.now();}.bind(this));}else ea.error('user_activity_undefined');r.register('ch',oa);var ta=this.getConfig('max_conn',2);ia.subdomain=k.allocate(ta);if(typeof window.onpageshow!='undefined'){Event.listen(window,'pagehide',k.clear);}else u.onUnload(k.clear);this._transportRate=new q(30000);var ua=(g.supportsCORS()&&!ia.forceIframe)?'CORSTransport':'IframeTransport';this.transport=new l[ua](this);if(sa)this.enterState.apply(this,arguments);h.subscribe(p.DUMP_EVENT,function(event,wa){wa.transportRate=this._transportRate.tally();wa.transportType=ua;wa.transportVersion=2;}.bind(this));pa();qa();if(da.getConfig('tryStreaming')&&da.getConfig('host')&&g.supportsCORS()&&!ia.forceIframe){var va=ia.MIN_INIT_PROBE_DELAY+Math.random()*ia.INIT_PROBE_DELAY_RANDOMIZE_RANGE;setTimeout(this._probeTest,va,false);}},configure:function(){var sa=aa(arguments);ea.log('configure',sa);sa.forEach(z.bind(null,ia));h.inform(j.ON_CONFIG,this);},getConfig:function(sa,ta){return sa in ia?ia[sa]:ta;},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(v.isPageOwner()&&v.isOnline());},_sendIframeError:function(sa){var ta=new i().setURI('/ajax/presence/reconnect.php').setData({reason:sa,fb_dtsg:n.fb_dtsg}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);ta.specifiesWriteRequiredParams()&&ta.send();},_getDelay:function(){var sa=Math.min(ia.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,la-1)),ia.MAX_RETRY_INTERVAL);return sa*(.75+Math.random()/2)|0;},enterState:function(){if(this._inEnterState)ea.warn('enterstate_recursion');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(sa){this._inEnterState=false;throw sa;}},_enterState:function(sa){var ta=0,ua=aa(arguments);if(this.isShutdown())return;if(sa!='idle!'&&this.shouldIdle())return;ja++;ia.stateId=ja;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(sa)){var va=this._transportRate.tally().timeAverage,wa=da.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(va>=wa){if(!this._throttled){this._throttled=true;ea.warn('throttled');}ea.bump('throttle');ta=1000/wa;}}else if(!(/#$/.test(sa)))ta=this._getDelay();sa=sa.replace(/\W*$/,'');if(!ha[sa])throw new Error('invalid state:'+sa);var xa;if(ta<=0){xa={state:sa};this._transportRate.add(1);this.state=sa;var ya=this['_enter_'+this.state];if(ya){ua.shift();ya.apply(this,ua);}if(/init|idle|pull|ping/.test(this.state)){if(ia.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];this.transport.enterState(this.state,ia);if(this.state=='ping'){xa.url=l.getURI(ia).toString();xa.port=ia.port||'undefined';}}}else{this.state='idle';this.nextState=sa;xa={state:this.state,delay:ta,nextState:sa};ua[0]=sa+'#';this._deferredTransition=(function(){this._deferredTransition=null;this.enterState.apply(this,ua);}).bind(this).defer(ta,false);}if(/pull/.test(sa)){xa.client_id=ia.sessionID;xa.streaming=ia.inStreaming;}ea.log('enter_'+this.state,xa);h.inform(j.ON_ENTER_STATE,xa);},exitState:function(sa,ta){var ua=sa.stateId,va=sa.status;if(this.isShutdown()||ua<ja)return;var wa=aa(arguments),xa=this.state;wa[0]=sa.status;var ya={state:xa,status:va};if(/pull/.test(xa)){ya.client_id=ia.sessionID;ya.streaming=ia.inStreaming;}if(/ping/.test(xa)&&va!=j.OK)ya.url=l.getURI(ia).toString();if(this.nextState)ya.nextState=this.nextState;if(ta&&ta.errorType){ya.xhr=ta.toJSON?ta.toJSON():ta;delete ya.xhr.json;}if(ta&&ta.json){if(ta.json.t)ya.t=ta.json.t;if(ta.json.reason)ya.reason=ta.json.reason;if(ta.json.seq)ya.seq=ta.json.seq;}ea.log('exit_'+xa,ya);h.inform(j.ON_EXIT_STATE,ya);var za=this['_exit_'+xa];if(za)va=za.apply(this,wa)||va;if(va!=j.OK){ra();ka[xa]=(ka[xa]||0)+1;}var ab=ha[this.nextState||xa][va]||ha._all[va],bb=ab&&ab.replace(/!*$/,'');if(!bb){ea.error('terminal_transition',ya);this._shutdownHint=j.HINT_INVALID_STATE;ab='shutdown!';}this._lastState=xa;this._lastStatus=va;this.enterState(ab);},_processTransportData:function(sa,ta){var ua=ta.json,va=ua.t;if('s' in ua){ua.seq=ua.s;delete ua.s;}var wa=ia.seq;if('seq' in ua){ia.seq=ua.seq;s.doSync();}switch(va){case 'continue':if(ia.inStreaming&&this.heartbeats.length<1){ia.streamingCapable=false;ea.log('switch_to_longpoll');setTimeout(this._probeTest,ia.PROBE_DELAY,false);}ra(true);if(!ia.inStreaming||ia.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:j.OK,stateId:sa});break;case 'refresh':case 'refreshDelay':this.exitState({status:'refresh_'+(ua.reason||0),stateId:sa},ta);break;case 'fullReload':r.clear();ea.log('invalid_history');h.inform(j.ON_INVALID_HISTORY);this.exitState({status:j.ERROR_MISSING,stateId:sa},ta);break;case 'msg':var xa,ya,za,ab;ra(true);ya=ua.ms;za=ia.seq-ya.length;for(xa=0;xa<ya.length;xa++,za++)if(za>=wa){ab=ya[xa];if(ab.type){ea.debug('message',{type:ab.type});h.inform(j.getArbiterType(ab.type),{obj:ab});}}else ea.warn('seq_regression',{seq:za,last_seq:wa,messages:ya.length});break;case 'heartbeat':if(ia.inStreaming){var bb=Date.now();if(this.heartbeats.length>0){var cb=bb-this.heartbeats[this.heartbeats.length-1];ea.log('heartbeat_interval',{client_id:ia.sessionID,interval:cb});}this.heartbeats.push(bb);}break;default:ea.error('unknown_msg_type',{type:va});break;}},_enter_init:function(){if(ka.init>=da.getConfig('MAX_INIT_FAILS',2))return this.exitState.bind(this,{status:j.ERROR_MAX,stateId:ja}).defer();this._initTimer=this.exitState.bind(this,{status:j.ERROR,stateId:ja},'timeout').defer(ia.IFRAME_LOAD_TIMEOUT,false);},_enter_reconnect:function(sa){var ta=ja;if(!t.hasUserCookie()){ea.warn('no_user_cookie');(function(){da._shutdownHint=j.HINT_AUTH;da.exitState({status:j.ERROR_SHUTDOWN,stateId:ta});}).defer();return;}var ua={reason:sa,fb_dtsg:n.fb_dtsg};if(n.fb_isb)ua.fb_isb=n.fb_isb;if(fa)fa(ua);var va=new o('GET','/ajax/presence/reconnect.php',ua);va.onSuccess=(function(){da.configure(va.json);r.store();this.exitState({status:j.OK,stateId:ta});}).bind(this);va.onError=(function(){var wa=va.json&&va.json.error;if(va.errorType==g.TRANSPORT_ERROR||va.errorType==g.PROXY_ERROR)this._shutdownHint=j.HINT_CONN;if(wa&&wa==1356007){this._shutdownHint=j.HINT_MAINT;}else if(wa==1357001||wa==1357004||wa==1348009){this._shutdownHint=j.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?j.ERROR_SHUTDOWN:j.ERROR,stateId:ta},va);}).bind(this);va.send();},_enter_shutdown:function(){h.inform(j.ON_SHUTDOWN,{reason:this._shutdownHint});},_exit_init:function(sa){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(sa==j.ERROR_MAX)this._sendIframeError(j.reason_IFrameLoadGiveUp);},_exit_pull:function(sa){if(sa==j.OK)this.lastPullTime=Date.now();},_exit_ping:function(sa){if(sa==j.OK){var ta=Date.now()-(this.lastPullTime||n.start);if(ta>ia.STALL_THRESHOLD)return j.ERROR_STALE;}},_probeTest:function(){ia.streamingCapable=false;var sa=[],ta={mode:'stream',format:'json'},ua=new w('/probe').setDomain(ia.host+'.facebook.com').setPort(ia.port).setSecure(w().isSecure()).setQueryData(ta),va=new g('GET',ua);va.onJSON=function(wa,xa){if(wa&&wa.json&&wa.json.t==='heartbeat'){sa.push(Date.now());if(sa.length>=2){var ya=sa[1]-sa[0];if(ya>=ia.PROBE_HEARTBEATS_INTERVAL_LOW&&ya<=ia.PROBE_HEARTBEATS_INTERVAL_HIGH){ia.streamingCapable=true;ea.log('switch_to_streaming');}ea.log('probe_ok',{time:ya});}}};va.onSuccess=function(wa){if(sa.length!=2){ia.streamingCapable=false;ea.error('probe_error',{error:'beats.length = '+sa.length});}};va.onError=function(wa){ia.streamingCapable=false;ea.error('probe_error',wa);};ea.log('probe_request');va.send();}};e.exports=da;if(ca.serverInitialized==null){da.configure(ca.channelConfig);if(/shutdown/.test(ca.state))da._shutdownHint=j[ca.reason];da.init(ca.state,ca.reason);}});
__d("ChannelConnection",["Arbiter","copyProperties","ChatConfig","Run","SystemEvents","ChannelConstants","ChannelManager","JSLogger"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('ChatConfig'),j=b('Run'),k=b('SystemEvents'),l=b('ChannelConstants'),m=b('ChannelManager'),n=b('JSLogger'),o=n.create('channel_connection'),p=null,q=null,r=null,s=null,t=0,u=h(new g(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});function v(){if(q){clearTimeout(q);q=null;}}function w(){v();o.log('unmute_warning');u.inform(u.UNMUTE_WARNING);}function x(ba){v();q=w.defer(ba,false);o.log('mute_warning',{time:ba});u.inform(u.MUTE_WARNING);}function y(){if(r){clearTimeout(r);r=null;}}function z(ba,ca){y();if(ba===l.ON_ENTER_STATE&&(ca.nextState||ca.state)==='pull'){if(s!==u.CONNECTED){o.log('connected');var da=!s;s=u.CONNECTED;t=0;u.inform(u.CONNECTED,{init:da});}}else if(ba===l.ON_ENTER_STATE&&((ca.nextState||ca.state)==='ping'||(!ca.nextState&&ca.state==='idle'))){r=(function(){var ea=null;if(!(ca.state==='idle'&&!ca.nextState))ea=(ca.delay||0);o.log('reconnecting',{delay:ea});if(u.disconnected())o.log('reconnecting_ui',{delay:ea});s=u.RECONNECTING;(ca.state==='idle')&&t++;if(t>1){u.inform(u.RECONNECTING,ea);}else if(!ca.nextState&&ca.state==='idle')z(ba,ca);}).defer(500,false);}else if(ba===l.ON_SHUTDOWN){o.log('shutdown',{reason:ca.reason});s=u.SHUTDOWN;t=0;u.inform(u.SHUTDOWN,ca.reason);}}function aa(ba){if(m.state==='ping'||m.isShutdown())return;o.log('reconnect',{now:ba});u.inform(u.RECONNECTING,0);if(!!ba){if(p!==null){clearTimeout(p);p=null;}m.enterState('ping!');}else if(!p)p=setTimeout(function(){m.enterState('ping!');p=null;},i.get('channel_manual_reconnect_defer_msec'),false);}if(m.isShutdown()){z(l.ON_SHUTDOWN,m._shutdownHint);}else z(l.ON_ENTER_STATE,{state:m.state,nextState:m.nextState,delay:0});g.subscribe([l.ON_ENTER_STATE,l.ON_SHUTDOWN],z);k.subscribe(k.TIME_TRAVEL,function(){aa();x(i.get('mute_warning_time_msec'));});j.onBeforeUnload(y,false);h(u,{disconnected:function(){return s===u.SHUTDOWN||(s===u.RECONNECTING&&!q&&t>1);},isShutdown:function(){return s===u.SHUTDOWN;},reconnect:aa,unmuteWarning:w});e.exports=u;});
__d("AvailableListConstants",[],function(a,b,c,d,e,f){var g={ON_AVAILABILITY_CHANGED:'buddylist/availability-changed',ON_UPDATE_ERROR:'buddylist/update-error',ON_UPDATED:'buddylist/updated',ON_CHAT_NOTIFICATION_CHANGED:'chat-notification-changed',OFFLINE:0,IDLE:1,ACTIVE:2,MOBILE:3,LEGACY_OVERLAY_OFFLINE:-1,LEGACY_OVERLAY_ONLINE:0,LEGACY_OVERLAY_IDLE:1,legacyStatusMap:{'0':2,'1':1,'-1':0,'2':3},reverseLegacyStatusMap:{0:-1,1:1,2:0,3:2}};window.AvailableListConstants=e.exports=g;},3);
__d("PresencePrivacy",["hasArrayNature","Arbiter","AsyncRequest","ChannelConstants","copyProperties","Env","JSLogger","PresenceUtil","PresencePrivacyInitialData"],function(a,b,c,d,e,f){var g=b('hasArrayNature'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('ChannelConstants'),k=b('copyProperties'),l=b('Env'),m=b('JSLogger'),n=b('PresenceUtil'),o=c('PresencePrivacyInitialData'),p='/ajax/chat/privacy/settings.php',q='/ajax/chat/privacy/online_policy.php',r='/ajax/chat/privacy/visibility.php',s='friend_visibility',t='visibility',u='online_policy',v=k({},o.privacyData),w=o.visibility,x=k({},o.privacyData),y=w,z=o.onlinePolicy,aa=z,ba=[],ca=false;function da(){return m.create('blackbird');}var ea=k(new h(),{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1});function fa(ra){var sa;for(sa in ra){var ta=ra[sa];if(sa==l.user){da().error('set_viewer_visibility');throw new Error("Invalid to set current user's visibility");}switch(ta){case ea.WHITELISTED:case ea.BLACKLISTED:case ea.UNLISTED:break;default:da().error('set_invalid_friend_visibility',{id:sa,value:ta});throw new Error("Invalid state: "+ta);}}for(sa in ra)v[sa]=ra[sa];ea.inform('privacy-changed');}function ga(ra,sa){var ta={};ta[ra]=sa;fa(ta);}function ha(ra){switch(ra){case ea.ONLINE:case ea.OFFLINE:break;default:da().error('set_invalid_visibility',{value:ra});throw new Error("Invalid visibility: "+ra);}w=ra;ea.inform('privacy-changed');ea.inform('privacy-user-presence-changed');h.inform('chat/visibility-changed',{sender:this});}function ia(ra){switch(ra){case ea.ONLINE_TO_WHITELIST:case ea.ONLINE_TO_BLACKLIST:break;default:throw new Error("Invalid default online policy: "+ra);}z=ra;ea.inform('privacy-user-presence-changed');ea.inform('privacy-changed');}function ja(ra,sa){ca=true;ra.send();}function ka(ra,sa){ba.push({request:ra,data:sa});if(!ca){var ta=ba.shift();ja(ta.request,ta.data);}}function la(ra,sa){var ta=ra.type;if(ta===s){var ua=sa.payload.user_availabilities;if(!g(ua)){ea.inform('privacy-availability-changed',{user_availabilities:ua});for(var va in ra.settings)x[va]=ra.settings[va];}}else{if(ta===t){y=ra.visibility;}else if(ta===u)aa=ra.online_policy;ea.inform('privacy-user-presence-response');}da().log('set_update_response',{data:ra,response:sa});}function ma(ra,sa){if(w!==y)ha(y);if(z!==aa)ia(aa);k(v,x);ea.inform('privacy-changed');ba=[];da().log('set_error_response',{data:ra,response:sa});}function na(ra){ca=false;if(ba.length>0){var sa=ba.shift();ja(sa.request,sa.data);}}function oa(ra,sa){if(n!=null){var ta=ra.getData();ta.window_id=n.getSessionID();ra.setData(ta);}ra.setHandler(la.bind(this,sa)).setErrorHandler(ma.bind(this,sa)).setTransportErrorHandler(ma.bind(this,sa)).setFinallyHandler(na.bind(this)).setAllowCrossPageTransition(true);return ra;}function pa(ra,sa,ta){return oa(new i(ra).setData(sa),ta);}function qa(ra,sa){var ta=sa.obj;if(ta.viewer_id!=l.user){da().error('invalid_viewer_for_channel_message',{type:ra,data:sa});throw new Error("Viewer got from the channel is not the real viewer");}if(ta.window_id===n.getSessionID())return;var ua=ta.data;if(ta.event=='access_control_entry'){ua.target_ids.forEach(function(wa){ga(wa,ua.setting);x[wa]=ua.setting;});}else{if(ta.event=='visibility_update'){var va=!!ua.visibility?ea.ONLINE:ea.OFFLINE;ha(va);y=va;}else if(ta.event=='online_policy_update'){ia(ua.online_policy);aa=ua.online_policy;}ea.inform('privacy-user-presence-response');}da().log('channel_message_received',{data:sa.obj});}k(ea,{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1,init:function(ra,sa,ta){},setVisibility:function(ra){y=w;ha(ra);var sa={visibility:ra},ta={type:t,visibility:ra},ua=pa(r,sa,ta);ka(ua,ta);da().log('set_visibility',{data:sa});return ra;},getVisibility:function(){return w;},setOnlinePolicy:function(ra){aa=z;ia(ra);var sa={online_policy:ra},ta={type:u,online_policy:ra},ua=pa(q,sa,ta);ka(ua,ta);da().log('set_online_policy',{data:sa});return ra;},getOnlinePolicy:function(){return z;},getFriendVisibility:function(ra){return v[ra]||ea.UNLISTED;},allows:function(ra){if(this.getVisibility()===ea.OFFLINE)return false;var sa=this.getOnlinePolicy();return sa===ea.ONLINE_TO_WHITELIST?v[ra]==ea.WHITELISTED:v[ra]!=ea.BLACKLISTED;},setFriendsVisibility:function(ra,sa){if(ra.length>0){var ta={};for(var ua=0;ua<ra.length;ua++){var va=ra[ua];x[va]=v[va];ta[va]=sa;}fa(ta);var wa=sa;if(wa==ea.UNLISTED)wa=x[ra[0]];var xa={users:ra,setting:sa,setting_type:wa},ya={type:s,settings:ta},za=pa(p,xa,ya);ka(za,ya);da().log('set_friend_visibility',{data:xa});}return sa;},setFriendVisibilityMap:function(ra,sa){for(var ta in ra)x[ta]=v[ta];fa(ra);var ua={type:s,settings:ra};ka(oa(sa,ua),ua);da().log('set_friend_visibility_from_map',{data:ra});},allow:function(ra){if(this.allows(ra)){da().error('allow_already_allowed');throw new Error("allow() should only be called for users that "+"are not already allowed");}if(this.getVisibility()===ea.OFFLINE){da().error('allow_called_while_offline');throw new Error("allow() should only be called when the user is already online");}var sa=this.getOnlinePolicy()===ea.ONLINE_TO_WHITELIST?ea.WHITELISTED:ea.UNLISTED;return this.setFriendsVisibility([ra],sa);},disallow:function(ra){if(!this.allows(ra)){da().error('disallow_already_disallowed');throw new Error("disallow() should only be called for users that "+"are not already disallowed");}if(this.getVisibility()===ea.OFFLINE){da().error('disallow_called_while_offline');throw new Error("disallow() should only be called when the user is already online");}var sa=this.getOnlinePolicy()===ea.ONLINE_TO_BLACKLIST?ea.BLACKLISTED:ea.UNLISTED;return this.setFriendsVisibility([ra],sa);},getBlacklist:function(){var ra=[];for(var sa in v)if(v[sa]===ea.BLACKLISTED)ra.push(sa);return ra;},getWhitelist:function(){var ra=[];for(var sa in v)if(v[sa]===ea.WHITELISTED)ra.push(sa);return ra;},getMapForTest:function(){return v;},setMapForTest:function(ra){v=ra;}});ea.inform('privacy-changed');ea.inform('privacy-user-presence-changed');da().log('initialized',{visibility:w,policy:z});h.subscribe(j.getArbiterType('privacy_changed'),qa.bind(this));h.subscribe(j.ON_CONFIG,function(ra,sa){var ta=sa.getConfig('visibility',null);if(ta!==null&&typeof(ta)!=='undefined'){var ua=ta?ea.ONLINE:ea.OFFLINE;ha(ua);da().log('config_visibility',{vis:ua});}}.bind(this));a.PresencePrivacy=e.exports=ea;},3);
__d("Chat",["Arbiter","AsyncSignal","JSLogger","PresencePrivacy"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncSignal'),i=b('JSLogger'),j=b('PresencePrivacy');function k(o,p,q){if(p&&p=='ordered_list'||p=='more_online_friends'||p=='online_friends'||p=='typeahead'){var r={target:o,source:p,sorted_list:q};new h('/ajax/chat/ct.php',r).send();}}var l={buddyListNub:'buddylist-nub/initialized',sidebar:'sidebar/initialized'};function m(o,p){g.subscribe(l[o],function(event,q){p(q);});}var n={openTab:function(o,p,q,r,s){if(window.External&&window.External.Chat&&window.External.Chat.openWindow)window.External.Chat.openWindow(o);k(o,r,s);d(['MercuryThreads'],function(t){if(!q||q=='friend'){var u=t.getCanonicalThreadToUser(o);g.inform('chat/open-tab',{thread_id:u.thread_id});}});},openBuddyList:function(){m('buddyListNub',function(o){o.show();m('sidebar',function(p){p.enable();});});},closeBuddyList:function(){m('buddyListNub',function(o){o.hide();});},toggleSidebar:function(){m('sidebar',function(o){o.toggle();});},goOnline:function(o){d(['ChatVisibility'],function(p){p.goOnline(o);});},isOnline:function(){var o=null;d(['ChatVisibility'],function(p){o=p;});return o&&o.isOnline();}};a.Chat=e.exports=n;},3);
__d("ChatVisibility",["Arbiter","JSLogger","PresencePrivacy"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('JSLogger'),i=b('PresencePrivacy'),j={isOnline:function(){return i.getVisibility()===i.ONLINE;},hasBlackbirdEnabled:function(){return this.isVisibleToMostFriends()||this.isVisibleToSomeFriends();},isVisibleToMostFriends:function(){return i.getOnlinePolicy()===i.ONLINE_TO_BLACKLIST&&i.getBlacklist().length>0;},isVisibleToSomeFriends:function(){return i.getOnlinePolicy()===i.ONLINE_TO_WHITELIST&&i.getWhitelist().length>0;},goOnline:function(k){if(i.getVisibility()===i.OFFLINE){h.create('blackbird').log('chat_go_online');i.setVisibility(i.ONLINE);g.inform('chat-visibility/go-online');}k&&k();},goOffline:function(k){if(i.getVisibility()===i.ONLINE){h.create('blackbird').log('chat_go_offline');i.setVisibility(i.OFFLINE);g.inform('chat-visibility/go-offline');}k&&k();},toggleVisibility:function(){if(j.isOnline()){j.goOffline();}else j.goOnline();}};a.ChatVisibility=e.exports=j;},3);
__d("ServerTime",["PresenceInitialData"],function(a,b,c,d,e,f){var g=c('PresenceInitialData'),h;function i(k){h=Date.now()-k;}i(g.serverTime);var j={get:function(){return Date.now()-h;},getSkew:function(){return h;},update:function(k){i(k);}};e.exports=j;});
__d("AvailableList",["function-extensions","Arbiter","ArbiterMixin","AsyncRequest","AvailableListConstants","ChannelConstants","Chat","ChatConfig","ChatVisibility","Class","Env","JSLogger","Poller","PresencePrivacy","PresenceUtil","ServerTime","ShortProfiles","UserActivity","copyProperties","createObjectFrom","debounceAcrossTransitions","emptyFunction","ChannelImplementation","AvailableListInitialData"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('AsyncRequest'),j=b('AvailableListConstants'),k=b('ChannelConstants'),l=b('Chat'),m=b('ChatConfig'),n=b('ChatVisibility'),o=b('Class'),p=b('Env'),q=b('JSLogger'),r=b('Poller'),s=b('PresencePrivacy'),t=b('PresenceUtil'),u=b('ServerTime'),v=b('ShortProfiles'),w=b('UserActivity'),x=b('copyProperties'),y=b('createObjectFrom'),z=b('debounceAcrossTransitions'),aa=b('emptyFunction'),ba=c('ChannelImplementation').instance,ca=c('AvailableListInitialData'),da=5,ea=60000,fa='/ajax/chat/buddy_list.php',ga=5000,ha=1800000,ia=.005,ja=0,ka=0,la=false,ma=ca.pollInterval,na=ca.lazyPollInterval,oa=ca.lazyThreshold,pa=0,qa=Date.now(),ra=0,sa=false,ta={},ua=false,va={},wa=null,xa={},ya={},za=q.create('available_list'),ab=x({},j,h);ab.subscribe([j.ON_AVAILABILITY_CHANGED,j.ON_UPDATE_ERROR,j.ON_UPDATED],function(tb,ub){g.inform(tb,ub);});function bb(tb){var ub=tb||w.isActive(oa);return n.isOnline()?(ub?ma:na):null;}function cb(){ab.inform(j.ON_AVAILABILITY_CHANGED);}var db=z(cb,0);function eb(tb,ub,vb,wb){if(tb==p.user)return;switch(ub){case j.OFFLINE:case j.IDLE:case j.ACTIVE:case j.MOBILE:break;default:return;}var xb=ab.get(tb)!=ub;if(vb){xa[tb]=u.get();ya[tb]=wb;}ta[tb]=ub;if(xb){ja++;db();}}function fb(tb){ra=Date.now();va=y(tb);ja++;db();}function gb(){if(sa)ab.inform(j.ON_UPDATED,ab);}function hb(tb){if(t.checkMaintenanceError(tb))return;ka++;la=false;if(ka>=da)ab.inform(j.ON_UPDATE_ERROR);}function ib(tb){var ub=tb.getPayload(),vb=ub.buddy_list;if(!vb){hb(tb);return;}u.update(ub.time);pa=u.get();ka=0;la=false;if(vb.mobile_friends!=null)fb(vb.mobile_friends);var wb=vb.userInfos;if(wb)v.setMulti(wb);ob();ua=vb.userIsIdle;var xb=vb.nowAvailableList;xb&&mb(xb);if(vb.chatNotif!==undefined){wa=vb.chatNotif;ab.inform(j.ON_CHAT_NOTIFICATION_CHANGED,wa);}nb();gb();db();}function jb(tb){if(ba.isShutdown()||!n.isOnline()){ab._poller.stop();return;}qa=Date.now();var ub=false;if(Date.now()-ra>ha)ub=true;la=true;var vb=v.getCachedProfileIDs();tb.setHandler(ib).setErrorHandler(hb).setOption('suppressErrorAlerts',true).setOption('retries',1).setData({user:p.user,available_user_info_ids:vb,fetch_mobile:ub}).setURI(fa).setAllowCrossPageTransition(true);}function kb(tb){var ub=tb.payload.availability||{};for(var vb in ub)eb(vb,ub[vb],true,'mercury_tabs');}function lb(tb){var ub=ab.getDebugInfo(tb),vb=(ub.presence==j.ACTIVE),wb=new i('/ajax/mercury/tabs_presence.php').setData({target_id:tb,to_online:vb,presence_source:ub.overlaySource,presence_time:ub.overlayTime}).setHandler(kb).setErrorHandler(aa).setAllowCrossPageTransition(true).send();}function mb(tb){for(var ub in tb)eb(ub,tb[ub].a,false,null);sa=true;}function nb(tb){var ub=bb(tb);za.debug('update_poller',ub);ab._poller&&ab._poller.setTimePeriod(ub);}function ob(){sa=false;ta={};ya={};xa={};ja++;}function pb(){ob();qa=0;ra=0;ua=false;wa=null;va={};cb();}function qb(){nb();if(n.isOnline()){ab.update();}else pb();}function rb(){nb();if(ba.disconnected()){pb();}else if(!sa)ab.update();}function sb(tb,ub){ub.chat_config=m.getDebugInfo();ub.available_list_debug_info={};ab.getAvailableIDs().forEach(function(vb){ub.available_list_debug_info[vb]=ab.getDebugInfo(vb);});ub.available_list_poll_interval=ab._poller&&ab._poller.getTimePeriod();}x(ab,{get:function(tb){if(tb==p.user)return n.isOnline()?j.ACTIVE:j.OFFLINE;var ub=j.OFFLINE;if(tb in ta)ub=ta[tb];if(!s.allows(tb))ub=j.OFFLINE;if(ub==j.OFFLINE)if(va[tb])ub=j.MOBILE;return ub;},updateForID:function(tb){lb(tb);},getWebChatNotification:function(){return wa;},isUserIdle:function(){return ua;},isReady:function(){return sa;},set:function(tb,ub,vb){eb(tb,ub,true,null,vb);},update:function(){if(Date.now()-qa<ga){!la&&gb.defer();return;}ab._poller&&ab._poller.requestNow();},getRev:function(){return ja;},isIdle:function(tb){return ab.get(tb)==j.IDLE;},getOnlineIDs:function(){var tb,ub=[];for(tb in ta)if(ab.get(tb)===j.ACTIVE)ub.push(tb);return ub;},getAvailableIDs:function(){var tb=ab.getOnlineIDs(),ub;for(ub in va){if(ta[ub])continue;tb.push(ub);}return tb;},getOnlineCount:function(){return ab.getOnlineIDs().length;},getDebugInfo:function(tb){var ub;if(window.ShortProfiles){var vb=v.getNow(tb);if(vb)ub=vb.name;}return {id:tb,presence:ta[tb],overlaySource:ya[tb],overlayTime:xa[tb],overlaySource:ya[tb],mobile:va[tb],name:ub};}});pa=ca.updateTime;mb(ca.availableList);if(ca.mobileFriends)fb(ca.mobileFriends);wa=ca.chatNotif;ab._poller=new r(bb(),jb,true);nb(true);g.subscribe(q.DUMP_EVENT,sb);w.subscribe(function(tb,ub){if(ub.idleness>ma){za.debug('update_activity');ab.update();}});s.subscribe('privacy-changed',cb);s.subscribe('privacy-availability-changed',function(tb,ub){for(var vb in ub.user_availabilities)this.set(vb,ub.user_availabilities[vb]);}.bind(ab));s.subscribe('privacy-user-presence-response',ab.update);ba.subscribe([ba.CONNECTED,ba.RECONNECTING,ba.SHUTDOWN,ba.MUTE_WARNING,ba.UNMUTE_WARNING],rb);g.subscribe(k.getArbiterType('buddylist_overlay'),function(tb,ub){var vb=ub.obj.overlay;for(var wb in vb)ab.set(wb,vb[wb].a,vb[wb].s||'channel');});a.AvailableList=e.exports=ab;});
__d("ChatOptions",["Arbiter","ChannelConstants","JSLogger","PresenceUtil","copyProperties","ChatOptionsInitialData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('JSLogger'),j=b('PresenceUtil'),k=b('copyProperties'),l=i.create('chat_options'),m={};(function(){var o=c('ChatOptionsInitialData');for(var p in o){var q=o[p];m[p]=!!q;}})();var n=k(new g(),{getSetting:function(o){return m[o];},setSetting:function(o,p,q){if(this.getSetting(o)==p)return;if(q){q='from_'+q;l.log(q,{name:o,new_value:p,old_value:this.getSetting(o)});}m[o]=!!p;g.inform('chat/option-changed',{name:o,value:p});}});g.subscribe(h.getArbiterType('setting'),function(o,p){var q=p.obj;if(q.window_id===j.getSessionID())return;n.setSetting(q.setting,!!q.value,'channel');});g.subscribe(i.DUMP_EVENT,function(o,p){p.chat_options=m;});e.exports=n;});
__d("OrderedFriendsList",["array-extensions","Arbiter","createArrayFrom","ShortProfiles","copyProperties","OrderedFriendsListInitialData"],function(a,b,c,d,e,f){b('array-extensions');var g=b('Arbiter'),h=b('createArrayFrom'),i=b('ShortProfiles'),j=b('copyProperties'),k=[],l={},m=j(new g(),{contains:function(n){return n in l;},compare:function(n,o){var p=m.getRank(n),q=m.getRank(o);if(p!==q)return p-q;var r=i.getNow(n),s=i.getNow(o),t=((r||{}).name||'~').toLowerCase(),u=((s||{}).name||'~').toLowerCase();if(t!==u)return t<u?-1:1;return 0;},getList:function(){var n=h(k);n=n.filter(function(o){var p=window.ShortProfiles&&i.getNow(o);return !p||p.type=="friend";});return n;},getRank:function(n){return n in l?l[n]:k.length;},isReady:function(){return true;}});(function(){var n=c('OrderedFriendsListInitialData');k=n.list.length?n.list:[];k.forEach(function(o,p){l[o]=p;});m.inform('initialized',{},g.BEHAVIOR_PERSISTENT);})();e.exports=a.OrderedFriendsList||m;});
__d("ChatTypeaheadBehavior",["Chat","CSS","DOM","Rect","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('Chat'),h=b('CSS'),i=b('DOM'),j=b('Rect'),k=b('copyProperties'),l=b('tx');function m(n){this._typeahead=n;}k(m.prototype,{_subscriptions:null,enable:function(){var n=this._typeahead;this._subscriptions=[n.subscribe('focus',function(){n.getData().refreshData();}),n.subscribe('blur',function(o){n.getCore().reset();}),n.subscribe('respond',function(o,p){if(p.value&&p.value===n.getCore().getValue()){if(!p.results.length){var q=i.create('div',{className:'noResults'},"Friend not found.");i.setContent(n.getView().getElement(),q);}h.addClass(n.getElement(),'hasValue');}}),n.subscribe('reset',function(){h.removeClass(n.getElement(),'hasValue');}),n.subscribe('select',function(o,p){g.openTab(p.selected.uid,p.selected.text,p.selected.type,'typeahead');}),n.subscribe('highlight',function(o,p){if(p.index>=0){var q=n.getView().getItems()[p.index];if(q){var r=new j(q),s=q.offsetParent,t=r.boundWithin(new j(s)).getPositionVector();r.getPositionVector().sub(t).scrollElementBy(s);}}})];},disable:function(){this._subscriptions.forEach(function(n){this._typeahead.unsubscribe(n);}.bind(this));this._subscriptions=null;}});e.exports=m;});
__d("ChatTypeaheadCore",["event-extensions","function-extensions","Class","Keys","TypeaheadCore","copyProperties","emptyFunction"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Class'),h=b('Keys'),i=b('TypeaheadCore'),j=b('copyProperties'),k=b('emptyFunction');function l(m){this.parent.construct(this,m);}g.extend(l,i);j(l.prototype,{handleTab:k,keydown:function(event){var m=Event.getKeyCode(event);if(m===h.ESC){this.reset.shield(this).defer();return event.kill();}return this.parent.keydown(event);}});e.exports=l;});
__d("ChatTypeaheadDataSource",["Arbiter","AvailableListConstants","Class","DataSource","Env","JSLogger","OrderedFriendsList","Run","ShortProfiles","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableListConstants'),i=b('Class'),j=b('DataSource'),k=b('Env'),l=b('JSLogger'),m=b('OrderedFriendsList'),n=b('Run'),o=b('ShortProfiles'),p=b('copyProperties');function q(r){this.parent.construct(this,r);this.persistOnRefresh=r.persistOnRefresh!==false;this.showOfflineUsers=!!r.showOfflineUsers;this._jslog=l.create('chat_typeahead');this._jslog.log('created');}i.extend(q,j);p(q.prototype,{init:function(){this._jslog.log('init');this.parent.init();var r=g.subscribe(h.ON_AVAILABILITY_CHANGED,this._update.shield(this));this._update();if(!this.persistOnRefresh)n.onLeave(function(){r.unsubscribe();});},bootstrap:function(){this._jslog.log('bootstrap');this.parent.bootstrap();if(this.showOfflineUsers){this._jslog.log('show_offline_users');this._jslog.log('ensured_short_profiles');if(o.hasAll()){this._update();}else{this._jslog.log('fetch_all_short_profiles');o.fetchAll();this.inform('activity',{activity:true});var r=o.subscribe('updated',function(){this.inform('activity',{activity:false});this._update();}.bind(this));if(!this.persistOnRefresh)n.onLeave(function(){o.unsubscribe(r);});}}},_update:function(){d(['AvailableList'],function(r){var s=this.value;this.dirty();var t=o.getCachedProfileIDs(),u=t.filter(function(w){var x=o.getNow(w);return x.type==='friend';});u.sort(m.compare);var v=[];u.forEach(function(w){if(w==k.user)return;var x=r.get(w);if(!this.showOfflineUsers&&x!==r.ACTIVE)return;var y=o.getNow(w);v.push({uid:w,text:y.name,tokens:y.additionalName,localized_text:y.name,additional_text:y.additionalName,photo:y.thumbSrc,availability:x,type:y.type});}.bind(this));if(v.length)this.addEntries(v);this.value=s;if(s)this.respond(s,this.buildUids(s,[],this._exclusions),true);}.bind(this));},refreshData:function(){d(['AvailableList'],function(r){r.update();}.bind(this));}});e.exports=q;});
__d("ChatTypeaheadRenderer",["AvailableListConstants","DOM","PresencePrivacy"],function(a,b,c,d,e,f){var g=b('AvailableListConstants'),h=b('DOM'),i=b('PresencePrivacy');function j(k,l){var m='offline';switch(k.availability){case g.ACTIVE:m='active';break;case g.IDLE:m='idle';break;case g.MOBILE:m='mobile';break;}if(!i.allows(k.uid))m='invis';var n=[];if(k.photo)n.push(h.create('img',{alt:'',src:k.photo}));if(k.text)n.push(h.create('span',{className:'text'},[k.text]));n.push(h.create('i',{className:m}));return h.create('li',{className:'clearfix '+m},n);}e.exports=j;});
__d("ChatBehavior",["Arbiter","AvailableList","AvailableListConstants","ChatConfig","copyProperties","MercuryConstants","ChatSidebarCalloutData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableList'),i=b('AvailableListConstants'),j=b('ChatConfig'),k=b('copyProperties'),l=c('MercuryConstants').ChatNotificationConstants,m=c('ChatSidebarCalloutData').isShown,n=h.getWebChatNotification(),o=m,p=true,q=k(new g(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return n!==l.NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return o;},showsTabUnreadUI:function(){if(j.get('web_messenger_suppress_tab_unread'))return p;return true;}});function r(){q.inform(q.ON_CHANGED);}h.subscribe(i.ON_CHAT_NOTIFICATION_CHANGED,function(){var s=n,t=h.getWebChatNotification();n=t;if(s!=t)r();});g.subscribe('chat/set_does_page_occlude_tabs',function(s,t){o=!!t;r();});g.subscribe('chat/set_show_tab_unread_ui',function(s,t){p=!!t;r();});e.exports=q;});
__d("legacy:ChatTypeaheadBehavior",["ChatTypeaheadBehavior"],function(a,b,c,d){var e=b('ChatTypeaheadBehavior');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.chatTypeahead=function(f){f.enableBehavior(e);};},3);
__d("RangedCallbackManager",["CallbackManagerController","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){var g=b('CallbackManagerController'),h=b('copyProperties'),i=b('createObjectFrom'),j=function(k,l,m){this._resources=[];this._reachedEndOfArray=false;this._error=false;this._existingIDs={};this._controller=new g(this._constructCallbackArg.bind(this));this._getValueHandler=k;this._compareValuesHandler=l;this._skipOnStrictHandler=m;};h(j.prototype,{executeOrEnqueue:function(k,l,m,n){return this._controller.executeOrEnqueue({start:k,limit:l},m,{strict:!!n});},unsubscribe:function(k){this._controller.unsubscribe(k);},getUnavailableResources:function(k){var l=this._controller.getRequest(k),m=[];if(l&&!this._reachedEndOfArray){var n=l.request,o=this._filterForStrictResults(l.options),p=n.start+n.limit;for(var q=o.length;q<p;q++)m.push(q);}return m;},addResources:function(k){k.forEach(function(l){if(!this._existingIDs[l]){this._existingIDs[l]=true;this._resources.push(l);this._error=null;}}.bind(this));this.resortResources();this._controller.runPossibleCallbacks();},addResourcesWithoutSorting:function(k,l){var m=this._resources.slice(0,l);m=m.concat(k);m=m.concat(this._resources.slice(l));this._resources=m;h(this._existingIDs,i(k,true));this._error=null;this._controller.runPossibleCallbacks();},removeResources:function(k){k.forEach(function(l){if(this._existingIDs[l]){this._existingIDs[l]=false;this._resources.remove(l);}}.bind(this));},removeAllResources:function(){this._resources=[];this._existingIDs={};},resortResources:function(){this._resources=this._resources.sort(function(k,l){return this._compareValuesHandler(this._getValueHandler(k),this._getValueHandler(l));}.bind(this));},setReachedEndOfArray:function(){if(!this._reachedEndOfArray){this._reachedEndOfArray=true;this._error=null;this._controller.runPossibleCallbacks();}},hasReachedEndOfArray:function(){return this._reachedEndOfArray;},setError:function(k){if(this._error!==k){this._error=k;this._controller.runPossibleCallbacks();}},getError:function(k,l,m){var n=this._filterForStrictResults({strict:m});return k+l>n.length?this._error:null;},hasResource:function(k){return this._existingIDs[k];},getResourceAtIndex:function(k){return this._resources[k];},getAllResources:function(){return this._resources.concat();},getCurrentArraySize:function(){return this._resources.length;},_filterForStrictResults:function(k){var l=this._resources;if(k&&k.strict&&this._skipOnStrictHandler)l=l.filter(this._skipOnStrictHandler);return l;},_constructCallbackArg:function(k,l){var m=this._filterForStrictResults(l);if(!this._reachedEndOfArray&&!this._error&&k.start+k.limit>m.length){return false;}else{var n=m.slice(k.start,k.start+k.limit),o=k.start+k.limit>m.length?this._error:null;return [n,o];}},getElementsUntil:function(k){var l=[];for(var m=0;m<this._resources.length;m++){var n=this._getValueHandler(this._resources[m]);if(this._compareValuesHandler(n,k)>0)break;l.push(this._resources[m]);}return l;}});e.exports=j;});
__d("TimestampConverter",["JSLogger"],function(a,b,c,d,e,f){var g=b('JSLogger'),h=g.create('timestamp_converter');function i(k){return (typeof(k)=='string')&&k.length>6;}var j={convertActionIDToTimestamp:function(k){if(i(k)){var l=k.slice(0,-6);return parseInt(l,10);}},maxValidActionID:function(k,l){if(!i(k))return l;if(!i(l))return k;return this.isGreaterThan(k,l)?k:l;},isGreaterThan:function(k,l){if(!i(k)||!i(l))return false;return this.convertActionIDToTimestamp(k)>this.convertActionIDToTimestamp(l);}};e.exports=j;});
__d("MercuryFolders",["array-extensions","MercuryConstants"],function(a,b,c,d,e,f){b('array-extensions');var g=c('MercuryConstants'),h=[g.MessagingTag.INBOX,g.MessagingTag.OTHER,g.MessagingTag.ACTION_ARCHIVED,g.MessagingTag.SPAM],i={getSupportedFolders:function(){return h.concat();},isSupportedFolder:function(j){return h.contains(j);},getFromMeta:function(j){var k=j.folder;if(j.is_archived)k=g.MessagingTag.ACTION_ARCHIVED;return k;}};e.exports=i;});
__d("MercuryIDs",[],function(a,b,c,d,e,f){function g(h){return typeof h==='string'&&h.indexOf(':')!==-1;}e.exports={isValid:function(h){if(!h)return false;return g(h);},tokenize:function(h){if(!this.isValid(h))throw 'bad_id_format';var i=h.indexOf(':');return {type:h.substr(0,i),value:h.substr(i+1)};}};});
__d("MercuryAssert",["MercuryIDs"],function(a,b,c,d,e,f){var g=b('MercuryIDs');e.exports={isParticipantID:function(h){if(!g.isValid(h))throw 'bad_participant_id';},allParticipantIDs:function(h){h.forEach(this.isParticipantID);},isUserParticipantID:function(h){var i=g.tokenize(h);if(i.type!='fbid')throw 'bad_user_id';},isEmailParticipantID:function(h){var i=g.tokenize(h);if(i.type!='email')throw 'bad_email_id';},allThreadID:function(h){h.forEach(this.isThreadID);},isThreadID:function(h){if(!g.isValid(h))throw 'bad_thread_id';}};});
__d("MercuryAttachment",["startsWith","MercuryConstants"],function(a,b,c,d,e,f){var g=b('startsWith'),h=c('MercuryConstants'),i={getAttachIconClass:function(j){switch(j){case h.MercuryAttachmentContentType.PHOTO:return 'MercuryPhotoIcon';case h.MercuryAttachmentContentType.VIDEO:return 'MercuryVideoIcon';case h.MercuryAttachmentContentType.MUSIC:return 'MercuryMusicIcon';case h.MercuryAttachmentContentType.TEXT:return 'MercuryTextIcon';case h.MercuryAttachmentContentType.MSWORD:return 'MercuryMSWordIcon';case h.MercuryAttachmentContentType.MSXLS:return 'MercuryMSXLSIcon';case h.MercuryAttachmentContentType.MSPPT:return 'MercuryMSPPTIcon';}return 'MercuryDefaultIcon';},getAttachIconClassByMime:function(j){if(g(j,'image')){return 'MercuryPhotoIcon';}else if(g(j,'video')){return 'MercuryVideoIcon';}else if(g(j,'audio')){return 'MercuryMusicIcon';}else if(g(j,'text/plain')){return 'MercuryTextIcon';}else return 'MercuryDefaultIcon';},getAttachTypeByMime:function(j){if(g(j,'image')){return h.MercuryAttachmentContentType.PHOTO;}else if(g(j,'video')){return h.MercuryAttachmentContentType.VIDEO;}else if(g(j,'audio')){return h.MercuryAttachmentContentType.MUSIC;}else if(g(j,'text/plain')){return h.MercuryAttachmentContentType.TEXT;}else return h.MercuryAttachmentContentType.UNKNOWN;},convertRaw:function(j){var k=[];for(var l=0;l<j.length;l++){var m=j[l];if(m.filename){var n={};n.attach_type=h.MercuryAttachmentType.FILE;n.name=m.filename;n.icon_type=i.getAttachTypeByMime(m.filetype);n.url='#';k.push(n);}}return k;}};e.exports=i;});
__d("MercuryMessageIDs",["KeyedCallbackManager"],function(a,b,c,d,e,f){var g=b('KeyedCallbackManager'),h=new g(),i={getServerIDs:function(j,k){var l=j.filter(function(n){return n.indexOf('mail.projektitan.com')!==-1;}),m=function(n){var o=j.map(function(p){return n[p]?n[p]:p;});k(o);};return h.executeOrEnqueue(l,m);},addServerID:function(j,k){h.setResource(j,k);}};e.exports=i;});
__d("MercuryThreadInformer",["Arbiter","copyProperties","MercuryAssert"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('MercuryAssert'),j={},k={},l={},m=false,n=false,o=false,p={},q={},r={},s=0;function t(){if(!s){var v=j,w=k,x=l,y=m,z=n,aa=o,ba=p,ca=q,da=r;j={};k={};l={};m=false;n=false;o=false;p={};q={};r={};var ea=Object.keys(w);if(ea.length||y)u.inform('threadlist-updated',ea);if(ea.length)u.inform('threads-updated',w);for(var fa in x){u.inform('thread-read-changed',x);break;}for(var fa in v){u.inform('threads-deleted',v);break;}if(z)u.inform('unseen-updated',null);if(aa)u.inform('unread-updated',null);for(fa in ba){u.inform('messages-received',ba);break;}for(fa in ca){u.inform('messages-reordered',ca);break;}for(fa in da){u.inform('messages-updated',da);break;}}}var u=h(new g(),{updatedThread:function(v){k[v]=true;t();},deletedThread:function(v){j[v]=true;t();},updatedThreadlist:function(){m=true;t();},updatedUnseenState:function(){n=true;t();},updatedUnreadState:function(){o=true;t();},changedThreadReadState:function(v,w,x){if(!l[v]||l[v].timestamp<x)l[v]={mark_as_read:w,timestamp:x};t();},receivedMessage:function(v){i.isThreadID(v.thread_id);var w=v.thread_id;if(!p[w])p[w]=[];p[w].push(v);u.updatedThread(w);},reorderedMessages:function(v,w){q[v]={source:w};t();},updatedMessage:function(v,w,x){if(!r[v])r[v]={};r[v][w]={source:x};t();},synchronizeInforms:function(v){s++;try{v();}catch(w){throw w;}finally{s--;t();}},listen:function(v,w){return u.subscribe('threads-updated',function(x,y){if(y[v])w(v);});}});e.exports=u;});
__d("MessagingReliabilityLogger",["function-extensions","copyProperties","isEmpty","PresenceUtil","Run","MercuryServerDispatcher","setTimeoutAcrossTransitions","MessagingReliabilityLoggerInitialData"],function(a,b,c,d,e,f){b('function-extensions');var g=b('copyProperties'),h=b('isEmpty'),i=b('PresenceUtil'),j=b('Run'),k=b('MercuryServerDispatcher'),l=b('setTimeoutAcrossTransitions'),m=c('MessagingReliabilityLoggerInitialData'),n='/ajax/mercury/client_reliability.php',o=60000;function p(v,w){var x={app:m.app,categories:JSON.stringify(v)};if(!h(w))x.extra=JSON.stringify(w);return x;}function q(v,w,x,y){if(v[w]===undefined)v[w]={};if(v[w][x]===undefined)v[w][x]=0;v[w][x]+=y;}function r(v,w,x,y){if(v[w]===undefined)v[w]={};if(v[w][x]===undefined)v[w][x]=[];for(var z=0;z<y.length;++z)v[w][x].push(y[z]);}function s(v,w){if(!v.categories||!w.categories)return;var x=JSON.parse(v.categories),y=v.extra?JSON.parse(v.extra):{},z=JSON.parse(w.categories),aa=w.extra?JSON.parse(w.extra):{};for(var ba in z){var ca=z[ba],da=aa[ba];for(var ea in ca){q(x,ba,ea,ca[ea]);if(da!==undefined){var fa=da[ea];if(fa!==undefined)r(y,ba,ea,fa);}}}return p(x,y);}var t={};t[n]={mode:k.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR,batch_function:s};k.registerEndpoints(t);var u={addEntry:function(v,w,x){if(!m.enabled)return;var y={};q(y,v,w,1);var z={};if(x!==undefined)r(z,v,w,[x]);k.trySend(n,p(y,z));}};(function v(){u.addEntry('page_event','active',i.getSessionID());l(v,o);})();e.exports=u;});
__d("MercuryServerRequests",["Arbiter","AsyncResponse","KeyedCallbackManager","TimestampConverter","copyProperties","Env","JSLogger","MercuryAssert","MercuryMessageIDs","MercuryServerDispatcher","MercuryThreadInformer","MercuryIDs","MessagingReliabilityLogger","createObjectFrom","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncResponse'),i=b('KeyedCallbackManager'),j=b('TimestampConverter'),k=b('copyProperties'),l=b('Env'),m=b('JSLogger'),n=b('MercuryAssert'),o=b('MercuryMessageIDs'),p=b('MercuryServerDispatcher'),q=b('MercuryThreadInformer'),r=b('MercuryIDs'),s=b('MessagingReliabilityLogger'),t=b('createObjectFrom'),u=c('MercuryConstants'),v=u.MercuryGenericConstants,w=0,x=m.create('mercury_server'),y=new i(),z=new i(),aa=[],ba={},ca={},da=u.MercuryAPIArgsSource&&u.MercuryAPIArgsSource.MERCURY;function ea(ab){if(ab)w=j.maxValidActionID(w,ab);}function fa(ab){var bb=ab.thread_id,cb=y.getResource(bb);if(!cb){if(ab.canonical_fbid){cb='user:'+ab.canonical_fbid;}else if(ab.root_message_threading_id)cb='root:'+ab.root_message_threading_id;cb=cb||'thread:'+bb;ga(bb,cb);}ab.thread_id=cb;}function ga(ab,bb){y.setResource(ab,bb);z.setResource(bb,ab);ca[ab]=bb;}function ha(ab,bb){var cb=z.executeOrEnqueue(ab,bb),db=z.getUnavailableResources(cb),eb=xa.tokenizeThreadID(ab);if(db.length&&eb.type!='root')xa.fetchThreadData(db);}function ia(ab){return z.getResource(ab);}function ja(ab){return !!y.getResource(ab);}function ka(ab){var bb=y.getResource(ab);if(typeof bb=='undefined')x.warn('no_client_thread_id',{server_id:ab});return bb;}function la(ab,bb){y.executeOrEnqueue(ab,bb);xa.ensureThreadIsFetched(ab);}function ma(ab,bb){if(ab.action_type!=u.MercuryActionType.SEND_MESSAGE)return;var cb=ab.client_thread_id;if(!cb)cb=ka(ab.thread_id);var db=null;if(cb)db=r.tokenize(cb).type;s.addEntry('send_'+db,bb,ab.thread_id+','+ab.message_id);}function na(ab){var bb=null;switch(ab.status){case u.MercuryActionStatus.SUCCESS:bb='success';break;case u.MercuryActionStatus.FAILED_UNKNOWN_REASON:bb='confirmed_error';break;case u.MercuryActionStatus.UNABLE_TO_CONFIRM:bb='confirm_error';break;default:return;}ma(ab,bb);}function oa(ab){(ab.message_counts||[]).forEach(function(jb){ea(jb.last_action_id);});(ab.threads||[]).forEach(function(jb){fa(jb);delete ba[jb.thread_id];delete ba[ia(jb.thread_id)];ea(jb.last_action_id);});(ab.ordered_threadlists||[]).forEach(function(jb){jb.thread_ids=jb.thread_ids.map(ka);});ab.actions=ab.actions||[];ab.actions.forEach(function(jb){na(jb);if(jb.status&&jb.status!=u.MercuryActionStatus.SUCCESS&&!jb.thread_id){jb.thread_id=jb.client_thread_id;return;}if(jb.action_type==u.MercuryActionType.SEND_MESSAGE&&jb.client_thread_id&&jb.client_thread_id!=v.PENDING_THREAD_ID)ga(jb.thread_id,jb.client_thread_id);jb.server_thread_id=jb.thread_id;jb.thread_id=ja(jb.thread_id)?ka(jb.thread_id):null;ea(jb.action_id);});if(ab.end_of_history){var bb=[];for(var cb=0;cb<ab.end_of_history.length;cb++){var db=ab.end_of_history[cb];if(db.type=='user'){bb.push('user:'+db.id);}else if(db.type=='thread'&&ja(db.id))bb.push(ka(db.id));}ab.end_of_history=bb;}if(ab.roger){var eb={};for(var fb in ab.roger){var gb=y.getResource(fb);if(gb){var hb=ab.roger[fb];eb[gb]={};for(var ib in hb)eb[gb]['fbid:'+ib]=hb[ib];}}ab.roger=eb;}}function pa(){if(aa&&aa.length){var ab=aa[0];aa=aa.slice(1);xa.handleUpdate(ab);}}function qa(ab,bb){var cb=k({},ab),db;if(bb.threads){if(!cb.threads)cb.threads={};for(db in bb.threads)cb.threads[db]=Object.keys(t((cb.threads[db]||[]).concat(bb.threads[db])));}if(bb.messages){if(!cb.messages)cb.messages={};for(db in bb.messages){if(!cb.messages[db])cb.messages[db]={};for(var eb in bb.messages[db])if(cb.messages[db][eb]){cb.messages[db][eb]=ta(cb.messages[db][eb],bb.messages[db][eb]);}else cb.messages[db][eb]=bb.messages[db][eb];}}cb.client=ab.client||bb.client;return cb;}function ra(ab,bb){var cb=k(t(ab.folders,true),t(bb.folders,true)),db=ab.client||bb.client;return {folders:Object.keys(cb),client:db};}function sa(ab,bb){for(var cb in bb)if(ab[cb]&&typeof ab[cb]==='object'){ab[cb]=ta(ab[cb],bb[cb]);}else if(bb[cb]&&typeof bb[cb]==='object'){var db={};k(db,bb[cb]);ab[cb]=db;}return ab;}function ta(ab,bb){var cb=ab.offset<bb.offset?ab.offset:bb.offset,db=ab.offset+ab.limit,eb=bb.offset+bb.limit,fb=(db>eb)?db:eb,gb=fb-cb;return {offset:cb,limit:gb};}function ua(ab,bb){var cb=ab.client||bb.client,db={ids:{},client:cb};k(db.ids,ab.ids);k(db.ids,bb.ids);return db;}function va(ab,bb){var cb={},db,eb=ab.client||bb.client;delete ab.client;delete bb.client;for(db in ab)k(cb,t(ab[db],db));for(db in bb)k(cb,t(bb[db],db));var fb={client:eb};for(var gb in cb){db=cb[gb];if(!fb[db])fb[db]=[];fb[db].push(gb);}return fb;}function wa(ab,bb){var cb=ab.client||bb.client,db=t(ab.ids,true),eb=t(bb.ids,true),fb=k(db,eb);return {ids:Object.keys(fb),client:cb};}var xa=k(new g(),{tokenizeThreadID:function(ab){n.isThreadID(ab);return r.tokenize(ab);},getServerThreadID:function(ab,bb){n.isThreadID(ab);ha(ab,bb);},getClientThreadID:function(ab,bb){la(ab,bb);},getClientThreadIDNow:function(ab){return ka(ab);},getServerThreadIDNow:function(ab){return ia(ab);},convertThreadIDIfAvailable:function(ab){var bb=y.getResource(ab);if(bb===undefined){return ab;}else return bb;},canLinkExternally:function(ab){n.isThreadID(ab);var bb=xa.tokenizeThreadID(ab);return (bb.type=='user')||!!ia(ab);},fetchThreadlistInfo:function(ab,bb,cb,db,eb){cb=cb||u.MessagingTag.INBOX;eb=eb||da;var fb=db?p.IMMEDIATE:null,gb={client:eb};gb[cb]={offset:ab,limit:bb,filter:db};p.trySend('/ajax/mercury/threadlist_info.php',gb,fb);},fetchUnseenThreadIDs:function(ab,bb){bb=bb||da;xa.fetchThreadlistInfo(u.MercuryThreadlistConstants.RECENT_THREAD_OFFSET,u.MercuryThreadlistConstants.JEWEL_THREAD_COUNT,ab,null,bb);},fetchUnreadThreadIDs:function(ab,bb){bb=bb||da;p.trySend('/ajax/mercury/unread_threads.php',{folders:[ab],client:bb});},fetchMissedMessages:function(ab,bb){bb=bb||da;p.trySend('/ajax/mercury/thread_sync.php',{last_action_id:w,folders:ab,client:bb});},fetchThreadData:function(ab,bb){bb=bb||da;n.allThreadID(ab);var cb={threads:{},client:bb},db=[],eb=[],fb=[];ab.forEach(function(hb){if(ba[hb])return;ba[hb]=true;var ib=ia(hb);if(ib){eb.push(ib);cb.threads.thread_ids=eb;}else{var jb=xa.tokenizeThreadID(hb);if(jb.type=='user'){db.push(jb.value);cb.threads.user_ids=db;}else if(jb.type=='group'){fb.push(jb.value);cb.threads.group_ids=fb;}else if(jb.type=='thread'){eb.push(jb.value);cb.threads.thread_ids=eb;}else if(jb.type!='root'&&jb.type!='pending')throw new Error('Unknown thread type',jb);}});xa.inform("fetch-thread-data",cb);for(var gb in cb.threads){p.trySend('/ajax/mercury/thread_info.php',cb);break;}},ensureThreadIsFetched:function(ab,bb){bb=bb||da;if(!y.getResource(ab)&&!ba[ab]){ba[ab]=true;p.trySend('/ajax/mercury/thread_info.php',{threads:{thread_ids:[ab]},client:bb});}},fetchThreadMessages:function(ab,bb,cb,db,eb){n.isThreadID(ab);eb=eb||da;var fb,gb,hb=xa.tokenizeThreadID(ab),ib=ia(ab),jb=false;if(ib&&hb.type!='group'){gb='thread_ids';fb=ib;}else{fb=hb.value;switch(hb.type){case 'user':gb='user_ids';jb=true;break;case 'group':gb='group_ids';break;case 'thread':gb='thread_ids';break;}}var kb={messages:{},threads:{},client:eb};if(gb){kb.messages[gb]={};kb.messages[gb][fb]={offset:bb,limit:cb};if(jb)kb.threads[gb]=[fb];p.trySend('/ajax/mercury/thread_info.php',kb,db);}else ha(ab,function(lb){kb.messages.thread_ids={};kb.messages.thread_ids[lb]={offset:bb,limit:cb};p.trySend('/ajax/mercury/thread_info.php',kb,db);});},handleThreadInfoError:function(ab){var bb=ab.getRequest().getData(),cb=[];if(bb.messages){for(var db in bb.messages.thread_ids)cb.push(ya(ka(db)));for(var eb in bb.messages.user_ids)cb.push(ya('user:'+eb));for(var fb in bb.messages.group_ids)cb.push(ya('group:'+fb));}if(cb.length)xa.handleUpdate({actions:cb,from_client:true,payload_source:u.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE});if(bb.threads&&(bb.threads.user_ids||bb.threads.group_ids||bb.threads.thread_ids)&&!bb.is_retry){if(bb.messages)delete bb.messages;x.log('retry_thread',bb);bb.is_retry=true;p.trySend('/ajax/mercury/thread_info.php',bb);}},markFolderAsRead:function(ab){p.trySend('/ajax/mercury/mark_folder_as_read.php',{folder:ab});var bb=[{action_type:u.MercuryGlobalActionType.MARK_ALL_READ,action_id:null,folder:ab}];xa.handleUpdate({global_actions:bb,from_client:true,payload_source:u.MercuryPayloadSource.CLIENT_CHANGE_READ_STATUS});},changeThreadReadStatus:function(ab,bb,cb){n.isThreadID(ab);ha(ab,function(eb){var fb={ids:{}};fb.ids[eb]=bb;p.trySend('/ajax/mercury/change_read_status.php',fb);});var db=[{action_type:u.MercuryActionType.CHANGE_READ_STATUS,action_id:null,thread_id:ab,mark_as_read:bb,folder:cb}];xa.handleUpdate({actions:db,from_client:true,payload_source:u.MercuryPayloadSource.CLIENT_CHANGE_READ_STATUS});},changeThreadArchivedStatus:function(ab,bb){n.isThreadID(ab);ha(ab,function(eb){var fb={ids:{}};fb.ids[eb]=bb;p.trySend('/ajax/mercury/change_archived_status.php',fb);});var cb={action_type:u.MercuryActionType.CHANGE_ARCHIVED_STATUS,action_id:null,thread_id:ab,archived:bb},db={actions:[cb],from_client:true,payload_source:u.MercuryPayloadSource.CLIENT_CHANGE_ARCHIVED_STATUS};xa.handleUpdate(db);},changeThreadFolder:function(ab,bb){n.isThreadID(ab);ha(ab,function(eb){var fb={};fb[bb]=[eb];p.trySend('/ajax/mercury/move_thread.php',fb);});var cb={action_type:u.MercuryActionType.CHANGE_FOLDER,action_id:null,thread_id:ab,new_folder:bb},db={actions:[cb],from_client:true,payload_source:u.MercuryPayloadSource.CLIENT_CHANGE_FOLDER};xa.handleUpdate(db);},markThreadSpam:function(ab){n.isThreadID(ab);ha(ab,function(db){p.trySend('/ajax/mercury/mark_spam.php',{id:db});});var bb={action_type:u.MercuryActionType.CHANGE_FOLDER,action_id:null,thread_id:ab,new_folder:u.MessagingTag.SPAM},cb={actions:[bb],from_client:true,payload_source:u.MercuryPayloadSource.CLIENT_CHANGE_FOLDER};xa.handleUpdate(cb);},unmarkThreadSpam:function(ab){n.isThreadID(ab);ha(ab,function(db){p.trySend('/ajax/mercury/unmark_spam.php',{id:db});});var bb={action_type:u.MercuryActionType.CHANGE_FOLDER,action_id:null,thread_id:ab,new_folder:u.MessagingTag.INBOX},cb={actions:[bb],from_client:true,payload_source:u.MercuryPayloadSource.CLIENT_CHANGE_FOLDER};xa.handleUpdate(cb);},deleteThread:function(ab){n.isThreadID(ab);ha(ab,function(db){var eb={ids:[db]};p.trySend('/ajax/mercury/delete_thread.php',eb);});var bb={action_type:u.MercuryActionType.DELETE_THREAD,action_id:null,thread_id:ab},cb={actions:[bb],from_client:true,payload_source:u.MercuryPayloadSource.CLIENT_DELETE_THREAD};xa.handleUpdate(cb);},deleteMessages:function(ab,bb,cb){o.getServerIDs(bb||[],function(eb){p.trySend('/ajax/mercury/delete_messages.php',{message_ids:eb});});var db;if(cb){db={action_type:u.MercuryActionType.DELETE_THREAD,action_id:null,thread_id:ab};}else db={action_type:u.MercuryActionType.DELETE_MESSAGES,action_id:null,thread_id:ab,message_ids:bb};xa.handleUpdate({actions:[db],from_client:true,payload_source:u.MercuryPayloadSource.CLIENT_DELETE_MESSAGES});},clearChat:function(ab,bb,cb){n.isThreadID(ab);p.trySend('/ajax/chat/settings.php',{clear_history_id:bb});var db=[{action_type:u.MercuryActionType.CLEAR_CHAT,action_id:null,thread_id:ab,clear_time:cb}];xa.handleUpdate({actions:db,from_client:true,payload_source:u.MercuryPayloadSource.CLIENT_CLEAR_CHAT});},_batchThreadRead:function(ab,bb){var cb={};k(cb,ab.ids);k(cb,bb.ids);var db=ab.client||bb.client;return {ids:cb,client:db};},sendNewMessage:function(ab,bb){bb=bb||da;o.getServerIDs(ab.forward_message_ids||[],function(db){var eb=xa.tokenizeThreadID(ab.thread_id),fb=eb.type,gb=k({},ab);gb.forward_message_ids=db;if((fb=='root'&&eb.value==gb.message_id)||(fb=='user')||(ab.thread_id==v.PENDING_THREAD_ID)){gb.client_thread_id=gb.thread_id;gb.thread_id=null;xa._sendNewMessageToServer(gb,bb);}else ha(gb.thread_id,function(hb){gb.thread_id=hb;xa._sendNewMessageToServer(gb);});});if(ab.thread_id!=v.PENDING_THREAD_ID){var cb={actions:[k({},ab)],from_client:true,payload_source:u.MercuryPayloadSource.CLIENT_SEND_MESSAGE};xa.handleUpdate(cb);}},_sendNewMessageToServer:function(ab,bb){bb=bb||da;p.trySend('/ajax/mercury/send_messages.php',{message_batch:[ab],client:bb});},_batchMessageSend:function(ab,bb){var cb=ab.client||bb.client;return {client:cb,message_batch:ab.message_batch.concat(bb.message_batch)};},requestMessageConfirmation:function(ab,bb){bb=bb||da;var cb={},db={};for(var eb in ab){var fb=ia(eb);if(fb){cb[fb]=ab[eb];}else{var gb=ab[eb];for(var hb=0;hb<gb.length;hb++)db[gb[hb]]=eb;}}var ib=Object.keys(cb),jb=Object.keys(db);if(ib.length||jb.length)p.trySend('/ajax/mercury/confirm_messages.php',{thread_message_map:cb,local_messages:db,client:bb});},handleMessageConfirmError:function(ab){var bb=ab.getRequest().getData().thread_message_map,cb=ab.getRequest().getData().local_messages;if(!bb&&!cb)return;var db=[];for(var eb in bb){var fb=bb[eb];fb.forEach(function(ib){db.push({action_type:u.MercuryActionType.SEND_MESSAGE,client_message_id:ib,message_id:ib,client_thread_id:null,thread_id:eb,status:u.MercuryActionStatus.UNABLE_TO_CONFIRM});});}for(var gb in cb){var hb=cb[gb];db.push({action_type:u.MercuryActionType.SEND_MESSAGE,client_message_id:gb,message_id:gb,client_thread_id:hb,thread_id:null,status:u.MercuryActionStatus.UNABLE_TO_CONFIRM});}if(db.length)xa.handleUpdate({actions:db,payload_source:u.MercuryPayloadSource.CLIENT_HANDLE_ERROR});},markSeen:function(){var ab=j.convertActionIDToTimestamp(w);p.trySend('/ajax/mercury/mark_seen.php',{seen_timestamp:ab});},_batchMarkSeen:function(ab,bb){return bb;},handleRoger:function(ab){var bb=ab.tid?y.getResource(ab.tid):('user:'+ab.reader);if(bb){var cb={};cb[bb]={};cb[bb]['fbid:'+ab.reader]=ab.time;xa.inform('update-roger',cb);}},handleUpdateWaitForThread:function(ab,bb,cb){cb=cb||da;var db=y.getResource(bb);if(db){xa.handleUpdate(ab);return;}y.executeOrEnqueue(bb,function(){aa.push(ab);});if(!ba[bb]){ba[bb]=true;p.trySend('/ajax/mercury/thread_info.php',{threads:{thread_ids:[bb]},client:cb});}},handleUpdate:function(ab){x.debug('handle_update',{payload:ab,from_client:ab.from_client});for(var bb in ab){q.synchronizeInforms(function(){if(!ab.from_client){oa(ab);xa.inform('payload-preprocessed',ab);}xa.inform('update-thread-ids',ca);ca={};xa.inform('update-participants',ab);xa.inform('update-threads',ab);xa.inform('update-unread',ab);xa.inform('update-threadlist',ab);xa.inform('update-messages',ab);xa.inform('update-unseen',ab);xa.inform('update-typing-state',ab);xa.inform('update-roger',ab.roger);xa.inform('model-update-completed',null);pa();});break;}},_handleSendMessageErrorCommon:function(ab,bb){x.debug('handle_send_message_error_common',{response:ab,request_error_status:bb});var cb=ab.getPayload(),db=ab.getRequest().getData(),eb=db.message_batch;if(!eb){ma({action_type:u.MercuryActionType.SEND_MESSAGE,status:u.MercuryActionStatus.REQUEST_EMPTY_MESSAGE_LIST});return;}var fb,gb=null;if(cb&&cb.error_payload){fb=u.MercuryActionStatus.UNCONFIRMED;gb='send_error';}else{gb=bb==u.MercuryActionStatus.REQUEST_ERROR?'request_error':'transport_error';if(ab.getError())gb+='_'+ab.getError();fb=bb;}var hb=eb.map(function(jb){return {action_type:u.MercuryActionType.SEND_MESSAGE,client_message_id:jb.message_id,message_id:jb.message_id,client_thread_id:jb.client_thread_id,thread_id:jb.thread_id,status:fb};});hb.forEach(function(jb){ma(jb,gb);});var ib={actions:hb,payload_source:u.MercuryPayloadSource.CLIENT_HANDLE_ERROR};xa.handleUpdate(ib);},handleSendMessageError:function(ab){if(ab.error===1404074)h.verboseErrorHandler(ab);xa._handleSendMessageErrorCommon(ab,u.MercuryActionStatus.REQUEST_ERROR);},handleSendMessageTransportError:function(ab){xa._handleSendMessageErrorCommon(ab,u.MercuryActionStatus.TRANSPORT_ERROR);},getLastActionID:function(){return w;}});function ya(ab){return {action_type:u.MercuryActionType.LOG_MESSAGE,thread_id:ab,message_id:ab,timestamp:Date.now(),timestamp_absolute:'',timestamp_relative:'',is_unread:false,source:u.MercurySourceType.UNKNOWN,log_message_type:u.MercuryLogMessageType.SERVER_ERROR,log_message_data:{}};}var za=xa.handleUpdate;p.registerEndpoints({'/ajax/mercury/thread_sync.php':{mode:p.IDEMPOTENT,handler:za},'/ajax/mercury/thread_info.php':{mode:p.BATCH_DEFERRED_MULTI,batch_function:qa,handler:za,error_handler:xa.handleThreadInfoError},'/ajax/mercury/mark_folder_as_read.php':{mode:p.IMMEDIATE,handler:za},'/ajax/mercury/change_read_status.php':{mode:p.BATCH_SUCCESSIVE,batch_function:xa._batchThreadRead,handler:za},'/ajax/mercury/send_messages.php':{mode:p.BATCH_SUCCESSIVE,batch_function:xa._batchMessageSend,handler:za,error_handler:xa.handleSendMessageError,transport_error_handler:xa.handleSendMessageTransportError},'/ajax/mercury/mark_seen.php':{mode:p.BATCH_SUCCESSIVE,batch_function:xa._batchMarkSeen,handler:za},'/ajax/mercury/confirm_messages.php':{mode:p.IMMEDIATE,handler:za,error_handler:xa.handleMessageConfirmError},'/ajax/mercury/threadlist_info.php':{mode:p.BATCH_SUCCESSIVE_UNIQUE,batch_function:sa,handler:za},'/ajax/mercury/mark_spam.php':{mode:p.IMMEDIATE,handler:za},'/ajax/mercury/unmark_spam.php':{mode:p.IMMEDIATE,handler:za},'/ajax/mercury/unread_threads.php':{mode:p.BATCH_SUCCESSIVE_UNIQUE,batch_function:ra,handler:za},'/ajax/chat/settings.php':{mode:p.IMMEDIATE},'/ajax/mercury/change_archived_status.php':{mode:p.BATCH_SUCCESSIVE,batch_function:ua,handler:za},'/ajax/mercury/delete_thread.php':{mode:p.BATCH_SUCCESSIVE,batch_function:wa,handler:za},'/ajax/mercury/delete_messages.php':{mode:p.IMMEDIATE,handler:za},'/ajax/mercury/move_thread.php':{mode:p.BATCH_SUCCESSIVE,batch_function:va,handler:za}});e.exports=xa;});
__d("MercuryParticipants",["Env","getObjectValues","MercuryAssert","MercuryIDs","ShortProfiles","MercuryServerRequests","copyProperties","tx","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Env'),h=b('getObjectValues'),i=b('MercuryAssert'),j=b('MercuryIDs'),k=b('ShortProfiles'),l=b('MercuryServerRequests'),m=b('copyProperties'),n=b('tx'),o=c('MercuryConstants'),p='fbid:'+g.user,q={},r={},s=function(w){w=u(w);if(!q[w.id]){q[w.id]=m({},w);if(w.vanity)r[w.vanity]=w.id;}};function t(w){i.isEmailParticipantID(w);var x=j.tokenize(w),y=x.value;return {gender:o.MercuryParticipantsConstants.UNKNOWN_GENDER,href:null,id:w,image_src:o.MercuryParticipantsConstants.EMAIL_IMAGE,name:y,short_name:y,employee:false,call_promo:false};}function u(w){var x=w.type===o.MercuryParticipantTypes.USER||w.type===o.MercuryParticipantTypes.FRIEND;if(!x)return w;if(!w.name&&!w.href&&!w.vanity){var y="Facebook User";w.name=y;w.short_name=y;}return w;}var v={user:p,getIDFromVanityOrFBID:function(w){if(!w)return;if(r[w])return r[w];if(w.match('^\\d+$'))return v.getIDForUser(w);},getNow:function(w){return q[w];},get:function(w,x){i.isParticipantID(w);v.getMulti([w],function(y){x(y[w]);});},getMulti:function(w,x){i.allParticipantIDs(w);var y={},z={};w.forEach(function(ba){if(q[ba]){y[ba]=m({},q[ba]);}else{var ca=j.tokenize(ba);if(ca.type=='fbid'){var da=ca.value;z[ba]=da;}else if(ca.type=='email')y[ba]=t(ba);}});var aa=h(z);if(aa.length){k.getMulti(aa,function(ba){for(var ca in z){var da=z[ca],ea=ba[da];y[ca]={gender:ea.gender,href:ea.uri,id:ca,image_src:ea.thumbSrc,name:ea.name,short_name:ea.firstName,employee:ea.employee,call_promo:ea.showVideoPromo,type:ea.type,vanity:ea.vanity};s(y[ca]);}x(y);});}else x(y);},getUserID:function(w){if(!j.isValid(w))return null;var x=j.tokenize(w);if(x.type!='fbid')return null;return x.value;},getIDForUser:function(w){return 'fbid:'+w;},addParticipants:function(w){w.forEach(s);}};l.subscribe('update-participants',function(w,x){v.addParticipants(x.participants||[]);});e.exports=v;});
__d("MercuryThreads",["Arbiter","copyProperties","JSLogger","createObjectFrom","KeyedCallbackManager","TimestampConverter","MercuryFolders","MercuryAssert","MercuryAttachment","MercuryIDs","MercuryServerRequests","MercuryThreadInformer","MercuryParticipants","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('JSLogger'),j=b('createObjectFrom'),k=b('KeyedCallbackManager'),l=b('TimestampConverter'),m=b('MercuryFolders'),n=b('MercuryAssert'),o=b('MercuryAttachment'),p=b('MercuryIDs'),q=b('MercuryServerRequests'),r=b('MercuryThreadInformer'),s=b('MercuryParticipants'),t=c('MercuryConstants'),u=i.create('mercury_threads'),v=new k();function w(ha,ia){var ja=j(ha.participants,true),ka=s.user;ia.forEach(function(la){if(ja[la]!==true){ha.participants.push(la);if(la===ka)ha.is_subscribed=true;}});}function x(ha,ia){ha.participants.remove(ia);if(ia===s.user)ha.is_subscribed=false;}function y(ha,ia){if(ha.participants[0]!=ia){ha.participants.remove(ia);ha.participants.unshift(ia);}}function z(ha,ia){var ja=ia.body,ka=ia.subject,la='';if(ka){ka=ka.toLowerCase();if(ja.slice(0,ka.length).toLowerCase()==ka){la=ja;}else if(ja){la=ka+' \u00B7 '+ja;}else la=ka;}else la=ja;ha.snippet=la;ha.snippet_has_attachment=ia.has_attachment;if(ia.raw_attachments&&ia.raw_attachments.length>0){var ma=o.convertRaw(ia.raw_attachments);ha.snippet_attachments=ma;}else ha.snippet_attachments=ia.attachments;ha.is_forwarded_snippet=!!ia.forward_count;ha.snippet_sender=ia.author;}function aa(ha,ia){if(!ha)return false;var ja=!ha.unread_count;if(ia==ja)return false;ha.unread_count=ia?0:1;v.setResource(ha.thread_id,ha);r.updatedThread(ha.thread_id);return true;}function ba(ha){var ia=v.getAllResources();for(var ja in ia){var ka=ia[ja];if(ka.folder==ha){ka.unread_count=0;v.setResource(ja,ka);r.updatedThread(ja);}}}function ca(ha,ia){if(!ha||ha.chat_clear_time===ia)return false;ha.chat_clear_time=ia;v.setResource(ha.thread_id,ha);r.reorderedMessages(ha.thread_id);return true;}function da(ha,ia,ja){var ka=ia.action_type;if(ka==t.MercuryActionType.USER_GENERATED_MESSAGE||ka==t.MercuryActionType.LOG_MESSAGE){ia.is_unread&&ha.unread_count++;ha.is_archived=false;}switch(ka){case t.MercuryActionType.USER_GENERATED_MESSAGE:y(ha,ia.author);break;case t.MercuryActionType.LOG_MESSAGE:var la=ia.log_message_type;if(la==t.MercuryLogMessageType.SUBSCRIBE){w(ha,ia.log_message_data.added_participants);}else if(la==t.MercuryLogMessageType.UNSUBSCRIBE){x(ha,ia.author);}else if(la==t.MercuryLogMessageType.THREAD_IMAGE){ha.image_src=ia.log_message_data.image?ia.log_message_data.image.preview_url:null;}else if(la==t.MercuryLogMessageType.THREAD_NAME)ha.name=ia.log_message_data.name;break;case t.MercuryActionType.CHANGE_READ_STATUS:if(ia.timestamp)r.changedThreadReadState(ha.thread_id,ia.mark_as_read,ia.timestamp);aa(ha,ia.mark_as_read);break;case t.MercuryActionType.CLEAR_CHAT:ca(ha,ia.clear_time);break;case t.MercuryActionType.CHANGE_ARCHIVED_STATUS:ha.is_archived=ia.archived;break;case t.MercuryActionType.CHANGE_FOLDER:ha.folder=ia.new_folder;break;case t.MercuryActionType.DELETE_MESSAGES:if(ja){ha.snippet='...';ha.snippet_has_attachment=false;ha.snippet_attachments=null;ha.snippet_sender=null;ha.is_forwarded_snippet=false;r.updatedThread(ia.thread_id);}break;}if(ia.action_id)ha.last_action_id=l.maxValidActionID(ia.action_id,ha.last_action_id);}function ea(ha){var ia=q.tokenizeThreadID(ha.thread_id);if(ia.type=='group'){u.error('invalid_new_thread_message',ha);return undefined;}var ja={thread_id:ha.thread_id,last_action_id:ha.action_id,participants:ha.specific_to_list,name:null,snippet:ha.body,snippet_has_attachment:false,snippet_attachments:[],snippet_sender:ha.author,unread_count:0,image_src:null,timestamp_absolute:ha.timestamp_absolute,timestamp_relative:ha.timestamp_relative,timestamp:ha.timestamp,canonical_fbid:ia.type=='user'?ia.value:null,is_canonical_user:ia.type=='user',is_canonical:ga(ha.specific_to_list),is_subscribed:true,root_message_threading_id:ha.message_id,folder:t.MessagingTag.INBOX,is_archived:false,mode:t.MercuryThreadMode.TITAN_ORIGINATED};v.setResource(ja.thread_id,ja);return ja;}g.subscribe(i.DUMP_EVENT,function(ha,ia){ia.messaging=ia.messaging||{};ia.messaging.threads=v.dumpResources();});var fa={getThreadMetaNow:function(ha){n.isThreadID(ha);return v.getResource(ha);},getThreadMeta:function(ha,ia,ja){n.isThreadID(ha);var ka=v.executeOrEnqueue(ha,ia),la=v.getUnavailableResources(ka);if(la.length){var ma=q.tokenizeThreadID(ha);if(ma.type=='user'){fa.getCanonicalThreadToUser(ma.value);}else q.fetchThreadData(la,ja);}return ka;},unsubscribe:function(ha){v.unsubscribe(ha);},changeThreadReadStatus:function(ha,ia){n.isThreadID(ha);var ja=v.getResource(ha);if(aa(ja,ia))q.changeThreadReadStatus(ha,ia,m.getFromMeta(ja));},changeThreadArchivedStatus:function(ha,ia){n.isThreadID(ha);var ja=v.getResource(ha);if(ja.is_archived!=ia){ja.is_archived=ia;r.updatedThread(ja.thread_id);q.changeThreadArchivedStatus(ha,ia);}},markThreadSpam:function(ha){q.markThreadSpam(ha);},unmarkThreadSpam:function(ha){q.unmarkThreadSpam(ha);},changeFolder:function(ha,ia){n.isThreadID(ha);var ja=v.getResource(ha);if(ja&&ja.folder!=ia){ja.folder=ia;r.updatedThread(ja.thread_id);q.changeThreadFolder(ha,ia);}},deleteThread:function(ha){n.isThreadID(ha);q.deleteThread(ha);},updateThreads:function(ha){if(!ha||!ha.length)return;var ia={};ha.forEach(function(ja){ia[ja.thread_id]=ja;});v.addResourcesAndExecute(ia);},updateMetadataByActions:function(ha,ia){if(!ha||!ha.length)return;var ja={},ka={},la={};for(var ma=0;ma<ha.length;ma++){var na=ha[ma];if(na.is_forward)continue;var oa=na.action_type,pa=na.thread_id;n.isThreadID(pa);var qa=fa.getThreadMetaNow(pa);if(oa==t.MercuryActionType.LOG_MESSAGE&&na.log_message_type==t.MercuryLogMessageType.SERVER_ERROR)continue;if(!qa&&!na.action_id&&oa==t.MercuryActionType.USER_GENERATED_MESSAGE)qa=ea(na);if(qa){if(oa==t.MercuryActionType.DELETE_THREAD){r.deletedThread(pa);continue;}var ra=!!na.action_id;if(oa==t.MercuryActionType.LOG_MESSAGE||oa==t.MercuryActionType.USER_GENERATED_MESSAGE)ra=!ia;if(na.timestamp<=qa.timestamp&&ra){u.log('ignore_old_timestamp',{action:na,from_client:ia,thread_timestamp:qa.timestamp});continue;}if(!la[pa])la[pa]=h({},qa);da(la[pa],na,ia);if(oa==t.MercuryActionType.USER_GENERATED_MESSAGE)ja[pa]=na;if(oa==t.MercuryActionType.USER_GENERATED_MESSAGE||oa==t.MercuryActionType.LOG_MESSAGE||oa==t.MercuryActionType.SEND_MESSAGE)if(na&&na.timestamp&&(!ka[pa]||na.timestamp>ka[pa].timestamp))ka[pa]=na;}}for(var sa in la){var ta=la[sa],ua=ja[sa];if(ua)z(ta,ua);var va=ka[sa],wa=ta.timestamp;if(va&&va.timestamp>wa)ta=h(ta,{timestamp_absolute:va.timestamp_absolute,timestamp_relative:va.timestamp_relative,timestamp:va.timestamp});v.setResource(sa,ta);}},getCanonicalThreadToUser:function(ha,ia,ja){return fa.getCanonicalThreadToParticipant('fbid:'+ha,ia,ja);},getCanonicalThreadToParticipant:function(ha,ia,ja){var ka=fa.getThreadIDForParticipant(ha),la=v.getResource(ka);if(typeof la=='undefined'){la=fa.createNewLocalThread(ka,[s.user,ha],ia);q.fetchThreadData([ka],ja);}return la;},getThreadIdForUser:function(ha){return 'user:'+ha;},getThreadIDForParticipant:function(ha){var ia=p.tokenize(ha);return fa.getThreadIdForUser(ia.value);},createNewLocalThread:function(ha,ia,ja){var ka=v.getResource(ha);if(!ka){var la=q.tokenizeThreadID(ha);ka={thread_id:ha,last_action_id:null,participants:ia,name:null,snippet:'',snippet_has_attachment:false,snippet_sender:null,unread_count:ja?ja:0,image_src:null,timestamp_absolute:null,timestamp_relative:null,timestamp:null,canonical_fbid:la.type=='user'?la.value:null,is_canonical_user:la.type=='user',is_canonical:ga(ia),is_subscribed:true,root_message_threading_id:null,folder:t.MessagingTag.INBOX,is_archived:false,mode:t.MercuryThreadMode.TITAN_ORIGINATED};v.setResource(ha,ka);}return ka;},addParticipantsToThreadLocally:function(ha,ia){var ja=v.getResource(ha);if(ja){w(ja,ia);r.updatedThread(ja.thread_id);}},getCanonicalUserInThread:function(ha){var ia=q.tokenizeThreadID(ha);return ia.type=='user'?ia.value:null;},getCanonicalGroupInThread:function(ha){var ia=q.tokenizeThreadID(ha);return ia.type=='group'?ia.value:null;},isEmptyLocalThread:function(ha){var ia=v.getResource(ha);if(!ia)return false;var ja=q.tokenizeThreadID(ha);return ja.type=='root'&&!ia.timestamp;}};function ga(ha){var ia=ha.filter(function(ja){return ja!=s.user;});return ia.length<=1;}q.subscribe('update-threads',function(ha,ia){var ja=(ia.actions||[]).filter(function(na){return na.thread_id;});fa.updateThreads(ia.threads);fa.updateMetadataByActions(ja,ia.from_client);(ia.threads||[]).forEach(function(na){r.updatedThread(na.thread_id);});var ka=ia.global_actions||[];for(var la=0;la<ka.length;la++){var ma=ka[la];if(ma.action_type==t.MercuryGlobalActionType.MARK_ALL_READ)ba(ma.folder);}});e.exports=fa;});
__d("MercuryMessages",["Arbiter","AsyncRequest","copyProperties","debounce","Env","JSLogger","KeyedCallbackManager","MercuryAssert","MercuryIDs","MercuryMessageIDs","MercuryParticipants","PresenceUtil","randomInt","RangedCallbackManager","MercuryServerDispatcher","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","tx","MercuryConstants","MercuryConfig"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('copyProperties'),j=b('debounce'),k=b('Env'),l=b('JSLogger'),m=b('KeyedCallbackManager'),n=b('MercuryAssert'),o=b('MercuryIDs'),p=b('MercuryMessageIDs'),q=b('MercuryParticipants'),r=b('PresenceUtil'),s=b('randomInt'),t=b('RangedCallbackManager'),u=b('MercuryServerDispatcher'),v=b('MercuryServerRequests'),w=b('MercuryThreadInformer'),x=b('MercuryThreads'),y=b('tx'),z=c('MercuryConstants'),aa=c('MercuryConfig'),ba=z.MercuryGenericConstants,ca={},da={},ea={},fa={},ga={};function ha(za){var ab=za;if(fa[za])ab=fa[za];return ca[ab];}var ia={},ja={},ka=new m();function la(za){if(za.status===undefined)za.status=z.MercuryActionStatus.UNSENT;za.timestamp_absolute="Today";za.message_id=za.message_id||ra.generateNewClientMessageID(za.timestamp);var ab=q.user;za.specific_to_list=za.specific_to_list||[];if(za.specific_to_list.length&&za.specific_to_list.indexOf(ab)===-1)za.specific_to_list.push(ab);if(!za.thread_id){if(za.specific_to_list.length==1){za.thread_id='user:'+k.user;}else if(za.specific_to_list.length==2){var bb=za.specific_to_list[0]==ab?za.specific_to_list[1]:za.specific_to_list[0];if(o.tokenize(bb).type=='email'){za.thread_id=ba.PENDING_THREAD_ID;}else za.thread_id=x.getThreadIDForParticipant(bb);}za.thread_id=za.thread_id||'root:'+za.message_id;}if(!za.specific_to_list.length){var cb=v.tokenizeThreadID(za.thread_id);if(cb.type=='user')za.specific_to_list=['fbid:'+cb.value,ab];}}function ma(za,ab,bb){var cb=va(ab)?[z.MercuryMessageSourceTags.CHAT]:[],db=Date.now(),eb=Date.format(aa['24h_times']?'H:i':'g:ia',Math.floor(db/1000)),fb={action_type:za,thread_id:bb,author:q.user,author_email:null,coordinates:null,timestamp:db,timestamp_absolute:(new Date(db)).toLocaleDateString(),timestamp_relative:eb,is_unread:false,is_cleared:false,is_forward:false,spoof_warning:false,source:ab,source_tags:cb};return fb;}function na(za){switch(za){case z.MercuryPayloadSource.UNKNOWN:case z.MercuryPayloadSource.SERVER_INITIAL_DATA:case z.MercuryPayloadSource.SERVER_FETCH_THREAD_INFO:case z.MercuryPayloadSource.SERVER_THREAD_SYNC:return true;}return false;}function oa(za){return za&&za.substr(0,6)==='server';}function pa(za){if(!ia[za])ia[za]=new t(function(ab){return ha(ab).timestamp;},function(ab,bb){return bb-ab;});return ia[za];}g.subscribe(l.DUMP_EVENT,function(za,ab){var bb={};for(var cb in ca){var db=ca[cb],eb=db.thread_id;bb[eb]=bb[eb]||{};bb[eb][db.message_id]={action_type:db.action_type,author:db.author,is_unread:db.is_unread,timestamp:db.timestamp};}ab.messaging=ab.messaging||{};ab.messaging.local_message_ids=i({},fa);ab.messaging.messages=bb;});function qa(za,ab){za.forEach(function(bb){var cb=pa(bb);cb.setReachedEndOfArray();w.reorderedMessages(bb,ab);});}var ra={getMessagesFromIDs:function(za){return (za||[]).map(ha).filter(function(ab){return ab;});},hasLoadedNMessages:function(za,ab){var bb=pa(za);return bb.hasReachedEndOfArray()||bb.getCurrentArraySize()>=ab;},getThreadMessagesRangeImmediately:function(za,ab,bb,cb,db){return ra.getThreadMessagesRange(za,ab,bb,cb,u.IMMEDIATE,db);},getThreadMessagesRange:function(za,ab,bb,cb,db,eb){var fb=pa(za),gb=function(lb){cb(sa(lb));},hb=fb.executeOrEnqueue(ab,bb,gb),ib=fb.getUnavailableResources(hb),jb=ga[za];if(ib.length&&!jb){var kb=ja[za]||0;v.fetchThreadMessages(za,kb,ib.length,db,eb);}else ga[za]=false;return hb;},getThreadMessagesSinceTimestamp:function(za,ab){var bb=pa(za),cb=bb.getElementsUntil(ab);return sa(cb);},hasLoadedAllMessages:function(za){return pa(za).hasReachedEndOfArray();},unsubscribe:function(za,ab){n.isThreadID(ab);var bb=pa(ab);bb.unsubscribe(za);},addAttachmentData:function(za,ab,bb){var cb=ha(za);if(cb){var db=cb.attachments.indexOf(ab);if(db!=-1){cb.attachments[db]=bb;w.updatedMessage(cb.thread_id,cb.message_id,'attach');}}else{if(!da[za])da[za]=[];da[za].push({attach_key:ab,data:bb});}},handleUpdates:function(za,ab,bb){var cb={},db={},eb=z.MercuryActionStatus;for(var fb=0;fb<za.length;fb++){var gb=za[fb];if(gb.is_forward||bb==z.MercuryPayloadSource.SERVER_SEARCH){if(!ca[gb.message_id]){ca[gb.message_id]=gb;wa(gb);}continue;}var hb=gb.action_type;if(hb==z.MercuryActionType.SEND_MESSAGE){var ib=gb.client_message_id;if(ib&&fa[ib]&&gb.status){if(gb.status==eb.UNCONFIRMED){if(!db[gb.thread_id])db[gb.thread_id]=[];db[gb.thread_id].push(gb.client_message_id);}else if(!cb[gb.thread_id])cb[gb.thread_id]=[];var jb=ha(gb.client_message_id),kb=jb.status;jb.status=gb.status;if(gb.status==eb.SUCCESS){ra.updateLocalMessage(gb,bb);if(gb.client_thread_id==ba.PENDING_THREAD_ID){jb.thread_id=gb.thread_id;cb[gb.thread_id].push(jb.message_id);ka.setResource(jb.message_id,jb.thread_id);}}if(typeof kb!='undefined'||gb.status==eb.REQUEST_ERROR||gb.status==eb.TRANSPORT_ERROR||gb.status==eb.FAILED_UNKNOWN_REASON||gb.status==eb.UNABLE_TO_CONFIRM||gb.status==eb.SUCCESS)w.updatedMessage(gb.thread_id,ha(gb.client_message_id).message_id,bb);}continue;}else if(hb==z.MercuryActionType.DELETE_THREAD){pa(gb.thread_id).removeAllResources();continue;}else if(hb==z.MercuryActionType.DELETE_MESSAGES){var lb=gb.message_ids.map(function(tb){return ha(tb).message_id;}),mb=pa(gb.thread_id);mb.removeResources(lb);w.reorderedMessages(gb.thread_id,bb);continue;}else if(hb==z.MercuryActionType.LOG_MESSAGE){if(gb.log_message_type==z.MercuryLogMessageType.SERVER_ERROR)ga[gb.thread_id]=true;}else if(hb==z.MercuryActionType.CLEAR_CHAT){var nb=pa(gb.thread_id).getAllResources();nb.map(ha).forEach(function(tb){tb.is_cleared=true;});continue;}var ob=ha(gb.message_id);if((gb.threading_id&&fa[gb.threading_id])||(ob&&!ob.is_forward))continue;if(!cb[gb.thread_id])cb[gb.thread_id]=[];cb[gb.thread_id].push(gb.message_id);ca[gb.message_id]=gb;wa(gb);if(gb.threading_id&&gb.threading_id!=gb.message_id)p.addServerID(gb.threading_id,gb.message_id);if(!ab)w.receivedMessage(gb);}for(var pb in cb){var mb=pa(pb),qb=mb.getAllResources(),rb=qb.filter(function(tb){var ub=ca[tb];return ub.action_type==z.MercuryActionType.LOG_MESSAGE&&ub.log_message_type==z.MercuryLogMessageType.SERVER_ERROR;});mb.removeResources(rb);ta(pb,cb[pb]);if(ab){mb.addResources(cb[pb]);w.reorderedMessages(pb,bb);}else mb.addResourcesWithoutSorting(cb[pb].reverse(),0);w.updatedThread(pb);}var sb=Object.keys(db);if(sb.length)v.requestMessageConfirmation(db);},sendMessage:function(za,ab,bb){ab=ab||Function.prototype;la(za);fa[za.message_id]=za.message_id;if(za.thread_id=='root:'+za.message_id)pa(za.thread_id).setReachedEndOfArray();v.sendNewMessage(za,bb);if(za.thread_id==ba.PENDING_THREAD_ID){ca[za.message_id]=za;return ka.executeOrEnqueue(za.message_id,ab);}else ab(za.thread_id);},unsubscribeSend:function(za){ka.unsubscribe(za);},resendMessage:function(za,ab){var bb=i({},za);bb.status=z.MercuryActionStatus.RESENDING;bb.timestamp=(new Date()).getTime();bb.message_id=za.message_id;ca[za.message_id]=bb;var cb=pa(za.thread_id);cb.resortResources([za.message_id]);ra.sendMessage(bb,null,ab);w.reorderedMessages(za.thread_id,z.MercuryPayloadSource.CLIENT_SEND_MESSAGE);},deleteMessages:function(za,ab){if(ab.length){var bb=pa(za),cb=bb.getCurrentArraySize()==ab.length&&bb.hasReachedEndOfArray();v.deleteMessages(za,ab,cb);}},updateLocalMessage:function(za,ab){var bb=za.message_id,cb=za.client_message_id;fa[cb]=bb;ca[bb]=ca[cb];p.addServerID(cb,bb);ca[cb]={};var db=ha(cb);if(za.timestamp)db.timestamp=za.timestamp;if(za.attachments&&za.attachments.length){db.raw_attachments=null;db.attachments=za.attachments;wa(db,bb);}},constructUserGeneratedMessageObject:function(za,ab,bb,cb){var db=ma(z.MercuryActionType.USER_GENERATED_MESSAGE,ab,bb);db.body=za;db.has_attachment=false;db.html_body=false;db.attachments=[];db.specific_to_list=cb||[];return db;},constructLogMessageObject:function(za,ab,bb,cb){var db=ma(z.MercuryActionType.LOG_MESSAGE,za,ab);db.log_message_type=bb;db.log_message_data=cb;return db;},generateNewClientMessageID:function(za){var ab=za+':'+(s(0,4294967295)+1)+'-'+r.getSessionID();return '<'+ab+'@mail.projektitan.com>';}};v.subscribe('update-messages',function(za,ab){var bb=(ab.actions||[]).filter(function(db){var eb=db.action_type;return (db.is_forward||db.thread_id)&&(eb==z.MercuryActionType.LOG_MESSAGE||eb==z.MercuryActionType.USER_GENERATED_MESSAGE||eb==z.MercuryActionType.SEND_MESSAGE||eb==z.MercuryActionType.CLEAR_CHAT||eb==z.MercuryActionType.DELETE_THREAD||eb==z.MercuryActionType.DELETE_MESSAGES);}),cb=na(ab.payload_source);if(oa(ab.payload_source))bb.forEach(function(db){if(!db.is_forward){var eb=x.getThreadMetaNow(db.thread_id);if(eb)db.is_cleared=db.timestamp<eb.chat_clear_time;}});ra.handleUpdates(bb,cb,ab.payload_source);if(ab.end_of_history)qa(ab.end_of_history,ab.payload_source);});function sa(za){var ab=za.map(ha);return ab.reverse();}function ta(za,ab){var bb=ab.filter(function(cb){return ua(ha(cb));});if(!ja[za])ja[za]=0;ja[za]+=bb.length;}function ua(za){var ab=za.action_type;if(ab==z.MercuryActionType.USER_GENERATED_MESSAGE)return true;switch(za.log_message_type){case z.MercuryLogMessageType.SUBSCRIBE:case z.MercuryLogMessageType.UNSUBSCRIBE:case z.MercuryLogMessageType.SERVER_ERROR:case z.MercuryLogMessageType.LIVE_LISTEN:return false;default:return true;}}function va(za){switch(za){case z.MercurySourceType.CHAT_WEB:case z.MercurySourceType.CHAT_JABBER:case z.MercurySourceType.CHAT_IPHONE:case z.MercurySourceType.CHAT_MEEBO:case z.MercurySourceType.CHAT_ORCA:case z.MercurySourceType.CHAT_TEST:case z.MercurySourceType.CHAT:case z.MercurySourceType.DESKTOP:return true;default:return false;}}function wa(za,ab){ab=ab||za.message_id;var bb=da[ab];if(bb){bb.forEach(function(cb){var db=za.attachments.indexOf(cb.attach_key);if(db!==-1)za.attachments[db]=cb.data;});delete da[ab];}else if(!za.is_forward&&xa(za)){ea[ab]=true;ya();}}function xa(za){if(!za||!za.attachments)return false;for(var ab=0;ab<za.attachments.length;ab++){var bb=za.attachments[ab];if(typeof bb==='string'&&bb.indexOf(z.MercuryAttachmentType.SHARE)===0)return true;}var cb=za.forward_message_ids||[];for(ab=0;ab<cb.length;ab++){var db=ha(cb[ab]);if(xa(db))return true;}return false;}var ya=j(function(){var za={};for(var ab in ea){var bb=ha(ab);if(xa(bb))za[ab]=true;}var cb=Object.keys(za);if(cb.length)new h('/ajax/mercury/attachments/fetch_shares.php').setData({message_ids:cb}).setAllowCrossPageTransition(true).send();ea={};},0,this,true);e.exports=ra;});
__d("MercuryUnseenState",["Arbiter","copyProperties","TimestampConverter","KeyedCallbackManager","JSLogger","createObjectFrom","MercuryServerRequests","MercuryThreadInformer","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('TimestampConverter'),j=b('KeyedCallbackManager'),k=b('JSLogger'),l=b('createObjectFrom'),m=b('MercuryServerRequests'),n=b('MercuryThreadInformer'),o=c('MercuryConstants'),p=o.MercuryThreadlistConstants.MAX_UNSEEN_COUNT,q=0,r=0,s=false,t=new j(),u='unseen_thread_hash',v='unseen_thread_list',w=k.create('mercury_unseen_state'),x={getUnseenCount:function(){if(x.exceedsMaxCount()){w.error('unguarded_unseen_count_fetch',{});return 0;}return ba();},exceedsMaxCount:function(){return s||(ba()>p);},markAsSeen:function(){if(ba()>0||s){m.markSeen();da(i.convertActionIDToTimestamp(m.getLastActionID()),[]);}},markThreadSeen:function(ka,la){var ma={};ma[ka]=null;fa(ma,la);}};function y(ka){t.setResource(u,ka);t.setResource(v,Object.keys(ka));}function z(ka){var la=t.executeOrEnqueue(u,ka),ma=t.getUnavailableResources(la);if(ma.length)m.fetchUnseenThreadIDs();}function aa(){return t.getResource(u);}function ba(){var ka=t.getResource(v);if(ka){return ka.length;}else return q;}function ca(ka){var la=ja(ka);if(ka.unseen_thread_ids){ka.unseen_thread_ids.forEach(function(wa){if(wa.folder!=o.MessagingTag.INBOX)return;var xa=ha(wa.thread_ids),ya=r;if(la&&la.seen_timestamp)ya=la.seen_timestamp;da(ya,xa);if(la&&la.unseen_count>p)s=true;});}else if(la&&la.seen_timestamp){r=la.seen_timestamp;if(la.unseen_count>p){s=true;y({});}else{q=la.unseen_count;if(q===0)y({});}}else{if(s)return;var ma=ka.actions;if(!ma||!(ma.length))return;var na={},oa={};for(var pa=0;pa<ma.length;pa++){var qa=ma[pa];if(qa.is_forward)continue;var ra=qa.action_type,sa=qa.action_id,ta=qa.thread_id?qa.thread_id:qa.server_thread_id,ua=qa.folder===undefined||qa.folder==o.MessagingTag.INBOX;if(!ua)continue;if(ra==o.MercuryActionType.USER_GENERATED_MESSAGE||ra==o.MercuryActionType.LOG_MESSAGE){var va=i.isGreaterThan(sa,na[ta]);if(qa.is_unread&&(!na[ta]||va))na[ta]=sa;}else if(ra==o.MercuryActionType.CHANGE_READ_STATUS&&qa.mark_as_read)oa[ta]=sa;}ea(na);fa(oa);}}function da(ka,la){var ma=aa();if(ma===undefined||ka>r||s){r=ka;la=la||[];if(la.length<=p)s=false;var na={},oa=aa()||{};for(var pa in oa)if(oa[pa]!==true){var qa=oa[pa];if(ga(qa))na[pa]=qa;}var ra=h(l(la,true),na);y(ra);n.updatedUnseenState();}}function ea(ka){if(s)return;var la={},ma=false;for(var na in ka){var oa=ka[na];if(ga(oa)){la[na]=oa;ma=true;}}if(!ma)return;z(function(pa){for(var qa in la){var ra=la[qa];if(!pa[qa]&&ga(ra))pa[qa]=la[qa];}y(pa);n.updatedUnseenState();});}function fa(ka,la){var ma=false;for(var na in ka){ma=true;break;}if(ma)z(function(oa){var pa=false;for(var qa in ka){var ra=ka[qa],sa=i.isGreaterThan(ra,oa[qa]);if(oa[qa]&&(!ra||sa)){delete oa[qa];pa=true;}}if(pa){y(oa);n.updatedUnseenState();if(la&&ba()===0)m.markSeen();}});}function ga(ka){return i.convertActionIDToTimestamp(ka)>r;}function ha(ka){return ka.map(m.convertThreadIDIfAvailable);}function ia(ka){var la=aa();if(!la)return;for(var ma in ka){var na=ka[ma];if(la[ma]){la[na]=la[ma];delete la[ma];}}y(la);}function ja(ka){var la=(ka.message_counts||[]);for(var ma=0;ma<la.length;ma++)if(la[ma].folder==o.MessagingTag.INBOX)return la[ma];return null;}m.subscribe('update-unseen',function(ka,la){ca(la);});m.subscribe('update-thread-ids',function(ka,la){ia(la);});g.subscribe(k.DUMP_EVENT,function(ka,la){la.messaging=la.messaging||{};la.messaging.unseen=h({},aa());la.messaging.unseen_max_count=s;la.messaging.unseen_time=r;});e.exports=x;});
__d("VideoCallRecordMessageDialog",["AsyncDialog","AsyncRequest","Dialog","tx","URI","MercuryConfig"],function(a,b,c,d,e,f){var g=b('AsyncDialog'),h=b('AsyncRequest'),i=b('Dialog'),j=b('tx'),k=b('URI'),l=c('MercuryConfig'),m={get:function(n,o){var p=l.MessagesMercuryIntegrationGK?"Would you like to leave a message?":"Would you like to leave a video message?",q=l.MessagesMercuryIntegrationGK?"New Message":"Record Message";return new i().setTitle(j._("{firstname} is Unavailable",{firstname:o})).setBody(p).setButtons([{name:'record-message',label:q},i.CANCEL]).setHandler(function(){var r=k('/ajax/messaging/composer.php').setQueryData({ids:[n],autoloadvideo:true}).toString();g.send(new h(r));});}};e.exports=m;});
__d("VideoCallCore",["event-extensions","Arbiter","AsyncRequest","AvailableList","AvailableListConstants","Bootloader","ChannelConstants","Cookie","Dialog","UserAgent","emptyFunction","ge","ShortProfiles","VideoCallRecordMessageDialog","MercuryConfig"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('AvailableList'),j=b('AvailableListConstants'),k=b('Bootloader'),l=b('ChannelConstants'),m=b('Cookie'),n=b('Dialog'),o=b('UserAgent'),p=b('emptyFunction'),q=c('MercuryConfig'),r=b('ge'),s=[],t={isSupported:function(){if(o.windows()){return (o.ie()>=7&&!o.ie64())||o.firefox()>=3.6||o.chrome()>=5||o.opera()>=12;}else if(o.osx()>10.4)return (o.firefox()>=3.6||o.chrome()>=5||o.safari()>=500||o.opera()>=12);return false;},isInstalled:function(){var x=false;if(this.isSupported())if(u()){var y=null;try{y=new ActiveXObject('SkypeLimited.SkypeWebPlugin');x=!!y;}catch(z){}y=null;}else{x=v();if(q.VideoCallingNoJavaGK)if(x&&o.osx()>=10.8)if(x.description&&x.description.charAt(0)!='v')x=false;}return x;},mightReloadPostInstall:function(){return o.windows();},onVideoMessage:function(x){s.push(x);k.loadModules(['VideoCallController'],p);},setMessageHandler:function(x){this.onVideoMessage=x;if(x)while(s.length)x(s.shift());},availableForCall:function(x){var y=i.get(x);return y==j.ACTIVE||y==j.IDLE;},onProfileButtonClick:function(x){t.startCallOrLeaveMessage(x,'profile_button_click');},attachListenerToProfileButton:function(x){var y=r('videoCallProfileButton');if(y)Event.listen(y,'click',function(event){t.startCallOrLeaveMessage(x,'profile_button_click_timeline');});},startCallOrLeaveMessage:function(x,y){if(this.availableForCall(x)){t.showOutgoingCallDialog(x,y);}else b('ShortProfiles').get(x,function(z){b('VideoCallRecordMessageDialog').get(x,z.firstName).show();});},showOutgoingCallDialog:function(x,y){var z=y||'unknown';t.logClick(x,z);var aa=t.isInstalled()?'outgoing_dialog.php':'intro.php',ba='/ajax/chat/video/'+aa+'?idTarget='+x;new n().setAllowCrossPageTransition(true).setAsync(new h(ba)).show();},logClick:function(x,y){new h().setURI('/ajax/chat/video/log_click.php').setData({targetUserID:x,clickSource:y}).setAllowCrossPageTransition(true).setErrorHandler(p).send();}};function u(){return o.ie()&&o.windows()&&!o.opera();}function v(){if(!navigator)return null;navigator.plugins.refresh(false);var x=navigator.mimeTypes['application/skypesdk-plugin'];return x&&x.enabledPlugin;}function w(){if(!t.mightReloadPostInstall())return;var x=m.get('vcpwn');if(x){m.clear('vcpwn');var y=m.get('vctid');if(y){m.clear('vctid');if(m.get('vctid'))return;if(y&&t.isInstalled()){var z='/ajax/chat/video/outgoing_dialog.php?idTarget='+y;new n().setAllowCrossPageTransition(true).setAsync(new h(z)).show();}}}}g.subscribe(l.getArbiterType('video'),function(x,y){t.onVideoMessage(y.obj);});g.subscribe(l.getArbiterType('chat_event'),function(x,y){if(y.obj.event_name=="missed-call")k.loadModules(['VideoCallController'],function(z){z.onMissedCallEvent(y.obj);});});w();e.exports=t;});
__d("MercuryRoger",["ArbiterMixin","MercuryServerRequests","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('MercuryServerRequests'),i=b('copyProperties'),j={},k={getSeenBy:function(l,m){if(!l)return [];var n=[],o=j[l.thread_id];for(var p in o)if(o[p]>l.timestamp&&(!m||p!=l.author))n.push(p);return n;},getSeenTimestamp:function(l,m){var n=j[l];return n?n[m]:null;}};i(k,g);h.subscribe('update-roger',function(l,m){for(var n in m){if(!j[n])j[n]={};for(var o in m[n]){var p=j[n][o],q=m[n][o];if(!p||q>p)j[n][o]=q;}}if(m)k.inform('state-changed',m);});e.exports=k;});
__d("MercuryDelayedRoger",["ArbiterMixin","copyProperties","LiveTimer","MercuryMessages","MercuryThreads","MercuryRoger","MercuryThreadInformer","setTimeoutAcrossTransitions","MercuryConfig","MercuryConstants"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('copyProperties'),i=b('LiveTimer'),j=b('MercuryMessages'),k=b('MercuryThreads'),l=b('MercuryRoger'),m=b('MercuryThreadInformer'),n=b('setTimeoutAcrossTransitions'),o=c('MercuryConfig'),p=c('MercuryConstants'),q={},r={},s=o['roger.seen_delay'],t=h({getSeenBy:function(x,y){if(r[x])return [];if(!q[x]){var z=k.getThreadMetaNow(x);if(z)q[x]={thread_id:x,author:z.participants[0],timestamp:z.timestamp};}return l.getSeenBy(q[x],y);}},g);function u(x){var y=false;j.getThreadMessagesRange(x,0,1,function(z){var aa=z[0];if(!aa)return;var ba=aa.timestamp,ca=p.MercuryActionStatus.SUCCESS;if(aa.action_id||aa.status==ca)ba-=i.getServerTimeOffset();var da=t.getSeenBy(x);if(r[x]){clearTimeout(r[x]);delete r[x];}var ea=ba+s,fa=ea-Date.now();if(fa>0)r[x]=n(function(){delete r[x];v(x);},fa);q[x]=aa;var ga=t.getSeenBy(x);if(da.length||ga.length)y=true;});return y;}function v(x){var y={};y[x]=true;t.inform('state-changed',y);}function w(event,x){var y={};for(var z in x)if(u(z))y[z]=true;for(var aa in y){t.inform('state-changed',y);break;}}l.subscribe('state-changed',function(x,y){for(var z in y)!r[z]&&v(z);});m.subscribe('messages-received',w);m.subscribe('messages-reordered',w);m.subscribe('messages-updated',w);e.exports=t;});
__d("WebMessengerPermalinkConstants",["URI"],function(a,b,c,d,e,f){var g=b('URI'),h={ARCHIVED_PATH:'/messages/archived',BASE_PATH:'/messages',OTHER_PATH:'/messages/other',SPAM_PATH:'/messages/spam',COMPOSE_POSTFIX_PATH:'/new',SEARCH_POSTFIX_PATH:'/search',TID_POSTFIX_PARTIAL_PATH:'/conversation-',overriddenVanities:'(archived|other|spam|new|search|conversation-.*)',getURIPathForThreadID:function(i,j){return (j||h.BASE_PATH)+h.TID_POSTFIX_PARTIAL_PATH+g.encodeComponent(g.encodeComponent(i));},getThreadIDFromURI:function(i){var j=i.getPath().match(h.BASE_PATH+'(/[^/]*)*'+h.TID_POSTFIX_PARTIAL_PATH+'([^/]+)');if(j){var k=g.decodeComponent(g.decodeComponent(j[2]));return k;}},getURIPathForIDOrVanity:function(i,j){if(i.match('^'+h.overriddenVanities+'$'))i='.'+i;return (j||h.BASE_PATH)+'/'+i;},getUserIDOrVanity:function(i){var j=i.match(h.BASE_PATH+'.*/([^/]+)/?$'),k=j&&j[1],l=h.overriddenVanities;if(!k||k.match('^'+l+'$')){return false;}else if(k.match('^\\.'+l+'$')){return k.substr(1);}else return k;}};e.exports=h;});
__d("MercuryThreadMetadataRawRenderer",["event-extensions","CSS","DOM","Tooltip","URI","WebMessengerPermalinkConstants","tx","MercuryConfig","MercuryConstants","MercuryStatusTemplates"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOM'),i=b('Tooltip'),j=b('URI'),k=b('WebMessengerPermalinkConstants'),l=b('tx'),m=c('MercuryConfig'),n=c('MercuryConstants'),o=c('MercuryStatusTemplates');e.exports={renderParticipantListWithNoThreadName:function(p,q,r,s,t,u){var v={callback:true,check_length:true,show_unread_count:true};u=u||{};var w={};for(var x in u)if(v[x]){w[x]=u[x];delete u[x];}var y=r.map(function(da){return s[da];}),z=this.renderRawParticipantList(p,y,r.length,u);z=this.renderRawTitleWithUnreadCount(z,w.show_unread_count?q.unread_count:0);var aa=u.abbr_mode,ba={};for(var ca in u)ba[ca]=u[ca];ba.abbr_mode=true;t.forEach(function(da){var ea=t.length>1?this._cloneIfDOMElement(z):z;h.setContent(da,ea);if(w.check_length&&!aa&&da.scrollWidth>da.clientWidth){var fa=this.renderRawParticipantList(p,y,r.length,ba),ga=this.renderRawTitleWithUnreadCount(fa,w.show_unread_count?q.unread_count:0);h.setContent(da,ga);}}.bind(this));w.callback&&w.callback(z);},renderRawParticipantList:function(p,q,r,s){var t={abbr_mode:true,last_separator_uses_and:true,link_mode:true,names_renderer:true};s=s||{};var u=null;if(s.names_renderer){u=s.names_renderer(q);}else u=q.map(function(x){return x.name;});var v=null;if(u.length==1){v=u[0];}else if(u.length==2){var w={participant1:u[0],participant2:u[1]};if(s.last_separator_uses_and){v=l._("{participant1} and {participant2}",w);}else v=l._("{participant1}, {participant2}",w);}else if(s.last_separator_uses_and){if(s.abbr_mode){v=l._("{participant1} and {others_link}",{participant1:u[0],others_link:this.renderRawParticipantCount(p,{render_subset:true,count:r-1,as_link:s.link_mode})});}else if(u.length==3){v=l._("{participant1}, {participant2} and {participant3}",{participant1:u[0],participant2:u[1],participant3:u[2]});}else v=l._("{participant1}, {participant2} and {others_link}",{participant1:u[0],participant2:u[1],others_link:this.renderRawParticipantCount(p,{render_subset:true,count:r-2,as_link:s.link_mode})});}else if(u.length==3){v=l._("{participant1}, {participant2}, {participant3}",{participant1:u[0],participant2:u[1],participant3:u[2]});}else v=l._("{participant1}, {participant2}, {participant3}, {others_link}",{participant1:u[0],participant2:u[1],participant3:u[2],others_link:this.renderRawParticipantCount(p,{render_subset:true,count:r-3,as_link:s.link_mode})});if(Array.isArray(v))v=h.create('span',{},v);return v;},renderRawTitleWithUnreadCount:function(p,q){var r=p;if(q&&q>1)r=h.create('span',{},l._("{conversation_title} ({unread_count})",{conversation_title:p,unread_count:q}));return r;},renderRawParticipantCount:function(p,q){function r(u,v){return h.create('a',{className:'hoverlistLink',href:j('/ajax/messaging/profile_browser/profile_browser.php').setQueryData(u),rel:'dialog'},v);}var s=q.render_subset,t;if(!s){t=q.count>1?l._("{num} people",{num:q.count}):"1 person";}else t=q.count>1?l._("{others_count} others",{others_count:q.count}):"1 other";if(q.as_link&&p){return r({tid:p},t);}else return t;},renderShortNames:function(p){if(p.length==1)return [p[0].name];return p.map(function(q){return q.short_name;});},renderUserCanonicalTitanLink:function(p,q,r){var s=new j().setSubdomain('www');s.setPath('/messages/'+p.substr(p.indexOf(':')+1));q.setAttribute('href',s.toString());r&&r();},renderTitanLinkWithServerID:function(p,q,r){var s=new j().setSubdomain('www');if(m.MessagesMercuryIntegrationGK){s.setPath(k.getURIPathForThreadID(p));}else{s.setPath('/messages/');s.setQueryData({action:'read',tid:p});}q.setAttribute('href',s.toString());r&&r();},renderStatusIndicator:function(p,q){var r=n.MercuryActionStatus,s;if(p==r.RESENDING){s=this.renderResendIndicator();}else if(p!==undefined&&p!=r.UNSENT&&p!=r.UNCONFIRMED&&p!=r.SUCCESS)s=this.renderErrorIndicator(p,q);return s;},renderResendIndicator:function(){return o[':fb:mercury:resend-indicator'].render();},renderErrorIndicator:function(p,q){var r=o[':fb:mercury:error-indicator'].render(),s;switch(p){case n.MercuryActionStatus.REQUEST_ERROR:case n.MercuryActionStatus.TRANSPORT_ERROR:case n.MercuryActionStatus.FAILED_UNKNOWN_REASON:case n.MercuryActionStatus.UNABLE_TO_CONFIRM:s="This message failed to send. Click to send again.";break;default:throw new Error('Invalid error code '+p);}i.set(r,s,'above','center');if(q){Event.listen(r,'click',q);g.addClass(r,'mercuryClickableErrorIndicator');}return r;},_cloneIfDOMElement:function(p){if(p.cloneNode){return p.cloneNode();}else return p;}};});
__d("MercurySeenByAll",["CSS","DataStore","DOM","MercuryParticipants","MercuryDelayedRoger","MercuryThreads"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DataStore'),i=b('DOM'),j=b('MercuryParticipants'),k=b('MercuryDelayedRoger'),l=b('MercuryThreads'),m={},n={updateOnSeenChange:function(p,q){m[p.tagName]=true;h.set(p,'thread-id',q.thread_id);g.addClass(p,'seenByListener');o(p,q);}};function o(p,q){var r=q.participants.filter(function(t){return t!==j.user;}),s=q.participants.length>0&&q.participants[0]===j.user;g.conditionClass(p,'repliedLast',s);g.conditionClass(p,'seenByAll',s&&k.getSeenBy(q.thread_id).length===r.length);}k.subscribe('state-changed',function(p,q){for(var r in m){var s=i.scry(document.body,r+'.seenByListener');for(var t=0;t<s.length;t++){var u=s[t],v=h.get(u,'thread-id');if(q[v])l.getThreadMeta(v,function(w){o(u,w);});}}});e.exports=n;});
__d("MercuryThreadMetadataRenderer",["event-extensions","CSS","DOM","HTML","JSLogger","MercuryAttachment","MercuryEmoji","MercuryThreadMetadataRawRenderer","MercuryParticipants","MercurySeenByAll","MercuryServerRequests","MercuryThreads","Tooltip","URI","cx","createArrayFrom","tx","MercuryImageTemplates","MercuryThreadlistIconTemplates","MercuryConstants","MercuryConfig"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOM'),i=b('HTML'),j=b('JSLogger'),k=b('MercuryAttachment'),l=b('MercuryEmoji'),m=b('MercuryThreadMetadataRawRenderer'),n=b('MercuryParticipants'),o=b('MercurySeenByAll'),p=b('MercuryServerRequests'),q=b('MercuryThreads'),r=b('Tooltip'),s=b('URI'),t=b('cx'),u=c('MercuryImageTemplates'),v=c('MercuryThreadlistIconTemplates'),w=c('MercuryConstants'),x=c('MercuryConfig'),y=b('createArrayFrom'),z=b('tx'),aa=j.create('wm_timestamp');e.exports={renderTimestamp:function(ea,fa,ga,ha){if(ha){if(!fa){aa.warn('no_title');fa=(new Date(ha)).toLocaleDateString();}ea.setAttribute('title',fa);if(!ga){aa.warn('no_display');ga=Date.format(x['24h_times']?'H:i':'g:ia',Math.floor(ha/1000));}h.setContent(ea,ga);g.show(ea);}},renderMessageSourceTags:function(ea,fa,ga,ha){var ia=w.MercuryMessageSourceTags,ja='',ka='',la='';if(ga.contains(ia.MESSENGER)){ja="Sent from Messenger";ka=new s('/mobile/messenger');la="_9g";}else if(ga.contains(ia.CHAT)){ja="Sent from chat";la="_9h";}else if(ga.contains(ia.EMAIL)){if(ha){ja=z._("Sent from {email}",{email:ha});}else ja="Sent from email";la="_9i";}else if(ga.contains(ia.MOBILE)){ja="Sent from Mobile";ka=new s('/mobile/');la="_9j";}if(la){r.set(ea,ja);g.addClass(fa,la);if(ka){ea.setAttribute('href',ka);}else ea.removeAttribute('href');}else g.hide(ea);},renderMessageLocation:function(ea,fa,ga){var ha=s('/ajax/messaging/hovercard/map.php').setQueryData(ga);ea.setAttribute('data-hovercard',ha);g.removeClass(ea,"_b9");g.show(fa);},renderSpoofWarning:function(ea,fa,ga){if(fa){g.addClass(ea,"_sa");r.set(ea,z._("Unable to confirm {name_or_email} as the sender.",{name_or_email:ga.name}));}},renderCoreThreadlist:function(ea,fa,ga,ha,ia,ja){ha=ha||{};this.renderThreadImage(ea,fa.getNode('image'));da(ea,fa.getNode('name'),ha);if(ea.folder&&ia)ba(fa.getNode('folderBadge'),ea.folder);if(ja)ca(fa.getNode('promotionBadge'),ea);var ka=fa.getNode('timestamp');this.renderTimestamp(ka,ea.timestamp_absolute,ea.timestamp_relative,ea.timestamp);this.renderSnippet(ea,fa.getNode('snippet'));ga(fa,ea);},renderAndSeparatedParticipantList:function(ea,fa,ga){ga=ga||{};ga.last_separator_uses_and=true;q.getThreadMeta(ea,function(ha){da(ha,fa,ga);}.bind(this));},renderSnippet:function(ea,fa){var ga=h.create('span');g.addClass(ga,'MercuryRepliedIndicator');h.appendContent(fa,ga);o.updateOnSeenChange(ga,ea);if(ea.snippet_has_attachment)if(!ea.snippet&&ea.snippet_attachments){ea.snippet_attachments.forEach(function(ka){if(ka.attach_type!=w.MercuryAttachmentType.FILE)return;var la=k.getAttachIconClass(ka.icon_type),ma=v[':fb:mercury:attachment-icon-text'].build().getRoot();h.appendContent(ma,ka.name);g.addClass(ma,la);h.appendContent(fa,ma);}.bind(this));}else h.appendContent(fa,h.create('span',{className:'MercuryAttachmentIndicator'}));if(ea.is_forwarded_snippet){var ha;if(ea.snippet){ha="Forwarded Message:";}else ha="Forwarded Message";h.appendContent(fa,h.create('strong',{className:'mercuryForwardedIndicator'},ha));}var ia=ea.snippet;if(ia)if(ia.substr(0,4)=='?OTR'){ia="[encrypted message]";}else ia=ia.replace(/\r\n|[\r\n]/g," ");var ja=ea.participants.length;if(ea.is_subscribed)ja--;if(ea.snippet_sender&&n.user!=ea.snippet_sender&&ja>1){n.get(ea.snippet_sender,function(ka){if(ka.short_name)ia=z._("{name}: {conversation_snippet}",{name:ka.short_name,conversation_snippet:ia});h.appendContent(fa,i(l.htmlEmojiAndEmote(ia)));});}else h.appendContent(fa,i(l.htmlEmojiAndEmote(ia)));},renderTitanLink:function(ea,fa,ga){if(ea.substr(0,ea.indexOf(':'))=='user'){m.renderUserCanonicalTitanLink(ea,fa,ga);}else p.getServerThreadID(ea,function(ha){m.renderTitanLinkWithServerID(ha,fa,ga);});},renderThreadImage:function(ea,fa){if(ea.image_src){this._renderThreadImageSingle(ea.image_src,fa);return;}var ga=[],ha=ea.participants.filter(function(ia){return ia!=n.user;});if(!ha.length){ga=[n.user];}else if(ha.length==1){ga=[ha[0]];}else{ga=ha.slice(0,3);if(ga.length==2)ga.push(n.user);}n.getMulti(ga,function(ia){var ja=ga.map(function(ka){return ia[ka];});this.renderParticipantImages(ja,fa);}.bind(this));},renderParticipantImages:function(ea,fa){if(ea.length>2){this._renderThreadImageSplit(ea,fa);}else this._renderThreadImageSingle(ea[0].image_src,fa);},renderParticipantList:function(ea,fa,ga,ha){return m.renderRawParticipantList(p.getServerThreadIDNow(ea),fa,ga,ha);},renderThreadNameAndParticipantList:function(ea,fa,ga,ha){var ia=m.renderRawParticipantList(p.getServerThreadIDNow(ea),fa,ga,ha),ja=q.getThreadMetaNow(ea);if(!ja.name)return ia;return z._("{conversation_name} [with {participant_list}]",{conversation_name:ja.name,participant_list:ia});},renderParticipantCount:function(ea,fa){return m.renderRawParticipantCount(p.getServerThreadIDNow(ea),fa);},_renderThreadImageSingle:function(ea,fa){var ga=u[':fb:mercury:thread-image:single'].build().getRoot();ga.src=ea;h.setContent(fa,ga);},_renderThreadImageSplit:function(ea,fa){var ga=u[':fb:mercury:thread-image:split'].build().setNodeProperty('left','src',ea[0].image_src).setNodeProperty('topRight','src',ea[1].image_src).setNodeProperty('bottomRight','src',ea[2].image_src);h.setContent(fa,ga.getRoot());}};function ba(ea,fa){y(ea).forEach(function(ga){h.setContent(ga,fa);});}function ca(ea,fa){y(ea).forEach(function(ga){if(fa.is_demoted){h.setContent(ga,"demoted");g.show(ga);}else if(fa.is_promoted){h.setContent(ga,"promoted");g.show(ga);}});}function da(ea,fa,ga){fa=y(fa);if(ea.name){var ha=m.renderRawTitleWithUnreadCount(ea.name,ga.show_unread_count?ea.unread_count:0);fa.forEach(function(ja){h.setContent(ja,ha);});ga.callback&&ga.callback(ha);return;}var ia=ea.participants;if(ea.participants.length>1)ia=ea.participants.filter(function(ja){return ja!=n.user;});n.getMulti(ia,function(ja){m.renderParticipantListWithNoThreadName(p.getServerThreadIDNow(ea.thread_id),ea,ia,ja,fa,ga);}.bind(this));}});
__d("MercuryChannelHandler",["Arbiter","ChannelConstants","copyProperties","Env","MessagingReliabilityLogger","MercuryParticipants","PresenceUtil","MercuryServerRequests","MercuryThreadInformer","MercuryConstants","MercuryConfig"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('copyProperties'),j=b('Env'),k=b('MessagingReliabilityLogger'),l=b('MercuryParticipants'),m=b('PresenceUtil'),n=b('MercuryServerRequests'),o=b('MercuryThreadInformer'),p=c('MercuryConstants'),q=c('MercuryConfig');function r(ga,ha){if(ga!=h.getArbiterType('messaging')||!ha.obj||!ha.obj.message){k.addEntry('channel_receive','invalid_data');return;}var ia=ha.obj.message,ja={author:ia.mercury_author_id,author_email:ia.mercury_author_email,body:ia.body,subject:ia.subject,has_attachment:ia.has_attachment,attachments:ia.attachments,html_body:ia.html_body,thread_id:ia.tid,message_id:ia.mid,coordinates:ia.mercury_coordinates,spoof_warning:ia.mercury_spoof_warning,source:ia.mercury_source,source_tags:ia.mercury_source_tags,threading_id:ia.threading_id,timestamp:ia.timestamp,timestamp_absolute:ia.timestamp_absolute,timestamp_relative:ia.timestamp_relative,action_type:p.MercuryActionType.USER_GENERATED_MESSAGE,is_unread:ia.is_unread,action_id:ia.action_id,is_forward:false,forward_count:ia.forward_count||ia.forward,forward_message_ids:ia.forward_msg_ids,location_text:ia.location_text,folder:ha.obj.folder},ka=[i({},ja)];ka=ka.concat(ia.forward_actions||[]);var la=p.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE;n.handleUpdateWaitForThread({actions:ka,payload_source:la},ia.tid);if(!ia.is_unread&&ia.mercury_author_id===l.user){var ma={};ma[ia.tid]=ha.obj.folder;s(h.getArbiterType('messaging'),{obj:{event:p.MessagingEventTypes.READ,tids:[ia.tid],folder_info:ma}});}k.addEntry('channel_receive','success',[ja.thread_id,ja.message_id,m.getSessionID()]);}function s(ga,ha){if(ga!=h.getArbiterType('messaging')||!ha.obj||!ha.obj.tids)return;var ia=[],ja=ha.obj.event==p.MessagingEventTypes.READ;ha.obj.tids.forEach(function(ka){ia.push({action_type:p.MercuryActionType.CHANGE_READ_STATUS,action_id:null,thread_id:ka,mark_as_read:ja,timestamp:ha.obj.timestamp||0,folder:ha.obj.folder_info[ka]});});n.handleUpdate({actions:ia,payload_source:p.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE});}function t(ga,ha){if(ga!=h.getArbiterType('messaging')||!ha.obj||!ha.obj.tids)return;var ia=[];ha.obj.tids.forEach(function(ja){ia.push({action_type:p.MercuryActionType.DELETE_THREAD,action_id:null,thread_id:ja});});n.handleUpdate({actions:ia,payload_source:p.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE});}function u(ga,ha){if(ga!=h.getArbiterType('messaging')||!ha.obj||!ha.obj.tids||!ha.obj.mids)return;var ia=ha.obj.tids[0],ja={action_type:p.MercuryActionType.DELETE_MESSAGES,action_id:null,thread_id:ia,message_ids:ha.obj.mids};n.handleUpdate({actions:[ja],threads:[ha.obj.updated_thread],payload_source:p.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE});}function v(ga,ha){if(ga!=h.getArbiterType('messaging')||!ha.obj||!ha.obj.folder)return;var ia={action_type:p.MercuryGlobalActionType.MARK_ALL_READ,action_id:ha.obj.action_id,folder:ha.obj.folder};n.handleUpdate({global_actions:[ia]});}function w(ga,ha){if(ga!=h.getArbiterType('messaging')||!ha.obj.tids)return;var ia=p.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE;ha.obj.tids.forEach(function(ja){var ka={action_type:p.MercuryActionType.CHANGE_ARCHIVED_STATUS,action_id:null,thread_id:ja,archived:ha.obj.state};n.handleUpdateWaitForThread({actions:[i({},ka)],payload_source:ia},ja);});}function x(ga,ha){if(ga!=h.getArbiterType('messaging')||!ha.obj.tids)return;var ia=p.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE,ja;ha.obj.tids.forEach(function(ka){if(ha.obj.event==p.MessagingEventTypes.TAG){ja=ha.obj.tag;}else ja=ha.obj.marked_as_spam?p.MessagingTag.SPAM:p.MessagingTag.INBOX;var la={action_type:p.MercuryActionType.CHANGE_FOLDER,action_id:null,thread_id:ka,new_folder:ja};n.handleUpdateWaitForThread({actions:[i({},la)],payload_source:ia},ka);});}function y(ga,ha){if(ga!=h.getArbiterType('messaging')||!ha.obj.tag)return;switch(ha.obj.tag){case p.MessagingTag.ACTION_ARCHIVED:w(ga,ha);break;case p.MessagingTag.INBOX:case p.MessagingTag.OTHER:x(ga,ha);break;}}function z(ga,ha,ia){return ga+':'+ha+':'+ia;}function aa(ga,ha){if(ga!=h.getArbiterType('inbox')||!ha.obj||!ha.obj.seen_timestamp)return;n.handleUpdate({message_counts:[{seen_timestamp:ha.obj.seen_timestamp,folder:p.MessagingTag.INBOX}],unseen_thread_ids:[{thread_ids:[],folder:p.MessagingTag.INBOX}],payload_source:p.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE});}function ba(ga,ha){if(ga!=h.getArbiterType('mercury')||!ha.obj)return;o.synchronizeInforms(function(){var ia=ha.obj,ja=[];(ia.actions||[]).forEach(function(ka){var la=p.MercuryActionType.USER_GENERATED_MESSAGE;if(ka.action_type==p.MercuryActionType.LOG_MESSAGE){var ma=p.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE;n.handleUpdateWaitForThread({actions:[i({},ka)],payload_source:ma},ka.thread_id);}else if(ka.action_type!=la)ja.push(ka);});ia.actions=ja;ia.payload_source=p.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE;n.handleUpdate(ia);});}function ca(ga,ha){n.handleRoger(ha.obj);}function da(ga,ha){switch(ha.obj.event){case p.MessagingEventTypes.DELIVER:r(ga,ha);break;case p.MessagingEventTypes.READ:case p.MessagingEventTypes.UNREAD:s(ga,ha);break;case p.MessagingEventTypes.READ_ALL:v(ga,ha);break;case p.MessagingEventTypes.DELETE:t(ga,ha);break;case p.MessagingEventTypes.DELETE_MESSAGES:u(ga,ha);break;case p.MessagingEventTypes.TAG:y(ga,ha);break;case p.MessagingEventTypes.REPORT_SPAM:x(ga,ha);break;case p.MessagingEventTypes.READ_RECEIPT:ca(ga,ha);break;}}var ea=[],fa={turnOn:function(){if(!ea.length){var ga={mercury:ba,messaging:da,inbox:aa};for(var ha in ga)ea.push(g.subscribe(h.getArbiterType(ha),ga[ha]));}},turnOff:function(){if(ea.length){ea.forEach(g.unsubscribe);ea=[];}}};fa.turnOn();e.exports=fa;});
__d("LiveMessageReceiver",["Arbiter","AsyncRequest","ChannelConstants","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('ChannelConstants'),j=b('copyProperties'),k=b('emptyFunction');function l(m){this.eventName=m;this.subs=null;this.handler=k;this.shutdownHandler=null;this.registered=false;this.appId=1;}j(l,{getAppMessageType:function(m,n){return 'live_message/'+m+':'+n;},route:function(m){var n=function(o){var p=l.getAppMessageType(m.app_id,m.event_name);g.inform(p,o,g.BEHAVIOR_PERSISTENT);};if(m.hasCapture){new h().setHandler(function(o){n(o.getPayload());}).setAllowCrossPageTransition(true).handleResponse(m.response);}else n(m.response);}});j(l.prototype,{setAppId:function(m){this.appId=m;return this;},setHandler:function(m){this.handler=m;this._dirty();return this;},setRestartHandler:k,setShutdownHandler:function(m){this.shutdownHandler=m.shield();this._dirty();return this;},_dirty:function(){if(this.registered){this.unregister();this.register();}},register:function(){var m=function(o,p){return this.handler(p);}.bind(this),n=l.getAppMessageType(this.appId,this.eventName);this.subs={};this.subs.main=g.subscribe(n,m);if(this.shutdownHandler)this.subs.shut=g.subscribe(i.ON_SHUTDOWN,this.shutdownHandler);this.registered=true;return this;},unregister:function(){if(!this.subs)return this;for(var m in this.subs)if(this.subs[m])this.subs[m].unsubscribe();this.subs=null;this.registered=false;return this;}});e.exports=l;});
__d("legacy:livemessage",["LiveMessageReceiver"],function(a,b,c,d){a.LiveMessageReceiver=b('LiveMessageReceiver');},3);
__d("MercuryUnreadState",["Arbiter","copyProperties","MercuryFolders","JSLogger","KeyedCallbackManager","createObjectFrom","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('MercuryFolders'),j=b('JSLogger'),k=b('KeyedCallbackManager'),l=b('createObjectFrom'),m=b('MercuryServerRequests'),n=b('MercuryThreadInformer'),o=b('MercuryThreads'),p=c('MercuryConstants'),q=(i.getSupportedFolders()||[]).filter(function(ma){return ma!=p.MessagingTag.ACTION_ARCHIVED;}),r={},s={},t={},u={},v={};q.forEach(function(ma){t[ma]=0;u[ma]=false;v[ma]=new k();});var w='unread_thread_hash',x='unseen_thread_list',y=p.MercuryThreadlistConstants.MAX_UNREAD_COUNT,z=j.create('mercury_unread_state'),aa={getUnreadCount:function(ma){if(aa.exceedsMaxCount(ma)){z.error('unguarded_unread_count_fetch',{});return 0;}return ea(ma);},exceedsMaxCount:function(ma){return u[ma]||(ea(ma)>y);},markFolderAsRead:function(ma){if(u[ma]||ea(ma)>0)m.markFolderAsRead(ma);}};function ba(ma,na){v[ma].setResource(w,na);v[ma].setResource(x,Object.keys(na));}function ca(ma,na){var oa=v[ma].executeOrEnqueue(w,na),pa=v[ma].getUnavailableResources(oa);if(pa.length)m.fetchUnreadThreadIDs(ma);}function da(ma){return v[ma].getResource(w);}function ea(ma){var na=v[ma].getResource(x);if(na){return na.length;}else return t[ma];}function fa(ma){var na;(ma.unread_thread_ids||[]).forEach(function(oa){na=oa.folder;if(!la(na))return;var pa=ja(oa.thread_ids);ba(na,l(pa,true));if(pa.length>y)u[na]=true;n.updatedUnreadState();});(ma.message_counts||[]).forEach(function(oa){if(oa.unread_count===undefined)return;na=oa.folder;if(oa.unread_count>y){u[na]=true;ba(na,{});n.updatedUnreadState();}else{t[na]=oa.unread_count;if(t[na]===0)ba(na,{});n.updatedUnreadState();}});(ma.actions||[]).forEach(function(oa){if(oa.is_forward)return;var pa=p.MercuryActionType,qa=oa.thread_id?oa.thread_id:oa.server_thread_id;if(oa.action_type==pa.DELETE_THREAD){q.forEach(function(sa){ha(sa,qa);});}else if(oa.action_type==pa.CHANGE_ARCHIVED_STATUS||oa.action_type==pa.CHANGE_FOLDER){var ra=o.getThreadMetaNow(oa.thread_id);na=i.getFromMeta(ra);if(la(na)&&ra.unread_count>0)ga(na,qa);q.forEach(function(sa){if(sa!=na)ha(sa,qa);});}else{na=oa.folder;if(!la(na))return;if(oa.action_type==pa.CHANGE_READ_STATUS){if(oa.mark_as_read){ha(na,qa,oa.timestamp);}else ga(na,qa,oa.timestamp);}else if(oa.action_type==pa.USER_GENERATED_MESSAGE||oa.action_type==pa.LOG_MESSAGE)if(oa.is_unread)ga(na,qa,oa.timestamp);}});}function ga(ma,na,oa){if(u[ma])return;ca(ma,function(pa){var qa=r[ma]||0,ra=s[na]||0,sa=oa||Number.POSITIVE_INFINITY;if(sa>=qa&&sa>=ra&&!pa[na]){pa[na]=oa||0;ba(ma,pa);n.updatedUnreadState();}});}function ha(ma,na,oa){if(u[ma])return;ca(ma,function(pa){if(oa){var qa=s[na];if(!qa||qa<oa)s[na]=oa;}var ra=pa[na];if(oa&&typeof ra=='number'&&oa<ra)return;if(na in pa){delete pa[na];ba(ma,pa);n.updatedUnreadState();}});}function ia(ma,na){u[ma]=false;ba(ma,{});r[ma]=Math.max(r[ma]||0,na||0);n.updatedUnreadState();}function ja(ma){return ma.map(m.convertThreadIDIfAvailable);}function ka(ma){q.forEach(function(na){var oa=da(na);if(!oa)return;for(var pa in ma){var qa=ma[pa];if(oa[pa]){oa[qa]=oa[pa];delete oa[pa];}}ba(na,oa);});}function la(ma){return q.contains(ma);}m.subscribe('update-unread',function(ma,na){fa(na);var oa=na.global_actions||[];for(var pa=0;pa<oa.length;pa++){var qa=oa[pa];if(qa.action_type==p.MercuryGlobalActionType.MARK_ALL_READ)ia(qa.folder,qa.timestamp);}});m.subscribe('update-thread-ids',function(ma,na){ka(na);});g.subscribe(j.DUMP_EVENT,function(ma,na){na.messaging=na.messaging||{};na.messaging.unread={};na.messaging.unread_max_count={};q.forEach(function(oa){na.messaging.unread[oa]=h({},da(oa));na.messaging.unread_max_count[oa]=u[oa];});});e.exports=aa;});
__d("MercuryLeftNavCountControl",["Arbiter","CSS","DOM","URI","MercuryUnreadState","MercuryServerRequests","MercuryThreadInformer","copyProperties","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('URI'),k=b('MercuryUnreadState'),l=b('MercuryServerRequests'),m=b('MercuryThreadInformer'),n=c('MercuryConstants'),o=b('copyProperties'),p,q,r=function(s,t){p=s;q=t;this.render();this.listenerToken=m.subscribe('unread-updated',this.render.bind(this));this.subscriptions=[g.subscribe('onload/exit',this.cleanup.bind(this))];};o(r.prototype,{render:function(){var s=k.exceedsMaxCount(n.MessagingTag.INBOX);if(s){i.setContent(p,n.MercuryThreadlistConstants.MAX_UNREAD_COUNT);}else{var t=k.getUnreadCount(n.MessagingTag.INBOX);i.setContent(p,t.toString());h.conditionClass(p.parentNode,'hidden_elem',t<=0);}i.setContent(q,s?'+':'');},cleanup:function(){this.subscriptions.forEach(g.unsubscribe);m.unsubscribe(this.listenerToken);}});e.exports=r;});
__d("MercuryLeftNav",["DOM","MercuryServerRequests","MercuryLeftNavCountControl"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('MercuryServerRequests'),i=b('MercuryLeftNavCountControl');e.exports=function(j,k){h.handleUpdate(k);var l=g.scry(j,'span.countValue')[0],m=g.scry(j,'span.maxCountIndicator')[0],n=new i(l,m);};});
__d("ControlledReferer",["event-extensions","URI"],function(a,b,c,d,e,f){b('event-extensions');var g=b('URI'),h={useFacebookReferer:function(i,j,k){var l=false;function m(){if(l)return;l=true;i.contentWindow.document.body.style.margin=0;j();}var n;if(document.domain!=='facebook.com'){n='/intern/common/referer_frame.php';}else if(g().isSecure()){n='https://s-static.ak.facebook.com/common/referer_frame.php';}else n='http://static.ak.facebook.com/common/referer_frame.php';if(k)n+='?fb_source='+k;Event.listen(i,'load',m);i.src=n;},useFacebookRefererHtml:function(i,j,k){h.useFacebookReferer(i,function(){i.contentWindow.document.body.innerHTML=j;},k);}};e.exports=h;});
__d("swfobject",["AsyncRequest","Bootloader","ControlledReferer","copyProperties","CSS","DOM","function-extensions","ge","htmlSpecialChars"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Bootloader'),i=b('ControlledReferer'),j=b('copyProperties'),k=b('CSS'),l=b('DOM');b('function-extensions');var m=b('ge'),n=b('htmlSpecialChars');if(typeof o=="undefined")var o={};if(typeof o.util=="undefined")o.util={};if(typeof o.SWFObjectUtil=="undefined")o.SWFObjectUtil={};o.SWFObject=function(u,v,w,x,y,z,aa,ba,ca,da){if(!document.getElementById)return;this.DETECT_KEY=da?da:'detectflash';this.skipDetect=o.util.getRequestParameter(this.DETECT_KEY);this.params={};this.variables={};this.attributes=[];this.fallback_html='';this.fallback_js_fcn=function(){};if(u)this.setAttribute('swf',u);if(v)this.setAttribute('id',v);if(w)this.setAttribute('width',w);if(x)this.setAttribute('height',x);this.installedVer=o.SWFObjectUtil.getPlayerVersion();if(y){if(!(y instanceof Array))y=[y];var ea;y.forEach(function(ha){ea=new o.PlayerVersion(ha.toString().split('.'));if(ea.major==this.installedVer.major){this.setAttribute('version',ea);return;}else if(!this.getAttribute('version')||ea.major<this.getAttribute('version').major)this.setAttribute('version',ea);}.bind(this));}if(!window.opera&&document.all&&this.installedVer.major>7)if(!o.unloadSet){o.SWFObjectUtil.prepUnload=function(){var ha=function(){},ia=function(){};window.attachEvent("onunload",o.SWFObjectUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",o.SWFObjectUtil.prepUnload);o.unloadSet=true;}if(z)this.addParam('bgcolor',z);var fa=aa?aa:'high';this.addParam('quality',fa);this.setAttribute('useExpressInstall',false);this.setAttribute('doExpressInstall',false);var ga=(ba)?ba:window.location;this.setAttribute('xiRedirectUrl',ga);this.setAttribute('redirectUrl','');if(ca)this.setAttribute('redirectUrl',ca);this.setAttribute('useIframe',false);};o.SWFObject.ieWorkaroundApplied=false;o.SWFObject.ensureIEWorkaroundAttached=function(){if(!o.SWFObject.ieWorkaroundApplied&&document.attachEvent){o.SWFObject.ieWorkaroundApplied=true;document.attachEvent('onpropertychange',o.SWFObject.onDocumentPropertyChange);}};o.SWFObject.onDocumentPropertyChange=function(event){if(event.propertyName=="title"){var u=document.title;if(u!=null&&u.indexOf('#!')!=-1){u=u.substring(0,u.indexOf('#!'));document.title=u;}}};j(o.SWFObject.prototype,{useExpressInstall:function(u){this.xiSWFPath=!u?"/swf/expressinstall.swf":u;this.setAttribute('useExpressInstall',true);},setAttribute:function(u,v){this.attributes[u]=v;},getAttribute:function(u){return this.attributes[u]||"";},addParam:function(u,v){this.params[u]=v;},getParams:function(){return this.params;},addVariable:function(u,v){this.variables[u]=v;},getVariable:function(u){return this.variables[u]||"";},getVariables:function(){return this.variables;},getVariablePairs:function(){var u=[],v,w=this.getVariables();for(v in w)u[u.length]=v+"="+w[v];return u.join('&');},getSWFHTML:function(){var u,v,w;if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute('swf',this.xiSWFPath);}v={type:'application/x-shockwave-flash',src:this.getAttribute('swf'),width:this.getAttribute('width'),height:this.getAttribute('height'),style:this.getAttribute('style')||'display: block;',id:this.getAttribute('id'),name:this.getAttribute('id')};var x=this.getParams();for(var y in x)v[y]=x[y];w=this.getVariablePairs();if(w)v.flashvars=w;u=t('embed',v,null);}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute('swf',this.xiSWFPath);}v={id:this.getAttribute('id'),classid:'clsid:D27CDB6E-AE6D-11cf-96B8-444553540000',width:this.getAttribute('width'),height:this.getAttribute('height'),style:this.getAttribute('style')||'display: block;'};var z=t('param',{name:'movie',value:this.getAttribute('swf')},null),x=this.getParams();for(var y in x)z+=t('param',{name:y,value:x[y]},null);w=this.getVariablePairs();if(w)z+=t('param',{name:'flashvars',value:w},null);u=t('object',v,z);}return u;},write:function(u){if(this.getAttribute('useExpressInstall')){var v=new o.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(v)&&!this.installedVer.versionIsValid(this.getAttribute('version'))){this.setAttribute('doExpressInstall',true);this.addVariable("MMredirectURL",escape(this.getAttribute('xiRedirectUrl')));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}var w=(typeof u=='string')?document.getElementById(u):u;if(!w)return false;k.addClass(w,'swfObject');w.setAttribute('data-swfid',this.getAttribute('id'));if(this.skipDetect||this.getAttribute('doExpressInstall')||this.installedVer.versionIsValid(this.getAttribute('version'))){if(!this.getAttribute('useIframe')){o.SWFObject.ensureIEWorkaroundAttached();w.innerHTML=this.getSWFHTML();}else this._createIframe(w);return true;}else{if(this.getAttribute('redirectUrl')!="")document.location.replace(this.getAttribute('redirectUrl'));var x=this.getAttribute('version').major+'.'+this.getAttribute('version').minor+'.'+this.getAttribute('version').release+'.'+this.getAttribute('version').build,y=this.installedVer.major+'.'+this.installedVer.minor+'.'+this.installedVer.release+'.'+this.installedVer.build;this.fallback_js_fcn(y,x);w.innerHTML=this.fallback_html;}return false;},_createIframe:function(u){var v=l.create('iframe',{width:this.getAttribute('width'),height:this.getAttribute('height'),frameBorder:0});l.empty(u);u.appendChild(v);i.useFacebookRefererHtml.bind(null,v,this.getSWFHTML(),this.getAttribute('iframeSource')).defer();}});o.SWFObjectUtil.getPlayerVersion=function(){var u=new o.PlayerVersion([0,0,0,0]),v;if(navigator.plugins&&navigator.mimeTypes.length){for(var w=0;w<navigator.plugins.length;w++)try{var y=navigator.plugins[w];if(y.name=='Shockwave Flash'){v=new o.PlayerVersion(y.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+(r|d)|\s+b[0-9]+)/,".").split("."));if(typeof u=='undefined'||v.major>u.major||(v.major==u.major&&(v.minor>u.minor||(v.minor==u.minor&&(v.release>u.release||(v.release==u.release&&v.build>u.build))))))u=v;}}catch(x){}}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var z=1,aa=3;while(z)try{aa++;z=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+aa);u=new o.PlayerVersion([aa,0,0]);}catch(ba){z=null;}}else{try{var z=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(ca){try{var z=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");u=new o.PlayerVersion([6,0,21]);z.AllowScriptAccess="always";}catch(da){if(u.major==6)return u;}try{z=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(ea){}}if(z!=null)u=new o.PlayerVersion(z.GetVariable("$version").split(" ")[1].split(","));}return u;};o.PlayerVersion=function(u){this.major=u[0]!=null?parseInt(u[0],10):0;this.minor=u[1]!=null?parseInt(u[1],10):0;this.release=u[2]!=null?parseInt(u[2],10):0;this.build=u[3]!=null?parseInt(u[3],10):0;};o.PlayerVersion.prototype.versionIsValid=function(u){if(this.major<u.major)return false;if(this.major>u.major)return true;if(this.minor<u.minor)return false;if(this.minor>u.minor)return true;if(this.release<u.release)return false;if(this.release>u.release)return true;if(this.build<u.build)return false;return true;};o.util={getRequestParameter:function(u){var v=document.location.search||document.location.hash;if(u==null)return v;if(v){var w=v.substring(1).split("&");for(var x=0;x<w.length;x++)if(w[x].substring(0,w[x].indexOf("="))==u)return w[x].substring((w[x].indexOf("=")+1));}return "";}};o.SWFObjectUtil.cleanupSWFs=function(){var u=document.getElementsByTagName("OBJECT");for(var v=u.length-1;v>=0;v--){u[v].style.display='none';for(var w in u[v])if(typeof u[v][w]=='function')u[v][w]=function(){};}};if(!document.getElementById&&document.all)document.getElementById=function(u){return document.all[u];};var p=o.util.getRequestParameter,q=o.SWFObject,r=o.SWFObject;o.spawn_flash_update_dialog=function(){new g().setURI('/ajax/flash_update_dialog.php').setMethod('GET').setReadOnly(true).send();};function s(u,v){var w=m(u),x=o.SWFObjectUtil.getPlayerVersion(),y;v.forEach(function(ba){ba=new o.PlayerVersion(ba.toString().split('.'));if(ba.major==x.major){y=ba;return;}else if(typeof y=='undefined'||ba.major<y.major)y=ba;}.bind(this));if(w&&x.major>0){var z=x.major+'.'+x.minor+'.'+x.release+'.'+x.build,aa=y.major+'.'+y.minor+'.'+y.release+'.'+y.build;l.setContent(w,l.tx._("Flash {required-version} is required to view this content. Your current version is {current-version}. Please download the latest Flash Player.",{'required-version':aa,'current-version':z}));}}o.showFlashErrorDialog=function(u,v){h.loadModules(['ErrorDialog'],function(w){w.show(u,v);});};function t(u,v,w){var x=/^[A-Za-z0-9\-]+$/;if(!u.match(x))throw new Error('Invalid tag '+u);var y='<'+u;for(var z in v){if(!z.match(x))throw new Error('Invalid attr '+z);y+=' '+z+'="'+n(v[z])+'"';}if(w===null){return y+'/>';}else return y+'>'+w+'</'+u+'>';}e.exports=a.deconcept||o;});
__d("RenderManager",["function-extensions","copyProperties"],function(a,b,c,d,e,f){b('function-extensions');var g=b('copyProperties');function h(i){this._isDirty=false;this._obj=i;}g(h.prototype,{dirty:function(){if(!this._isDirty){this._isDirty=true;this._doPaint.bind(this).defer();}},_doPaint:function(){this._isDirty=false;this._obj.paint();}});e.exports=h;});
__d("CounterDisplay",["Arbiter","CSS","DOM","RenderManager","Run","$","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('RenderManager'),k=b('Run'),l=b('$'),m=b('copyProperties');function n(o,p,q,r,s,t){m(this,{_name:o,_valueNode:l(p),_wrapperNode:l(q)||null,_statusClass:s,_rm:new j(this),_arbiterSubscription:null,_count:0});var u=this._valueNode.firstChild;if(u){var v=parseInt(u.nodeValue,10);if(!isNaN(v))this._count=v;}this._statusNode=r?l(r):null;this._subscribeAll();n.instances.push(this);if(!t)k.onLeave(this._destroy.bind(this),true);}m(n,{EVENT_TYPE_ADJUST:'CounterDisplay/adjust',EVENT_TYPE_UPDATE:'CounterDisplay/update',instances:[],adjustCount:function(o,p){g.inform(n.EVENT_TYPE_ADJUST+'/'+o,p);},setCount:function(o,p){g.inform(n.EVENT_TYPE_UPDATE+'/'+o,p);}});m(n.prototype,{_destroy:function(){delete this._valueNode;delete this._wrapperNode;if(this._arbiterSubscription){this._arbiterSubscription.unsubscribe();delete this._arbiterSubscription;}n.instances.remove(this);},adjustCount:function(o){this._count=Math.max(0,this._count+o);this._rm.dirty();return this;},setCount:function(o){this._count=Math.max(0,o);this._rm.dirty();return this;},paint:function(){i.setContent(this._valueNode,this._count);this._toggleNodes();},_toggleNodes:function(){if(this._wrapperNode)h.conditionClass(this._wrapperNode,'hidden_elem',this._count<=0);if(this._statusClass&&this._statusNode)h.conditionClass(this._statusNode,this._statusClass,this._count>0);},_subscribeAll:function(){var o=[n.EVENT_TYPE_ADJUST+'/'+this._name,n.EVENT_TYPE_UPDATE+'/'+this._name];this._arbiterSubscription=g.subscribe(o,this._onInform.bind(this),g.SUBSCRIBE_NEW);},_onInform:function(o,p){p=parseInt(p);if(isNaN(p)){emptyFunction("Passed invalid counter value: '%s'",p);return;}if(o.indexOf(n.EVENT_TYPE_ADJUST)!=-1){this.adjustCount(p);}else if(o.indexOf(n.EVENT_TYPE_UPDATE)!=-1){this.setCount(p);}else{emptyFunction("Invalid event type in CounterDisplay handler: '%s'",o);return;}return;}});e.exports=n;});
__d("AsyncLayout",["AjaxPipeRequest","Arbiter","AsyncRequest","AsyncResponse","CSS","DOM","HTML","NavigationMessage","PageTransitions","URI","$","copyProperties","emptyFunction","ge","goURI"],function(a,b,c,d,e,f){var g=b('AjaxPipeRequest'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('AsyncResponse'),k=b('CSS'),l=b('DOM'),m=b('HTML'),n=b('NavigationMessage'),o=b('PageTransitions'),p=b('URI'),q=b('$'),r=b('copyProperties'),s=b('emptyFunction'),t=b('ge'),u=b('goURI');function v(w){this.canvasID=w;if(t('rightCol'))this.auxiliaryID='rightCol';if(t('headerArea'))this.headerID='headerArea';if(t('toolbarContainer'))this.toolbarID='toolbarContainer';this.waitingForAux=false;o.registerHandler(this.catchPageTransition.bind(this));this.subscription=h.subscribe(n.NAVIGATION_BEGIN,this.onNavigate.bind(this));}r(v.prototype,{catchPageTransition:function(w){this.subscription.unsubscribe();return false;},getCanvasID:function(w){return w.sidecol?'contentCol':'contentArea';},onNavigate:function(w,x){var y=x.useAjaxPipe;x=x.params;if(x.endpoint){if(this.request){this.request.setFinallyHandler(s);this.request.abort();}if(this.sideRequest)this.sideRequest.abort();if(y){this.request=new g().setURI(x.endpoint).setData(x).setCanvasId(this.getCanvasID(x)).setFinallyHandler(this.finallyHandler.bind(this)).setErrorHandler(this.errorHandler.bind(this)).setFirstResponseCallback(this.firstResponseCallback.bind(this)).send();}else{x.handled=true;this.waitingForAux=x.sidecol;var z=!!x.iframe,aa=new i().setOption('useIframeTransport',z).setURI(new p(x.endpoint)).setReadOnly(true).setMethod('GET').setData(x).setHandler(this.onResponse.bind(this)).setErrorHandler(this.errorHandler.bind(this)).setFinallyHandler(this.finallyHandler.bind(this));this.request=aa;aa.send();}}},onSideResponse:function(w){var x=w.getPayload();if(x&&this.auxiliaryID)this.receivedAux(x);},receivedAux:function(w){if(!this.waitingForAux)s("The side column should not be provided twice, there may be "+"double rendering of ads occurring.");this.waitingForAux=false;l.setContent(q(this.auxiliaryID),m(w));},onResponse:function(w){var x=w.getPayload();if(x.redirect){u(x.redirect);}else{var y=x.html||x;l.setContent(q(this.canvasID),m(y));if(x.side_html&&this.auxiliaryID)this.receivedAux(x.side_html);if(this.headerID&&!x.keep_header){var z=q(this.headerID);l.setContent(z,m(x.header_html||''));k.conditionShow(z,x.header_html);}if(x.toolbar_html&&this.toolbarID)l.setContent(q(this.toolbarID),m(x.toolbar_html));if(x.js)(new Function(x.js))();k.conditionClass('contentCol','hasRightCol',this.auxiliaryID&&!x.noRightSide);var aa=t('rightCol');if(aa&&x.noRightSide)l.empty(aa);}var ba=w.getRequest().getData();h.inform(n.NAVIGATION_COMPLETED,ba.key);},errorHandler:function(w){j.verboseErrorHandler(w);h.inform(n.NAVIGATION_FAILED);this.request=null;},firstResponseCallback:function(w){window.scrollTo(0,0);h.inform(n.NAVIGATION_FIRST_RESPONSE);},finallyHandler:function(w){this.request=null;o.transitionComplete(true);h.inform(n.NAVIGATION_COMPLETED);}});e.exports=v;});
__d("swfobject2",[],function(a,b,c,d,e,f){var g=function(){var h="undefined",i="object",j="Shockwave Flash",k="ShockwaveFlash.ShockwaveFlash",l="application/x-shockwave-flash",m="SWFObjectExprInst",n="onreadystatechange",o=window,p=document,q=navigator,r=false,s=[ka],t=[],u=[],v=[],w,x,y,z,aa=false,ba=false,ca,da,ea=true,fa=function(){var eb=typeof p.getElementById!=h&&typeof p.getElementsByTagName!=h&&typeof p.createElement!=h,fb=q.userAgent.toLowerCase(),gb=q.platform.toLowerCase(),hb=gb?/win/.test(gb):/win/.test(fb),ib=gb?/mac/.test(gb):/mac/.test(fb),jb=/webkit/.test(fb)?parseFloat(fb.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,kb=!+"\v1",lb=[0,0,0],mb=null;if(typeof q.plugins!=h&&typeof q.plugins[j]==i){mb=q.plugins[j].description;if(mb&&!(typeof q.mimeTypes!=h&&q.mimeTypes[l]&&!q.mimeTypes[l].enabledPlugin)){r=true;kb=false;mb=mb.replace(/^.*\s+(\S+\s+\S+$)/,"$1");lb[0]=parseInt(mb.replace(/^(.*)\..*$/,"$1"),10);lb[1]=parseInt(mb.replace(/^.*\.(.*)\s.*$/,"$1"),10);lb[2]=/[a-zA-Z]/.test(mb)?parseInt(mb.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0;}}else if(typeof o.ActiveXObject!=h)try{var ob=new ActiveXObject(k);if(ob){mb=ob.GetVariable("$version");if(mb){kb=true;mb=mb.split(" ")[1].split(",");lb=[parseInt(mb[0],10),parseInt(mb[1],10),parseInt(mb[2],10)];}}}catch(nb){}return {w3:eb,pv:lb,wk:jb,ie:kb,win:hb,mac:ib};}(),ga=function(){if(!fa.w3)return;if((typeof p.readyState!=h&&p.readyState=="complete")||(typeof p.readyState==h&&(p.getElementsByTagName("body")[0]||p.body)))ha();if(!aa){if(typeof p.addEventListener!=h)p.addEventListener("DOMContentLoaded",ha,false);if(fa.ie&&fa.win){p.attachEvent(n,function(){if(p.readyState=="complete"){p.detachEvent(n,arguments.callee);ha();}});if(o==top)(function(){if(aa)return;try{p.documentElement.doScroll("left");}catch(eb){setTimeout(arguments.callee,0);return;}ha();})();}if(fa.wk)(function(){if(aa)return;if(!/loaded|complete/.test(p.readyState)){setTimeout(arguments.callee,0);return;}ha();})();ja(ha);}}();function ha(){if(aa)return;try{var fb=p.getElementsByTagName("body")[0].appendChild(xa("span"));fb.parentNode.removeChild(fb);}catch(eb){return;}aa=true;var gb=s.length;for(var hb=0;hb<gb;hb++)s[hb]();}function ia(eb){if(aa){eb();}else s[s.length]=eb;}function ja(eb){if(typeof o.addEventListener!=h){o.addEventListener("load",eb,false);}else if(typeof p.addEventListener!=h){p.addEventListener("load",eb,false);}else if(typeof o.attachEvent!=h){ya(o,"onload",eb);}else if(typeof o.onload=="function"){var fb=o.onload;o.onload=function(){fb();eb();};}else o.onload=eb;}function ka(){if(r){la();}else ma();}function la(){var eb=p.getElementsByTagName("body")[0],fb=xa(i);fb.setAttribute("type",l);fb.setAttribute('style','visibility: hidden; position: absolute; top: -1000px;');var gb=eb.appendChild(fb);if(gb){var hb=0;(function(){if(typeof gb.GetVariable!=h){var ib=gb.GetVariable("$version");if(ib){ib=ib.split(" ")[1].split(",");fa.pv=[parseInt(ib[0],10),parseInt(ib[1],10),parseInt(ib[2],10)];}}else if(hb<10){hb++;setTimeout(arguments.callee,10);return;}gb=null;ma();})();}else ma();}function ma(){var eb=t.length;if(eb>0)for(var fb=0;fb<eb;fb++){var gb=t[fb].id,hb=t[fb].callbackFn,ib={success:false,id:gb};if(fa.pv[0]>0){var jb=wa(gb);if(jb)if(za(t[fb].swfVersion)&&!(fa.wk&&fa.wk<312)){bb(gb,true);if(hb){ib.success=true;ib.ref=na(gb);hb(ib);}}else if(t[fb].expressInstall&&oa()){var kb={};kb.data=t[fb].expressInstall;kb.width=jb.getAttribute("width")||"0";kb.height=jb.getAttribute("height")||"0";if(jb.getAttribute("class"))kb.styleclass=jb.getAttribute("class");if(jb.getAttribute("align"))kb.align=jb.getAttribute("align");var lb={},mb=jb.getElementsByTagName("param"),nb=mb.length;for(var ob=0;ob<nb;ob++)if(mb[ob].getAttribute("name").toLowerCase()!="movie")lb[mb[ob].getAttribute("name")]=mb[ob].getAttribute("value");pa(kb,lb,gb,hb);}else{qa(jb);if(hb)hb(ib);}}else{bb(gb,true);if(hb){var pb=na(gb);if(pb&&typeof pb.SetVariable!=h){ib.success=true;ib.ref=pb;}hb(ib);}}}}function na(eb){var fb=null,gb=wa(eb);if(gb&&gb.nodeName=="OBJECT")if(typeof gb.SetVariable!=h){fb=gb;}else{var hb=gb.getElementsByTagName(i)[0];if(hb)fb=hb;}return fb;}function oa(){return !ba&&za("6.0.65")&&(fa.win||fa.mac)&&!(fa.wk&&fa.wk<312);}function pa(eb,fb,gb,hb){ba=true;y=hb||null;z={success:false,id:gb};var ib=wa(gb);if(ib){if(ib.nodeName=="OBJECT"){w=ra(ib);x=null;}else{w=ib;x=gb;}eb.id=m;if(typeof eb.width==h||(!/%$/.test(eb.width)&&parseInt(eb.width,10)<310))eb.width="310";if(typeof eb.height==h||(!/%$/.test(eb.height)&&parseInt(eb.height,10)<137))eb.height="137";p.title=p.title.slice(0,47)+" - Flash Player Installation";var jb=fa.ie&&fa.win?"ActiveX":"PlugIn",kb="MMredirectURL="+o.location.toString().replace(/&/g,"%26")+"&MMplayerType="+jb+"&MMdoctitle="+p.title;if(typeof fb.flashvars!=h){fb.flashvars+="&"+kb;}else fb.flashvars=kb;if(fa.ie&&fa.win&&ib.readyState!=4){var lb=xa("div");gb+="SWFObjectNew";lb.setAttribute("id",gb);ib.parentNode.insertBefore(lb,ib);ib.style.display="none";(function(){if(ib.readyState==4){ib.parentNode.removeChild(ib);}else setTimeout(arguments.callee,10);})();}sa(eb,fb,gb);}}function qa(eb){if(fa.ie&&fa.win&&eb.readyState!=4){var fb=xa("div");eb.parentNode.insertBefore(fb,eb);fb.parentNode.replaceChild(ra(eb),fb);eb.style.display="none";(function(){if(eb.readyState==4){eb.parentNode.removeChild(eb);}else setTimeout(arguments.callee,10);})();}else eb.parentNode.replaceChild(ra(eb),eb);}function ra(eb){var fb=xa("div");if(fa.win&&fa.ie){fb.innerHTML=eb.innerHTML;}else{var gb=eb.getElementsByTagName(i)[0];if(gb){var hb=gb.childNodes;if(hb){var ib=hb.length;for(var jb=0;jb<ib;jb++)if(!(hb[jb].nodeType==1&&hb[jb].nodeName=="PARAM")&&!(hb[jb].nodeType==8))fb.appendChild(hb[jb].cloneNode(true));}}}return fb;}function sa(eb,fb,gb){var hb,ib=wa(gb);if(fa.wk&&fa.wk<312)return hb;if(ib){if(typeof eb.id==h)eb.id=gb;if(fa.ie&&fa.win){var jb="";for(var kb in eb)if(eb[kb]!=Object.prototype[kb])if(kb.toLowerCase()=="data"){fb.movie=eb[kb];}else if(kb.toLowerCase()=="styleclass"){jb+=' class="'+eb[kb]+'"';}else if(kb.toLowerCase()!="classid")jb+=' '+kb+'="'+eb[kb]+'"';var lb="";for(var mb in fb)if(fb[mb]!=Object.prototype[mb])lb+='<param name="'+mb+'" value="'+fb[mb]+'" />';ib.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+jb+'>'+lb+'</object>';u[u.length]=eb.id;hb=wa(eb.id);}else{var nb=xa(i);nb.setAttribute("type",l);for(var ob in eb)if(eb[ob]!=Object.prototype[ob])if(ob.toLowerCase()=="styleclass"){nb.setAttribute("class",eb[ob]);}else if(ob.toLowerCase()!="classid")nb.setAttribute(ob,eb[ob]);for(var pb in fb)if(fb[pb]!=Object.prototype[pb]&&pb.toLowerCase()!="movie")ta(nb,pb,fb[pb]);ib.parentNode.replaceChild(nb,ib);hb=nb;}}return hb;}function ta(eb,fb,gb){var hb=xa("param");hb.setAttribute("name",fb);hb.setAttribute("value",gb);eb.appendChild(hb);}function ua(eb){var fb=wa(eb);if(fb&&fb.nodeName=="OBJECT")if(fa.ie&&fa.win){fb.style.display="none";(function(){if(fb.readyState==4){va(eb);}else setTimeout(arguments.callee,10);})();}else fb.parentNode.removeChild(fb);}function va(eb){var fb=wa(eb);if(fb){for(var gb in fb)if(typeof fb[gb]=="function")fb[gb]=null;fb.parentNode.removeChild(fb);}}function wa(eb){var fb=null;try{fb=p.getElementById(eb);}catch(gb){}return fb;}function xa(eb){return p.createElement(eb);}function ya(eb,fb,gb){eb.attachEvent(fb,gb);v[v.length]=[eb,fb,gb];}function za(eb){var fb=fa.pv,gb=eb.split(".");gb[0]=parseInt(gb[0],10);gb[1]=parseInt(gb[1],10)||0;gb[2]=parseInt(gb[2],10)||0;return (fb[0]>gb[0]||(fb[0]==gb[0]&&fb[1]>gb[1])||(fb[0]==gb[0]&&fb[1]==gb[1]&&fb[2]>=gb[2]))?true:false;}function ab(eb,fb,gb,hb){if(fa.ie&&fa.mac)return;var ib=p.getElementsByTagName("head")[0];if(!ib)return;var jb=(gb&&typeof gb=="string")?gb:"screen";if(hb){ca=null;da=null;}if(!ca||da!=jb){var kb=xa("style");kb.setAttribute("type","text/css");kb.setAttribute("media",jb);ca=ib.appendChild(kb);if(fa.ie&&fa.win&&typeof p.styleSheets!=h&&p.styleSheets.length>0)ca=p.styleSheets[p.styleSheets.length-1];da=jb;}if(fa.ie&&fa.win){if(ca&&typeof ca.addRule==i)ca.addRule(eb,fb);}else if(ca&&typeof p.createTextNode!=h)ca.appendChild(p.createTextNode(eb+" {"+fb+"}"));}function bb(eb,fb){if(!ea)return;var gb=fb?"visible":"hidden";if(aa&&wa(eb)){wa(eb).style.visibility=gb;}else ab("#"+eb,"visibility:"+gb);}function cb(eb){var fb=/[\\\"<>\.;]/,gb=fb.exec(eb)!=null;return gb&&typeof encodeURIComponent!=h?encodeURIComponent(eb):eb;}var db=function(){if(fa.ie&&fa.win)window.attachEvent("onunload",function(){var eb=v.length;for(var fb=0;fb<eb;fb++)v[fb][0].detachEvent(v[fb][1],v[fb][2]);var gb=u.length;for(var hb=0;hb<gb;hb++)ua(u[hb]);for(var ib in fa)fa[ib]=null;fa=null;for(var jb in g)g[jb]=null;g=null;});}();return {registerObject:function(eb,fb,gb,hb){if(fa.w3&&eb&&fb){var ib={};ib.id=eb;ib.swfVersion=fb;ib.expressInstall=gb;ib.callbackFn=hb;t[t.length]=ib;bb(eb,false);}else if(hb)hb({success:false,id:eb});},getObjectById:function(eb){if(fa.w3)return na(eb);},embedSWF:function(eb,fb,gb,hb,ib,jb,kb,lb,mb,nb){var ob={success:false,id:fb};if(fa.w3&&!(fa.wk&&fa.wk<312)&&eb&&fb&&gb&&hb&&ib){bb(fb,false);ia(function(){gb+="";hb+="";var pb={};if(mb&&typeof mb===i)for(var qb in mb)pb[qb]=mb[qb];pb.data=eb;pb.width=gb;pb.height=hb;var rb={};if(lb&&typeof lb===i)for(var sb in lb)rb[sb]=lb[sb];if(kb&&typeof kb===i)for(var tb in kb)if(typeof rb.flashvars!=h){rb.flashvars+="&"+tb+"="+kb[tb];}else rb.flashvars=tb+"="+kb[tb];if(za(ib)){var ub=sa(pb,rb,fb);if(pb.id==fb)bb(fb,true);ob.success=true;ob.ref=ub;}else if(jb&&oa()){pb.data=jb;pa(pb,rb,fb,nb);return;}else bb(fb,true);if(nb)nb(ob);});}else if(nb)nb(ob);},switchOffAutoHideShow:function(){ea=false;},ua:fa,getFlashPlayerVersion:function(){return {major:fa.pv[0],minor:fa.pv[1],release:fa.pv[2]};},hasFlashPlayerVersion:za,createSWF:function(eb,fb,gb){if(fa.w3){return sa(eb,fb,gb);}else return undefined;},showExpressInstall:function(eb,fb,gb,hb){if(fa.w3&&oa())pa(eb,fb,gb,hb);},removeSWF:function(eb){if(fa.w3)ua(eb);},createCSS:function(eb,fb,gb,hb){if(fa.w3)ab(eb,fb,gb,hb);},addDomLoadEvent:ia,addLoadEvent:ja,getQueryParamValue:function(eb){var fb=p.location.search||p.location.hash;if(fb){if(/\?/.test(fb))fb=fb.split("?")[1];if(eb==null)return cb(fb);var gb=fb.split("&");for(var hb=0;hb<gb.length;hb++)if(gb[hb].substring(0,gb[hb].indexOf("="))==eb)return cb(gb[hb].substring((gb[hb].indexOf("=")+1)));}return "";},expressInstallCallback:function(){if(ba){var eb=wa(m);if(eb&&w){eb.parentNode.replaceChild(w,eb);if(x){bb(x,true);if(fa.ie&&fa.win)w.style.display="block";}if(y)y(z);}ba=false;}}};}();e.exports=g;});
__d("SoundPlayer",["Arbiter","ChatConfig","Env","swfobject","swfobject2","URI","createArrayFrom"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChatConfig'),i=b('Env'),j=b('swfobject').SWFObject,k=b('swfobject2'),l=b('URI'),m=b('createArrayFrom'),n={},o=null,p=false,q='so_sound_player',r='/swf/SoundPlayerHater.swf',s='10.0.22.87',t=null,u=h.get('sound.useswfobject_2',false),v=h.get('sound.force_flash',false);function w(ea){var fa=l(ea);if(!fa.getDomain())return l(i.static_base).setPath(fa.getPath()).toString();return ea;}function x(ea){if(/\.mp3$/.test(ea))return 'audio/mpeg';if(/\.og[ga]$/.test(ea))return 'audio/ogg';return '';}function y(){if(!t&&!v){var ea=document.createElement('audio');if(!ea||!ea.canPlayType)return null;ea.setAttribute('preload','auto');document.body.appendChild(ea);t=ea;}return t;}function z(){var ea=document[q]||window[q];if(ea)if(!ea.playSound&&ea.length)ea=ea[0];return (ea&&ea.playSound&&ea.loopSound)?ea:null;}function aa(){return p;}function ba(ea,fa,ga){o={path:ea,sync:fa,loop:ga};}function ca(){p=true;if(o){var ea=z();if(o.loop){ea.loopSound(o.path,o.sync);}else ea.playSound(o.path,o.sync);}}var da={init:function(ea){ea=m(ea);var fa;for(var ga=0;ga<ea.length;++ga){fa=ea[ga];if(n[fa])return;}var ha=y();for(ga=0;ha&&ga<ea.length;++ga){fa=ea[ga];if(ha.canPlayType(fa)){n[fa]=true;return;}}n['audio/mpeg']=true;if(z())return;try{g.registerCallback(ca,['sound/player_ready','sound/ready']);var ja=document.createElement('div');ja.id='sound_player_holder';document.body.appendChild(ja);if(u){k.embedSWF(r,ja.id,'1px','1px',s,null,{swf_id:q},{allowscriptaccess:'always',wmode:'transparent'},null,function(la){window[q]=la.ref;g.inform('sound/player_ready');});}else{var ka=new j(r,q,'1px','1px',[s],'#ffffff');ka.addParam('allowscriptaccess','always');ka.addParam('wmode','transparent');ka.addVariable('swf_id',q);ka.fallback_html=' ';ka.write(ja.id);window[q]=ka;g.inform('sound/player_ready');}}catch(ia){}},play:function(ea,fa){ea=m(ea);var ga=y(),ha,ia;for(var ja=0;ga&&ja<ea.length;++ja){ha=ea[ja];ia=x(ha);if(!ga.canPlayType(ia))continue;da.init([ia]);ga.src=w(ha);if(fa){ga.setAttribute('loop','');}else ga.removeAttribute('loop');ga.play();return;}for(ja=0;ja<ea.length;++ja){ha=w(ea[ja]);ia=x(ha);if(ia!='audio/mpeg')continue;da.init([ia]);var ka=z();if(!aa()){ba(ha,true,fa);return;}else if(ka){if(fa){ka.loopSound(ha,true);}else ka.playSound(ha,true);return;}}},stop:function(ea){ea=m(ea);for(var fa=0;fa<ea.length;++fa){var ga=w(ea[fa]),ha=y(),ia=z();if(ha&&ha.src==ga){ha.pause();ha.src=undefined;}else ia&&ia.stopSound(ga);}}};e.exports=da;});
__d("SoundSynchronizer",["event-extensions","hasArrayNature","SoundPlayer","createArrayFrom"],function(a,b,c,d,e,f){b('event-extensions');var g=b('hasArrayNature'),h=b('SoundPlayer'),i=b('createArrayFrom'),j='fb_sounds_playing3';function k(){if(window.localStorage)try{var p=window.localStorage[j];if(p){p=JSON.parse(p);if(g(p))return p;}}catch(o){}return [];}function l(o){if(window.localStorage){var p=k();p.push(o);while(p.length>5)p.shift();try{window.localStorage[j]=JSON.stringify(p);}catch(q){}}}function m(o){return k().some(function(p){return p===o;});}var n={play:function(o,p,q){o=i(o);p=p||(o[0]+Math.floor(Date.now()/1000));if(m(p))return;h.play(o,q);l(p);},isSupported:function(){return !!window.localStorage;}};e.exports=n;});
__d("SoundRPC",["event-extensions","SoundSynchronizer"],function(a,b,c,d,e,f){b('event-extensions');var g=b('SoundSynchronizer');function h(j,k,l){g.play(j,k,l);}var i={playLocal:h,playRemote:function(j,k,l,m){var n={paths:k,sync:l,loop:m};j.postMessage(JSON.stringify(n),'*');},supportsRPC:function(){return !!window.postMessage;},_listen:function(){Event.listen(window,'message',function(j){if(!/\.facebook.com$/.test(j.origin))return;var k=JSON.parse(j.data);h(k.paths,k.sync,k.loop);});}};e.exports=i;});
__d("Sound",["SoundPlayer","SoundRPC","SoundSynchronizer","UserAgent"],function(a,b,c,d,e,f){var g=b('SoundPlayer'),h=b('SoundRPC'),i=b('SoundSynchronizer'),j=b('UserAgent'),k=null,l={init:function(o){if(!k)g.init(o);},play:function(o,p,q){if(k){h.playRemote(k.contentWindow,o,p,false);}else h.playLocal(o,p,q);},stop:function(o){if(!k)g.stop(o);}},m=location.host.replace(/^[^.]+/,'www');function n(){if(j.ie()<9)return false;return i.isSupported()&&h.supportsRPC();}if(location.host!==m&&n()){k=document.createElement('iframe');k.setAttribute('src','//'+m+'/sound_iframe.php');k.style.display='none';document.body.appendChild(k);}e.exports=l;});
function BulkTagLoader(){}copyProperties(BulkTagLoader,{_requested:false,loadForSet:function(a){if(!BulkTagLoader._requested){BulkTagLoader._requested=true;new AsyncRequest('/ajax/photos/sets/tags_fetch.php').setHandler(emptyFunction).setData({set:a}).send();}},loadForAlbum:function(a){if(!BulkTagLoader._requested){BulkTagLoader._requested=true;new AsyncRequest('/ajax/photos/album/tags_fetch.php').setHandler(emptyFunction).setData({fbid:a}).send();}},reset:function(){BulkTagLoader._requested=false;}});