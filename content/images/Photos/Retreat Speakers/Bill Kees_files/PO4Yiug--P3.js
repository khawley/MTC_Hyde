/*1349661942,173217045*/

if (window.CavalryLogger) { CavalryLogger.start_js(["1hvRj"]); }

__d("legacy:bind",["bind"],function(a,b,c,d){a.bind=b('bind');},3);
__d("MessagingEvents",["array-extensions","Arbiter","ChannelConstants","copyProperties","isEmpty"],function(a,b,c,d,e,f){b('array-extensions');var g=b('Arbiter'),h=b('ChannelConstants'),i=b('copyProperties'),j=b('isEmpty'),k={},l=new g();function m(n){if(!j(k))return;for(var o in n)l.inform('count/'+o,n[o]);}l.subscribe('mark-as-read',function(n,o){(o.tids||o.chat_ids||[]).forEach(function(p){p=''+p;if(!(p in k)){k[p]=true;var q=function(){l.unsubscribe(r);clearTimeout(s);delete k[p];},r=l.subscribe('read',function(t,u){if((u.tids||[]).contains(p)||(u.chat_ids||[]).contains(p))q();}),s=q.defer(60000);}});});g.subscribe(h.getArbiterType('messaging'),function(n,o){var p=i({},o.obj),event=p.event||'';delete p.type;delete p.event;l.inform(event,p);if('unread_counts' in p){var q=p.unread_counts;m({unread:q.inbox,other_unseen:q.other});}});g.subscribe(h.getArbiterType('inbox'),function(n,o){var p=i(o.obj);delete p.type;m(p);});a.MessagingEvents=e.exports=l;},3);
__d("UserNoOp",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=function(){},i=function(){return this;};g(h.prototype,{add_event:i,add_data:i,uai:i,uai_fallback:i});e.exports=h;});
function FriendBrowserCheckboxController(){}copyProperties(FriendBrowserCheckboxController,{instances:{},getInstance:function(a){return this.instances[a];}});copyProperties(FriendBrowserCheckboxController.prototype,{init:function(a,b){FriendBrowserCheckboxController.instances[a]=this;this._id=a;this._form=b;this._contentGrid=DOM.find(b,'.friendBrowserCheckboxContentGrid');this._loadingIndicator=DOM.find(b,'.friendBrowsingCheckboxContentLoadingIndicator');this._checkboxResults=DOM.find(b,'.friendBrowserCheckboxResults');this._contentPager=DOM.find(b,'.friendBrowserCheckboxContentPager');this.numGetNewRequests=0;this.queuedRequests={};},addTypeahead:function(a,b){a.subscribe('select',this.onHubSelect.bind(this,a,b));},onHubSelect:function(a,b,event,c){if(!((event=='select')&&c.selected))return;var d=this.buildNewCheckbox(b,c.selected.text,c.selected.uid),e=DOM.find(this._form,'.checkboxes_'+b);DOM.appendContent(e.firstChild,d);var f=DOM.scry(a.getElement(),'input[type="button"]');if(f&&f[0])f[0].click();this.getNew(true);},buildNewCheckbox:function(a,b,c){var d=a+'_ids_'+c,e=a+'_ids[]',f=DOM.create('input',{id:d,type:'checkbox',value:c,name:e,checked:true});Event.listen(f,'click',bind(this,'getNew',false));var g=DOM.create('td',null,f);CSS.addClass(g,'vTop');CSS.addClass(g,'hLeft');var h=DOM.create('label',null,b),i=DOM.create('td',null,h);CSS.addClass(i,'vMid');CSS.addClass(i,'hLeft');var j=DOM.create('tr');j.appendChild(g);j.appendChild(i);return j;},showMore:function(){var a=DOM.scry(this._contentPager,'.friendBrowserMorePager')[0];if(!a)return false;if(CSS.hasClass(a,'async_saving'))return false;var b=this.numGetNewRequests,c=Form.serialize(this._form);c.show_more=true;var d=new AsyncRequest().setURI('/ajax/growth/friend_browser/checkbox.php').setData(c).setHandler(bind(this,function(e){this.showMoreHandler(e,b);})).setStatusElement(a).send();},showMoreHandler:function(a,b){if(b==this.numGetNewRequests){var c=a.payload;DOM.appendContent(this._contentGrid,c.results);this.updatePagerAndExtraData(c.pager,c.extra_data);}},getNew:function(a){this.numGetNewRequests++;var b=this.numGetNewRequests;CSS.addClass(this._checkboxResults,'friendBrowserCheckboxContentOnload');if(ge('friendBrowserCI'))CSS.addClass($('friendBrowserCI'),'friendBrowserCheckboxContentOnload');CSS.show(this._loadingIndicator);var c=Form.serialize(this._form);c.used_typeahead=a;new AsyncRequest().setURI('/ajax/growth/friend_browser/checkbox.php').setData(c).setHandler(bind(this,function(d){this.getNewHandler(d,b);})).send();},getNewHandler:function(a,b){if(b==this.numGetNewRequests){var c=a.payload;DOM.setContent(this._contentGrid,c.results);CSS.removeClass(this._checkboxResults,'friendBrowserCheckboxContentOnload');if(ge('friendBrowserCI'))CSS.hide($('friendBrowserCI'));CSS.hide(this._loadingIndicator);this.updatePagerAndExtraData(c.pager,c.extra_data);}},updatePagerAndExtraData:function(a,b){DOM.setContent(this._contentPager,a);this.setupOnVisible();DOM.replace(this._form.elements.extra_data,b);},setupOnVisible:function(){var a=DOM.scry(this._contentPager,'.friendBrowserMorePager')[0];if(a&&this._id!='jewel'){this._onVisible&&this._onVisible.remove();this._onVisible=new OnVisible(a,bind(this,'showMore'),false,1000);}}});
function RequestsJewel(){}copyProperties(RequestsJewel,{instance:null,getInstance:function(){return this.instance;}});copyProperties(RequestsJewel.prototype,{init:function(a,b,c){RequestsJewel.instance=this;this.countNew=0;this.jewel=a;this.jewelFlyoutCase=a.getRoot();this.jewelFlyout=ge('fbRequestsFlyout');this.newCountSpan=ge('newRequestCount');this.folder=b;this.doNewMarkRead=c;this.openTimestamp=0;this._requestList={};this._requestCount=0;var d=ge('requestsMarkReadButton');if(d)Event.listen(d,'click',this._markRead.shield(this));this.jewel.subscribe('marked-seen',this._markSeenCallback.shield(this));this.jewel.subscribe('closed',this._clearNewItems.shield(this));this.jewel.subscribe('updated',this._updateCount.bind(this));this.jewel.subscribe('opened',this._openHandler.bind(this));LinkController.registerHandler(this._handleLink.bind(this));Arbiter.subscribe(ChannelConstants.getArbiterType('jewel_requests_add'),this._addRequest.bind(this));Arbiter.subscribe(ChannelConstants.getArbiterType('jewel_requests_remove_old'),this._removeOldRequest.bind(this));Event.listen(this.jewelFlyout,'submit',function(e){var f=Parent.byClass(e.getTarget(),'objectListItem');if(f){CSS.removeClass(f,'jewelItemNew');CSS.addClass(f,'jewelItemResponded');this.pageInCollapsedRequests();}}.bind(this));this.setupScroll();return this;},setupScroll:function(){var a=DOM.scry(this.jewelFlyout,'.uiScrollableAreaWrap')[0];if(a){this._scrollableWrap=a;this._lastLinkPosition=0;this._scrollListener=Event.listen(a,'scroll',this._handleScroll.bind(this),Event.Priority._BUBBLE);}},fromDom:function(){DOM.scry(this.jewelFlyout,'.jewelItemList li.objectListItem').forEach(function(a){var b=a.getAttribute('id');if(b){var c=this._parseID(b);if(c){var d=parseInt(c.requester,10);if(d&&!isNaN(d))this._requestList[d]=b;}++this._requestCount;}}.bind(this));this._conditionShowEmptyMessage();},_parseID:function(a){var b=a.match(/^(\d+)_(\d+)/);return (b)?{requester:b[1],type:b[2]}:undefined;},_handleLink:function(a,event){var b=Parent.byClass(a,'jewelItemNew');if(b&&Parent.byClass(b,'fbRequestList')&&Parent.byClass(b,'beeperEnabled')){var c=this._parseID(b.id);c&&this._markSeenCallback(c.requester,c.type);Arbiter.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});CSS.removeClass(b,'jewelItemNew');}return true;},_handleScroll:function(){var a=DOM.scry(this._scrollableWrap,'.uiMorePager');if(!a||(ge('fbRequestsJewelManualPager')&&a.length<2))return;var b=a.pop();if(b){var c=Vector2.getElementPosition(b,'viewport').y;if(c>0)CSS.addClass(Parent.byClass(this._scrollableWrap,'uiScrollableArea'),'contentAfter');var d=DOM.find(b,'a');if(!d)return;var e=Vector2.getElementPosition(d,'viewport').y;if(e==this._lastLinkPosition)return;var f=Vector2.getElementPosition(this._scrollableWrap,'viewport').y+Vector2.getElementDimensions(this._scrollableWrap).y;if(e-300<f&&e>0){this._lastLinkPosition=e;var g=d.getAttribute('ajaxify');if(g){new AsyncRequest(g).setRelativeTo(d).setStatusElement(Parent.byClass(d,'stat_elem')).send();}else FriendBrowserCheckboxController.getInstance('jewel').showMore();}}},_addRequest:function(a,b){if(this.jewel.isOpen()||!b||this._requestList[b.obj.from])return;if(ge('fbRequestsJewelLoading')){new AsyncRequest().setURI('/ajax/requests/loader/').send();}else{var c=b.obj.from,d=this._onMarkupCallback.bind(this,c),e={from:c};if(b.obj.suggester)e.suggester=b.obj.suggester;new AsyncRequest().setURI('/ajax/friends/jewel/request_markup').setData(e).setHandler(d).send();}},_onMarkupCallback:function(a,b){var c=b.getPayload();if(!c)return;var d=DOM.scry(this.jewelFlyout,'.fbRequestList .uiList')[0];if(!d)return;DOM.prependContent(d,c.markup);var e={jewel:'requests',count:++this.countNew};Arbiter.inform('jewel/count-updated',e);this._requestList[a]=c.item_id;++this._requestCount;this._conditionShowEmptyMessage();},_removeOldRequest:function(a,b){if(this.jewel.isOpen()||!b||ge('fbRequestsJewelLoading')!==null)return;var c=this._requestList[b.obj.from],d=c&&ge(c);if(d){CSS.hasClass(d,'jewelItemNew')&&Arbiter.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});if(!CSS.hasClass(d,'jewelItemResponded')){DOM.remove(d);delete this._requestList[c];--this._requestCount;this._conditionShowEmptyMessage();}}},pageInCollapsedRequests:function(){var a=ge('fbRequestsJewelManualPager');if(a){var b=DOM.scry(a,'.uiMorePagerPrimary')[0];if(b.style&&b.style.display!='none')setTimeout(function(){b.click();},100);}},_markRead:function(){this.jewel.markSeen();this._clearNewItems();},_markSeenCallback:function(a,b){new AsyncSignal('/ajax/gigaboxx/endpoint/UpdateLastSeenTime.php',{folder:this.folder}).send();var c=typeof a!='undefined'&&typeof b!='undefined'?{requester:a,type:b}:{};this.doNewMarkRead&&new AsyncSignal('/ajax/requests/mark_read/',c).send();},_removeRequest:function(a,b){var c=b.obj.item_id;if(c){var d=ge(c),e=d&&CSS.hasClass(d,'jewelItemNew');d?DOM.remove(d):emptyFunction('No jewel item exists.');e&&Arbiter.inform('jewel/count-updated',{jewel:'requests',count:--this.countNew});}},_clearNewItems:function(a,b){DOM.scry(this.jewel.root,'li.jewelItemNew').forEach(function(c){CSS.removeClass(c,'jewelItemNew');});},_updateCount:function(a,b){this.countNew=b.count;CSS.conditionClass(this.jewelFlyout,'beeperUnread',this.countNew>0);CSS.conditionClass(this.jewelFlyoutCase,'showRequests',this.countNew>0);if(this.newCountSpan){var c=this.countNew==1?tx._("{num} NEW REQUEST",{num:this.countNew}):tx._("{num} NEW REQUESTS",{num:this.countNew});DOM.setContent(this.newCountSpan,c);}},_conditionShowEmptyMessage:function(){DOM.scry(this.jewelFlyout,'li.empty').forEach(function(a){CSS.conditionShow(a,this._requestCount<=0);}.bind(this));},_openHandler:function(){var a=DOM.scry(this.jewelFlyout,'.uiScrollableArea')[0];if(ge('fbRequestsJewelLoading')){var b=Date.now();if(this.openTimestamp+5000<b){this.openTimestamp=b;new AsyncRequest().setURI('/ajax/requests/loader/').send();}}a&&ScrollableArea.poke(a);}});
__d("legacy:UserAction",["UserNoOp","userAction","reportData","clickRefAction"],function(a,b,c,d){a.UserNoOp=b('UserNoOp');a.user_action=b('userAction');a.report_data=b('reportData');a.click_ref_action=b('clickRefAction');},3);
__d("legacy:Poller",["Poller"],function(a,b,c,d){a.Poller=b('Poller');},3);
__d("QuicklingAugmenter",["URI"],function(a,b,c,d,e,f){var g=b('URI'),h=[],i={addHandler:function(j){h.push(j);},augmentURI:function(j){var k=[],l=g(j);h.forEach(function(m){var n=m(l);if(!n)return;k.push(m);l=l.addQueryData(n);});h=k;return l;}};e.exports=i;});
__d("Quickling",["AjaxPipeRequest","Arbiter","Class","DocumentTitle","DOM","ErrorUtils","HTML","OnloadHooks","PageTransitions","QuicklingAugmenter","Run","URI","UserAgent","copyProperties","goOrReplace","isEmpty","QuicklingConfig"],function(a,b,c,d,e,f){var g=b('AjaxPipeRequest'),h=b('Arbiter'),i=b('Class'),j=b('DocumentTitle'),k=b('DOM'),l=b('ErrorUtils'),m=b('HTML'),n=b('OnloadHooks'),o=b('PageTransitions'),p=b('QuicklingAugmenter'),q=b('Run'),r=b('URI'),s=b('UserAgent'),t=b('copyProperties'),u=b('goOrReplace'),v=b('isEmpty'),w=c('QuicklingConfig'),x=w.version,y=w.sessionLength,z=new RegExp(w.inactivePageRegex),aa=0,ba,ca='',da={isActive:function(){return true;},isPageActive:function(ka){if(ka=='#')return false;ka=new r(ka);if(ka.getDomain()&&ka.getDomain()!=r().getDomain())return false;if(ka.getPath()=='/l.php'){var la=ka.getQueryData().u;if(la){la=r(unescape(la)).getDomain();if(la&&la!=r().getDomain())return false;}}var ma=ka.getPath(),na=ka.getQueryData();if(!v(na))ma+='?'+r.implodeQuery(na);return !z.test(ma);}};function ea(ka){ka=ka||'Facebook';j.set(ka);if(s.ie()){ca=ka;if(!ba)ba=window.setInterval(function(){var la=ca,ma=j.get();if(la!=ma)j.set(la);},5000,false);}}function fa(ka){var la=document.getElementsByTagName('link');for(var ma=0;ma<la.length;++ma){if(la[ma].rel!='alternate')continue;k.remove(la[ma]);}if(ka.length){var na=k.find(document,'head');na&&k.appendContent(na,m(ka[0]));}}function ga(ka){var la={version:x};this.parent.construct(this,ka,{quickling:la});}i.extend(ga,g);t(ga.prototype,{_preBootloadFirstResponse:function(ka){return true;},_fireDomContentCallback:function(){this._request.cavalry&&this._request.cavalry.setTimeStamp('t_domcontent');o.transitionComplete();this._onPageDisplayed&&this._onPageDisplayed(this.pipe);this.parent._fireDomContentCallback();},_fireOnloadCallback:function(){if(this._request.cavalry){this._request.cavalry.setTimeStamp('t_hooks');this._request.cavalry.setTimeStamp('t_layout');this._request.cavalry.setTimeStamp('t_onload');}this.parent._fireOnloadCallback();},isPageActive:function(ka){return da.isPageActive(ka);},_versionCheck:function(ka){if(ka.version==x)return true;var la=['quickling','ajaxpipe','ajaxpipe_token'];u(window.location,r(ka.uri).removeQueryData(la),true);return false;},_processFirstResponse:function(ka){var la=ka.getPayload();ea(la.title);fa(la.syndication||[]);window.scrollTo(0,0);var ma=la.body_class||'';document.body.className=ma;},getSanitizedParameters:function(){return ['quickling'];}});function ha(){aa++;return aa>=y;}function ia(ka){g.setCurrentRequest(null);if(ha())return false;ka=p.augmentURI(ka);if(!da.isPageActive(ka))return false;window.ExitTime=Date.now();q.__removeHook('onafterloadhooks');q.__removeHook('onloadhooks');n.runHooks('onleavehooks');h.inform('onload/exit',true);new ga(ka).setCanvasId('content').send();return true;}function ja(ka){var la=window[ka];function ma(na,oa,pa){if(typeof na!=='function')na=eval.bind(null,na);var qa=la(l.guard(na),oa);if(oa>0)if(pa!==false)q.onLeave(function(){clearInterval(qa);});return qa;}window[ka]=ma;}q.onAfterLoad(function ka(){ja('setInterval');ja('setTimeout');o.registerHandler(ia,1);});e.exports=a.Quickling=da;});
__d("StringTransformations",[],function(a,b,c,d,e,f){e.exports={unicodeEscape:function(g){return g.replace(/[^A-Za-z0-9\-\.\:\_\$\/\+\=]/g,function(h){var i=h.charCodeAt().toString(16);return '\\u'+('0000'+i.toUpperCase()).slice(-4);});},unicodeUnescape:function(g){return g.replace(/(\\u[0-9A-Fa-f]{4})/g,function(h){return String.fromCharCode(parseInt(h.slice(2),16));});}};});
__d("SearchTypeaheadRenderer",["DOM","Env","MusicButtonManager","TypeaheadUtil"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('Env'),i=b('MusicButtonManager'),j=b('TypeaheadUtil');function k(l,m){var n=[];if(l.photo){n.push(g.create('img',{className:'photo',alt:'',src:l.photo}));if(l.song){n.push(g.create('span',{className:'playButton'}));n.push(g.create('span',{className:'playLoader'}));}}if(l.text){var o=l.alias,p=this.value,q=l.text,r=[q];if(o&&j.isQueryMatch(p,o)&&!j.isQueryMatch(p,q))r.push(g.create('span',{className:'alias'},[' \xB7 '+o]));n.push(g.create('span',{className:'text'},r));}if(l.category){var s=[l.category];if(l.is_external)s.push(g.create('span',{className:'arrow'}));var t=l.message?'preCategory':'category';n.push(g.create('span',{className:t},s));}if(l.message)n.push(g.create('span',{className:'category'},[l.message]));var u=l.subtextOverride||l.subtext;if(u)n.push(g.create('span',{className:'subtext'},[u]));var v=l.classNames||l.type||'',w=l.is_external?'_blank':'',x=!l.song&&l.path||'';if(x){if(!(/^https?\:\/\//).test(x))x=h.www_base+x.substr(1);x+=(x.indexOf('?')>0?'&':'?')+'ref=ts&fref=ts';}var y=g.create('a',{href:x,rel:'ignore',target:w},n);if(l.song){y.id='mb_'+(Math.random()*1e+06|0);i.addButton.curry(l.song.provider,y.id,l.song.url,l.song.context,l.song.media_type).defer();y.onclick=this.ignoreClick;}var z=g.create('li',{className:v},[y]);if(l.text)z.setAttribute('aria-label',l.text);return z;}k.className='search';e.exports=k;});
__d("WebStorageMonster",["event-extensions","AsyncRequest","UserActivity","StringTransformations","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h=b('UserActivity'),i=b('StringTransformations'),j=b('setTimeoutAcrossTransitions'),k=300000,l=false;function m(r){var s={};for(var t in r){var u=r.getItem(t),v=i.unicodeEscape(t);if(typeof u==='string')s[v]=u.length;}return s;}function n(r){if(a.localStorage&&r.keys)q._getLocalStorageKeys().forEach(function(s){if(r.keys.contains(s))a.localStorage.removeItem(s);});}function o(r){if(a.localStorage)q._getLocalStorageKeys().forEach(function(s){if(!r.some(function(t){return new RegExp(t).test(s);}))a.localStorage.removeItem(s);});if(a.sessionStorage)a.sessionStorage.clear();}function p(r){if(h.isActive(k)){j(p.curry(r),k);}else q.cleanNow(r);}var q={registerLogoutForm:function(r,s){Event.listen(r,'submit',function(t){q.cleanOnLogout(s);});},schedule:function(r){if(l)return;l=true;p(r);},cleanNow:function(r){var s=Date.now(),t={},u=false;['localStorage','sessionStorage'].forEach(function(w){if(a[w]){t[w]=m(a[w]);u=true;}});var v=Date.now();t.logtime=v-s;if(u)new g('/ajax/webstorage/process_keys.php').setData(t).setHandler(function(w){if(!r){var x=w.getPayload();if(x.keys)x.keys=x.keys.map(i.unicodeUnescape);n(x);}}.bind(this)).send();},cleanOnLogout:function(r){if(r)o(r);if(a.sessionStorage)a.sessionStorage.clear();},_getLocalStorageKeys:Object.keys.curry(a.localStorage)};e.exports=q;});
__d("FreeformTokenizerBehavior",["Input","Keys","event-extensions","function-extensions"],function(a,b,c,d,e,f){var g=b('Input'),h=b('Keys');b('event-extensions');b('function-extensions');function i(j,k){var l=k.tokenize_on_blur!==false,m=k.tokenize_on_paste!==false,n=k.matcher&&new RegExp(k.matcher,'i');function o(event){var p=g.getValue(j.getInput()).trim();if(p&&(!n||n.test(p))){var q={uid:p,text:p,freeform:true};j.addToken(j.createToken(q));if(event){j.getTypeahead().getCore().afterSelect();event.kill();}}}j.subscribe('keydown',function(p,q){var event=q.event,r=Event.getKeyCode(event);if(r==h.COMMA||r==h.RETURN){var s=j.getTypeahead().getView();if(s.getSelection()){s.select();event.kill();}else o(event);}});j.subscribe('paste',function(p,q){if(m)o.bind(null,q.event).defer(20);});j.subscribe('blur',function(p,q){if(l)o();j.getTypeahead().getCore().reset();});}e.exports=i;});
__d("legacy:JSLogger",["JSLogger"],function(a,b,c,d){a.JSLogger=b('JSLogger');},3);
__d("PagesVoiceBar",["$","Arbiter","AsyncRequest","CSS","ChannelConstants","DOM","PageTransitions"],function(a,b,c,d,e,f){var g=b('$'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('CSS'),k=b('ChannelConstants'),l=b('DOM'),m=b('PageTransitions'),n='PagesVoiceBar/toggle',o='PagesVoiceBar/initialized',p='PagesVoiceBar/switchVoice',q='page_transition',r='pages_voice_bar_sync',s=null,t=null,u=false,v=false;function w(){v=!v;j.conditionClass(document.body,'hasVoiceBar',v);}function x(da,ea){new i('/ajax/pages/switch_voice.php').setData(ea).setHandler(function(fa){ba();}).send();}function y(){s=null;}function z(da,ea){if(ea.obj.profile_id&&ea.obj.profile_id==s)ba();}function aa(da){h.subscribe(o,da);}function ba(){m.getNextURI().go();}var ca={initVoiceBar:function(){if(u)return;t=g('pagesVoiceBarContent');v=j.hasClass(document.body,'hasVoiceBar');h.subscribe(n,w);h.subscribe(p,x);h.subscribe(q,y);h.subscribe(k.getArbiterType(r),z);u=true;h.inform(o,null,h.BEHAVIOR_STATE);},update:function(da,ea){aa(function(){s=ea;l.setContent(t,da);});}};e.exports=ca;});
__d("legacy:error-dialog",["ErrorDialog"],function(a,b,c,d){var e=b('ErrorDialog');a.ErrorDialog=e;},3);
__d("MercuryFilters",["array-extensions","MercuryConstants"],function(a,b,c,d,e,f){b('array-extensions');var g=c('MercuryConstants'),h=[g.MessagingTag.UNREAD],i={ALL:'all',getSupportedFilters:function(){return h.concat();},isSupportedFilter:function(j){return h.contains(j);}};e.exports=i;});
__d("MercuryOrderedThreadlist",["JSLogger","MercuryFolders","MercuryFilters","MercuryServerRequests","RangedCallbackManager","MercuryThreadInformer","MercuryThreads","MercuryConstants"],function(a,b,c,d,e,f){var g=b('JSLogger'),h=b('MercuryFolders'),i=b('MercuryFilters'),j=b('MercuryServerRequests'),k=b('RangedCallbackManager'),l=b('MercuryThreadInformer'),m=b('MercuryThreads'),n=c('MercuryConstants'),o=g.create('ordered_threadlist_model'),p=i.getSupportedFilters().concat([i.ALL]),q=h.getSupportedFolders(),r={};q.forEach(function(ca){r[ca]={};p.forEach(function(da){r[ca][da]=new k(function(ea){return m.getThreadMetaNow(ea).timestamp;},function(ea,fa){return fa-ea;},j.canLinkExternally.bind(j));});});function s(ca,da,ea){var fa=[],ga=false,ha=false,ia=(ca||[]).filter(function(pa){var qa=pa.filter||i.ALL;return (pa.folder==da||(!pa.folder&&da==n.MessagingTag.INBOX))&&qa==ea;}),ja=r[da][ea].getAllResources(),ka;ia.forEach(function(pa){fa=fa.concat(pa.thread_ids);if(pa.error){if(pa.end>ja.length)ha=pa.error;}else{var qa=pa.end-pa.start;if(pa.thread_ids.length<qa)ga=true;}if(!ka||pa.end>ka)ka=pa.end;});w(fa,da,ea);if(ga){r[da][ea].setReachedEndOfArray();}else if(ha){r[da][ea].setError(ha);}else{var la=r[da][ea].getCurrentArraySize();if(ka&&la<ka){var ma={},na=ja.concat(fa),oa=na.filter(function(pa){var qa=ma[pa];ma[pa]=true;return qa;});if(oa.length){o.warn('duplicate_threads',{folder:da,expected_final_size:ka,actual_final_size:la,duplicate_thread_ids:oa});j.fetchThreadlistInfo(ka,oa.length,da,ea==i.ALL?null:ea);}}}}function t(ca){q.forEach(function(da){p.forEach(function(ea){s(ca,da,ea);});});}function u(ca){var da={};q.forEach(function(ea){da[ea]={};p.forEach(function(fa){da[ea][fa]={to_add:[],to_remove:[],to_remove_if_last_after_add:{}};});});ca.forEach(function(ea){if(ea.is_forward)return;var fa=ea.thread_id,ga=x(fa),ha=y(fa);function ia(){ha.forEach(function(ka){da[ga][ka].to_add.push(fa);if(!r[ga][ka].hasReachedEndOfArray()&&!r[ga][ka].hasResource(fa))da[ga][ka].to_remove_if_last_after_add[fa]=true;});}function ja(ka){if(p.contains(ka))if(ha.contains(ka)){da[ga][ka].to_add.push(fa);}else da[ga][ka].to_remove.push(fa);}if(!ga){if(ea.action_type===n.MercuryActionType.CHANGE_FOLDER||ea.action_type===n.MercuryActionType.CHANGE_ARCHIVED_STATUS)q.forEach(function(ka){if(ka!==ga)p.forEach(function(la){r[ka][la].removeResources([fa]);});});return;}switch(ea.action_type){case n.MercuryActionType.DELETE_THREAD:ha.forEach(function(ka){da[ga][ka].to_remove.push(fa);});break;case n.MercuryActionType.CHANGE_ARCHIVED_STATUS:case n.MercuryActionType.CHANGE_FOLDER:ia();break;case n.MercuryActionType.CHANGE_READ_STATUS:ja(n.MessagingTag.UNREAD);break;case n.MercuryActionType.USER_GENERATED_MESSAGE:case n.MercuryActionType.LOG_MESSAGE:ha.forEach(function(ka){if(z(fa,ga,ka))da[ga][ka].to_add.push(fa);});break;}});q.forEach(function(ea){p.forEach(function(fa){var ga=r[ea][fa];w(da[ea][fa].to_add,ea,fa);for(var ha=ga.getCurrentArraySize()-1;ha>=0;ha--){var ia=ga.getResourceAtIndex(ha);if(!da[ea][fa].to_remove_if_last_after_add[ia])break;da[ea][fa].to_remove.push(ia);}ga.removeResources(da[ea][fa].to_remove);});});}function v(ca){var da={};q.forEach(function(ea){da[ea]={};p.forEach(function(fa){da[ea][fa]=[];});});ca.forEach(function(ea){var fa=x(ea.thread_id),ga=y(ea.thread_id);ga.forEach(function(ha){if(fa&&z(ea.thread_id,fa,ha))da[fa][ha].push(ea.thread_id);});});q.forEach(function(ea){p.forEach(function(fa){if(da[ea][fa].length>0)w(da[ea][fa],ea,fa);});});}function w(ca,da,ea){ea=ea||i.ALL;r[da][ea].addResources(ca);q.forEach(function(fa){if(fa!=da)r[fa][ea].removeResources(ca);});}function x(ca){var da=m.getThreadMetaNow(ca),ea=null;if(!da){ea='No thread metadata';}else if(!da.folder)ea='No thread folder';if(ea){var fa={error:ea,tid:ca};o.warn('no_thread_folder',fa);return null;}var ga=da.folder;if(da.is_archived)ga=n.MessagingTag.ACTION_ARCHIVED;if(r[ga]){return ga;}else return null;}function y(ca){var da=m.getThreadMetaNow(ca),ea=[i.ALL];if(!da){var fa={error:'no_thread_metadata',tid:ca};o.warn('no_thread_metadata',fa);return [];}if(da.unread_count)ea.push(n.MessagingTag.UNREAD);return ea;}function z(ca,da,ea){var fa=m.getThreadMetaNow(ca);return fa&&fa.timestamp&&x(ca)==da&&y(ca).contains(ea);}var aa={getThreadlist:function(ca,da,ea,fa,ga,ha){return aa.getFilteredThreadlist(ca,da,ea,i.ALL,fa,ga,ha);},getFilteredThreadlist:function(ca,da,ea,fa,ga,ha,ia){var ja=r[ea][fa],ka=ja.executeOrEnqueue(ca,da,ga,ha),la=ja.getUnavailableResources(ka),ma=ja.getError(ca,da,ha);if(la.length||ma){if(ja.getCurrentArraySize()<ca){var na={start:ca,limit:da,filter:fa,resources_size:ja.getCurrentArraySize()};o.warn('range_with_gap',na);}ja.setError(false);j.fetchThreadlistInfo(ja.getCurrentArraySize(),la.length,ea,fa==i.ALL?null:fa,ia);}return ka;},getThreadlistUntilTimestamp:function(ca,da,ea){ea=ea||i.ALL;return r[da][ea].getElementsUntil(ca);},unsubscribe:function(ca,da,ea){ea=ea||i.ALL;r[da][ea].unsubscribe(ca);}};function ba(ca){switch(ca.payload_source){case n.MercuryPayloadSource.CLIENT_CHANGE_ARCHIVED_STATUS:case n.MercuryPayloadSource.CLIENT_CHANGE_READ_STATUS:case n.MercuryPayloadSource.CLIENT_CHANGE_FOLDER:case n.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE:case n.MercuryPayloadSource.CLIENT_DELETE_MESSAGES:case n.MercuryPayloadSource.CLIENT_DELETE_THREAD:case n.MercuryPayloadSource.CLIENT_SEND_MESSAGE:case n.MercuryPayloadSource.SERVER_SEND_MESSAGE:case n.MercuryPayloadSource.SERVER_CONFIRM_MESSAGES:case n.MercuryPayloadSource.SERVER_FETCH_THREADLIST_INFO:case n.MercuryPayloadSource.SERVER_THREAD_SYNC:return true;case n.MercuryPayloadSource.SERVER_INITIAL_DATA:return ca.ordered_threadlists;default:return false;}}j.subscribe('update-threadlist',function(ca,da){if(!ba(da))return;var ea=da.ordered_threadlists;if(ea&&ea.length){t(ea);}else{var fa=(da.actions||[]).filter(function(ga){return ga.thread_id;});v(da.threads||[]);u(fa);}l.updatedThreadlist();});e.exports=aa;});
__d("MercuryJewel",["MercuryChannelHandler","MercuryJewelCountControl","DOM","MercuryJewelThreadlistControl","MercuryServerRequests","userAction"],function(a,b,c,d,e,f){b('MercuryChannelHandler');var g=b('MercuryJewelCountControl'),h=b('DOM'),i=b('MercuryJewelThreadlistControl'),j=b('MercuryServerRequests'),k=b('userAction'),l=false;function m(q,r,s,t){j.handleUpdate(t);var u=new g(r,s),v=h.find(q,'#MercuryJewelThreadList');if(s.getRoot()&&s.isOpen()){n.call(this,v);}else s.subscribe('opened',n.bind(this,v));}e.exports=m;function n(q){this._ua=k('messages').uai('click','jewel');this._listenForLoad=this._listenForRender=true;if(!l){var r=new i(q);r.subscribe(i.EVENT_THREADS_LOADED,o.bind(this));r.subscribe(i.EVENT_THREADS_RENDERED,p.bind(this));l=true;}}function o(){if(this._listenForLoad){this._ua.add_event('loaded');this._listenForLoad=false;}}function p(){if(this._listenForRender){this._ua.add_event('rendered');this._listenForRender=false;}}});
__d("SearchTypeaheadView",["Arbiter","ContextualTypeaheadView","Class","ContextualLayerUpdateOnScroll","copyProperties","DOM","goURI","MusicConstants","MusicEvents","tx","URI"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ContextualTypeaheadView'),i=b('Class'),j=b('ContextualLayerUpdateOnScroll'),k=b('copyProperties'),l=b('DOM'),m=b('goURI'),n=b('MusicConstants'),o=b('MusicEvents'),p=b('tx'),q=b('URI');function r(s,t){this.parent.construct(this,s,t);}i.extend(r,h);k(r.prototype,{initializeLayer:function(){this.parent.initializeLayer();this.layer.setOffsetY(-1);this.layer.enableBehavior(j);},ignoreClick:function(event){event.prevent();},shouldShowSeeMore:true,queryData:{init:'quick'},render:function(s,t,u){var v={results:t,value:s};this.inform('finalResultsReordering',v);return this.parent.render(s,v.results,u);},buildBuckets:function(s,t){var u=t.length;this.setWebSuggLoggingParams(s,t);t=this.parent.buildBuckets(s,t);if(s&&this.shouldShowSeeMore)t.push(this.buildSeeMore(s,u));return t;},buildSeeMore:function(s,t){var u=t>0?p._("See more results for {query}",{query:s}):p._("See results for {query}",{query:s}),v=t==1?"Displaying top result":p._("Displaying top {number} results",{number:t}),w=l.create('li',{className:'calltoaction'},[l.create('a',{href:this.getSeeMoreEndpoint(s),rel:'ignore'},[l.create('span',{className:'text'},[l.create('span',{className:'seeMore'},[u,l.create('span',{className:'arrow'})]),l.create('span',{className:'subtext'},[v])])])]);w.setAttribute('aria-label',u);return {uid:'search',node:w,search:true};},searchPageQueryData:function(s){return k({q:s},this.queryData||{});},select:function(s){var t=this.index,u=this.results[t];if(!u||u.type=='header')return;var v=this.items[t],w=l.scry(v,'a')[0];if(u.song){if(w)o.inform(n.MUSIC_BUTTON.ACTIVATE,w);s&&this.inform('highlight',{index:t,selected:u});}else{this.parent.select(s);if(w&&w.href)if(w.target=='_blank'){window.open(w.href);}else m(w.href);}},setSid:function(s){this.queryData.tas=s;},getSeeMoreEndpoint:function(s){return q(this.seeMoreEndpoint).addQueryData(this.searchPageQueryData(s)).toString();},show:function(){if(!this.isVisible()){g.inform('layer_shown',{type:'SearchTypeahead'});this.parent.show();}},hide:function(){if(this.isVisible()){g.inform('layer_hidden',{type:'SearchTypeahead'});this.parent.hide();}},getQuerySuggestion:function(s){var t=this.results[this.index],u=t&&t.type!='header'?t.text.toLowerCase():'';return u==s.toLowerCase()?'':u;},setWebSuggLoggingParams:function(s,t){var u=0,v=0;for(var w=0;w<t.length;w++)if(t[w].type==='websuggestion'){if(v===0)v=w+1;var x='FR'+(w-u)+'AS'+u,y=w+1;t[w].path+='&wssk='+x+'&wssp='+y+'&wspq='+encodeURIComponent(s);u++;}var z='&wssc='+t.length+'-'+s.length+'&wsbp='+u+'-'+v;for(w=0;w<t.length;w++)if(t[w].type==='websuggestion')t[w].path+=z;}});e.exports=r;});
__d("TypeaheadRegulateMemorializedUsers",["copyProperties","TypeaheadUtil"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('TypeaheadUtil');function i(j){this._typeahead=j;}g(i.prototype,{_filterRegistry:null,_filter:function(j,k){if(j.type!=='user'||!j.memorialized)return true;var l=h.parse(j.text).tokens;if(l.length===1&&h.isExactMatch(k,j.text))return true;var m=this._typeahead.getData().getTextToIndex(j),n=h.parse(k).tokens;return (n.length>1&&h.isQueryMatch(k,m));},enable:function(){this._filterRegistry=this._typeahead.getData().addFilter(this._filter.bind(this));},disable:function(){this._filterRegistry.remove();this._filterRegistry=null;}});e.exports=i;});
__d("legacy:RegulateMemorializedUsersTypeaheadBehavior",["TypeaheadRegulateMemorializedUsers"],function(a,b,c,d){var e=b('TypeaheadRegulateMemorializedUsers');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.regulateMemorializedUsers=function(f){f.enableBehavior(e);};},3);