/*1341800490,169775814*/

if (window.CavalryLogger) { CavalryLogger.start_js(["vvq3q"]); }

__d("PhotoViewerFollow",["event-extensions","Arbiter","AsyncRequest","BanzaiODS","CSS","DOM","Parent","PhotosConst","$","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('BanzaiODS'),j=b('CSS'),k=b('DOM'),l=b('Parent'),m=b('PhotosConst'),n=b('$'),o=b('copyProperties');function p(r){this.viewer=r;}var q={};o(p,{createInstance:function(r,s,t,u,v,w,x,y){var z=r.getInstance(),aa=new p(z);aa.init(n(s),t,u,v,w,x,y);q[z.getVersionConst()]=aa;return aa;},getInstance:function(r){return q[r];}});o(p.prototype,{FOLLOW_LOCATION_PHOTO:48,init:function(r,s,t,u,v,w,x){this.subscribeLink=r;this.unsubscribeFlyout=s;this.subscribeEndpoints=v;this.unsubscribeEndpoints=w;this.unsubLinks=u;this.unsubDiv=t;this.reset();this.activate();this.type=x;Event.listen(this.subscribeLink,'click',function(event){if(l.byClass(event.getTarget(),'photoViewerFollowLink'))this.subscribePhotoOwner();}.bind(this));Event.listen(this.unsubLinks.user,'click',this.unsubscribePhotoOwner.bind(this));Event.listen(this.unsubLinks.page,'click',this.unsubscribePhotoOwner.bind(this));g.subscribe(['FollowUser','FollowUserFail','UnfollowUser','UnfollowUserFail'],this.updateSubscribe.bind(this));g.subscribe(this.viewer.getEventString('DATA_CHANGE'),this.showSubscribeLinkOnChange.bind(this));if(this.viewer.getVersionConst()===m.VIEWER_SNOWLIFT){g.subscribe(this.viewer.getEventString('CLOSE'),this.reset.bind(this));g.subscribe(this.viewer.getEventString('OPEN'),this.activate.bind(this));}this.registerUnsubscribeTarget();},activate:function(){this.activated=true;},reset:function(){this.unsubscribeFlyout&&this.unsubscribeFlyout.clearNodes();this.subscriptionChange={};this.activated=false;},registerUnsubscribeTarget:function(){if(!this.unsubscribeFlyout)return;var r=k.scry(this.subscribeLink,'.photoViewerFollowedMsg')[0];if(r&&!j.hasClass(r,'unsubFlyoutEnabled')){this.unsubscribeFlyout.initNode(r);j.addClass(r,'unsubFlyoutEnabled');}},updateSubscribe:function(r,s){if(!this.activated)return;var t=s.profile_id;if(t){this.subscriptionChange[t]=r==='FollowUser'||r==='UnfollowUserFail'?'following':'unfollowed';this.toggleSubscribeLink(t);}},showSubscribeLinkOnChange:function(r,s){this.type=s.ownertype;j.conditionClass(this.unsubDiv,'isPage',this.type==='page');this.toggleSubscribeLink(s.owner);},toggleSubscribeLink:function(r){var s=k.scry(this.subscribeLink,'span.fbPhotoSubscribeWrapper')[0];if(!s)return;if(this.subscriptionChange[r]){j.conditionClass(s,'followingOwner',this.subscriptionChange[r]==='following');if(this.subscriptionChange[r]==='unfollowed')this.unsubscribeFlyout&&this.unsubscribeFlyout.hideFlyout(true);}this.registerUnsubscribeTarget();},subscribePhotoOwner:function(){if(!this.viewer.getOwnerId())return;var r=(this.type==='user')?{profile_id:this.viewer.getOwnerId()}:{fbpage_id:this.viewer.getOwnerId(),add:true,reload:false,fan_origin:'photo_snowlift'};g.inform('FollowUser',{profile_id:this.viewer.getOwnerId()});if(this.type==='page')i.bumpEntityKey('snowlift_page_like','snowlift_page_like.clicked_link');r.location=this.FOLLOW_LOCATION_PHOTO;new h(this.subscribeEndpoints[this.type]).setAllowCrossPageTransition(true).setData(r).setMethod('POST').setReadOnly(false).setErrorHandler(g.inform.curry('FollowUserFail',r)).send();},unsubscribePhotoOwner:function(){if(!this.viewer.getOwnerId())return;var r=(this.type==='user')?{profile_id:this.viewer.getOwnerId()}:{fbpage_id:this.viewer.getOwnerId(),add:false,reload:false};g.inform('UnfollowUser',{profile_id:this.viewer.getOwnerId()});r.location=this.FOLLOW_LOCATION_PHOTO;new h(this.unsubscribeEndpoints[this.type]).setAllowCrossPageTransition(true).setData(r).setMethod('POST').setReadOnly(false).setErrorHandler(g.inform.curry('UnfollowUserFail',r)).send();}});e.exports=p;});
__d("legacy:TimelineURI",["TimelineURI"],function(a,b,c,d){a.TimelineURI=b('TimelineURI');},3);