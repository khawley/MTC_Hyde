/*1349661912,173217319*/

if (window.CavalryLogger) { CavalryLogger.start_js(["7t\/PF"]); }

__d("legacy:DOMPosition",["DOMPosition"],function(a,b,c,d){var e=b('DOMPosition');a.DOMPosition=e;},3);
__d("legacy:ad-logging",["Arbiter","AsyncRequest","collectDataAttributes"],function(a,b,c,d){var e=b('Arbiter'),f=b('AsyncRequest'),g=b('collectDataAttributes'),h={};function i(l){return (l.getAttribute&&(l.getAttribute('ajaxify')||l.getAttribute('data-endpoint'))||l.action||l.href||l.name);}function j(l,m){if(l!==null&&typeof(l.ei)==="string"){var n=Date.now(),o=500;l.duplicate_click=!!h[l.ei]&&(n-h[l.ei]<o);h[l.ei]=n;new f('/ajax/ssinfeed/end/').setData(l).setAllowCrossPageTransition(true).setMethod('POST').send();}}function k(l,m){if(!m.node)return;var n=i(m.node);if(!n||!m.event||m.event.type!=='click')return;var o=g(m.node,['ft','ad']);o.ft.href=n;j(o.ft,o.ad);}e.subscribe("ClickRefAction/new",k);},3);
function TickerRightHideController(){}TickerRightHideController._markAsClosedHelper=function(a){var b=ge('pagelet_reminders');if(b){var c=DOM.scry(b,'div.tickerToggleWrapper')[0];if(c)CSS.conditionClass(c,'displayedTickerToggleWrapper',a);}var d=ge('pagelet_moments');if(d){var e=DOM.scry(d,'div.tickerToggleWrapper')[0];if(e)CSS.conditionClass(e,'displayedTickerToggleWrapper',a);}var f=ge('pagelet_rhc_ticker');if(f){var g=DOM.scry(f,'div.tickerToggleWrapper')[0];if(g)CSS.conditionClass(g,"displayedTickerToggleWrapper",!a);CSS.conditionClass(f,"hidden_rhc_ticker",a);}};TickerRightHideController.markAsClosed=function(){TickerRightHideController._markAsClosedHelper(true);};TickerRightHideController.markAsUnclosed=function(){TickerRightHideController._markAsClosedHelper(false);};
PageletCache=window.PageletCache||{init:function(){try{PageletCache._cache=window.sessionStorage;}catch(a){}},_processBeforeWrite:function(a){Bootloader.setResourceMap(a.resource_map);var b=(a.css||[]).concat(a.js||[]);for(var c in (a.bootloadable||{}))b.concat(a.bootloadable[c]);a.resource_map=a.resource_map||{};for(var d=0;d<b.length;d++){var e=b[d];if(!a.resource_map[e])a.resource_map[e]=Bootloader.resolveResources([e])[0];}if(a.cache_type=='overwrite'){delete a.onload;delete a.onafterload;delete a.jscc_map;delete a.jsmods;}},write:function(a,b){if(!PageletCache._cache)return;if(a.cacheable){var c={};copyProperties(c,a);delete c.content;PageletCache._pagelets[c.id]=c;PageletCache.subscribeToInstantiateController(c,b);}else if(a.cache_parent)PageletCache._merge(PageletCache._pagelets[a.cache_parent],a);},_merge:function(a,b){for(var c in b){if(typeof b[c]!='object')continue;if(!a[c]){a[c]=b[c];}else if(c=='jsmods'){PageletCache._merge(a.jsmods,b.jsmods);}else if(Array.isArray(b[c])){a[c]=a[c].concat(b[c]);}else copyProperties(a[c],b[c]);}if(a.provides&&a.requires){a.requires=a.requires.filter(function(d){return a.provides.indexOf(d)<0;});a.requires.length||delete a.requires;}if(a.display_dependency){a.display_dependency=a.display_dependency.filter(function(d){return d!=a.id;});a.display_dependency.length||delete a.display_dependency;}delete a.content;},updateSnapshot:function(a,b,c){var d=PageletCache._pagelets[a];d.content={};d.content[a]=b.innerHTML;d.__data=c;var e=this.getAndParse(d.id);try{PageletCache._processBeforeWrite(d);e[d.key]=d;PageletCache._cache.setItem(d.id,JSON.stringify(e));}catch(f){emptyFunction('Failed to write %s to cache',d.id);}},fetchData:function(a){var b=PageletCache._pagelets[a].__data;return b?b:{};},loadFromCache:function(a,b){var c={};copyProperties(c,PageletCache.read(a));if(is_empty(c))return a;c.id=a.id;c.cache_hit=true;c.display_dependency=a.display_dependency;c.phase=a.phase;c.is_last=a.is_last;this.subscribeToInstantiateController(c,b);return c;},read:function(a){if(!PageletCache._cache)return null;var b=a.id;if(b.substr(0,6)=='cached')b=b.substr(7);var c=this.getAndParse(b);if(c&&c[a.key]){PageletCache._pagelets[b]=c[a.key];PageletCache._cache_hits[b]=true;return c[a.key];}if(a.cache_type=='update')Bootloader.loadComponents(['UIPagelet','uri'],function(){UIPagelet.loadFromEndpoint(a.controller_class,b,URI.getNextURI().getQueryData(),{usePipe:true,pageletCacheMiss:a,automatic:true});});return null;},getAndParse:function(a){var b=PageletCache._cache.getItem(a);if(b)try{return JSON.parse(b);}catch(c){emptyFunction('Failed to parse %s from cache',a);}return {};},isCacheHit:function(a){return !!PageletCache._cache_hits[a];},cleanup:function(a){delete PageletCache._cache_hits[a];delete PageletCache._pagelets[a];},subscribeToInstantiateController:function(a,b){var c=b.subscribe('pagelet_event',function(d,e){if(e.id==a.id&&e.event=='preonload'){c.unsubscribe();new window[a.cache_controller](a.id,a.cache_type);}});},_cache:null,_pagelets:{},_cache_hits:{}};
function PageletCacheController(a,b,c){if(!PageletCache)return;if(!a)return;this._cacheKey=a;this._cacheType=b;this._subscriptions=[];this._controller=null;this._registerSnapshot(c);PageletCacheController._instances[a]=this;}copyProperties(PageletCacheController,{registerController:function(a,b){if(!a||!b)return null;var c=PageletCacheController._instances[a];if(c){c.setController(b);c.takeSnapshot();if(c._cacheType=='update'&&PageletCache.isCacheHit(a))onafterloadRegister_DEPRECATED(c.updateAfterload.bind(c,b));}return c;},_instances:{}});copyProperties(PageletCacheController.prototype,{registerCleanup:function(a){this._subscriptions.push(Arbiter.subscribe(a,this._cleanup.bind(this)));},setController:function(a){this._controller=a;return this;},loadData:function(){return PageletCache.fetchData(this._cacheKey);},takeSnapshot:function(){var a=$(this._cacheKey).cloneNode(true);this.handlePageletDOMOnSnapshot(a);var b=this.getControllerDataOnSnapshot(this._controller);PageletCache.updateSnapshot(this._cacheKey,a,b);},getControllerDataOnSnapshot:emptyFunction,handlePageletDOMOnSnapshot:emptyFunction,updateAfterload:emptyFunction,_registerSnapshot:function(a){for(var b=0;b<a.length;b++)this._subscriptions.push(Arbiter.subscribe(a[b],this.takeSnapshot.bind(this)));},_cleanup:function(){this._subscriptions.forEach(Arbiter.unsubscribe);this._subscriptions.length=0;PageletCache.cleanup(this._cacheKey);delete PageletCacheController._instances[this._cacheKey];}});
function TickerCache(a,b){this.parent.construct(this,a,b,['Ticker/storiesInserted','Ticker/resized','Ticker/afterInsert','Ticker/animateOut']);this._numStoriesToKeep=15;}Class.extend(TickerCache,'PageletCacheController');copyProperties(TickerCache.prototype,{handlePageletDOMOnSnapshot:function(a){var b=DOM.scry(a,'div.storyQueue')[0];b&&DOM.remove(b);var c=DOM.scry(a,'div.fbFeedTickerStory');if(c.length>this._numStoriesToKeep)c.slice(this._numStoriesToKeep).forEach(DOM.remove);var d=['tickerStoryActive','tickerStorySelected','tickerStoryFetching'];c.forEach(function(g){d.forEach(function(h){CSS.removeClass(g,h);});if(CSS.hasClass(g,'tickerSponsoredStory'))DOM.remove(g);});CSS.removeClass(a,'tickerChildSelected');var e=DOM.scry(a,'div.uiScrollableAreaTrack')[0];e&&Style.set(e,'opacity',0);var f=DOM.scry(a,'div.fbFeedTicker')[0];if(f){Style.set(f,'top','');CSS.removeClass(f,'fixed_elem');}},getControllerDataOnSnapshot:function(a){return {newest:a.getNewest(),customStories:[]};},insertStory:function(a){var b=HTML(a).getRootNode(),c=DOM.scry(b,'div.fbFeedTickerStory');for(var d=0;d<c.length;d++)if(this._controller.dedupeStory(c[d]))c[d].parentNode.removeChild(c[d]);this._controller.insertStory(b,true,c.length>3);},updateAfterload:function(a){a.update({cache_update:1});}});
__d("UIIntentionalStreamRefresh",["Arbiter","LiveTimer","Run","UIIntentionalStreamMessage","UserActivity","coalesce","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('LiveTimer'),i=b('Run'),j=b('UIIntentionalStreamMessage'),k=b('UserActivity'),l=b('coalesce'),m=b('copyProperties');function n(o,p){this.isAutoRefreshing=false;this.lastRefresh=Date.now();n.instance=this;this.setAutoRefreshConfig(o);this.updateConfigHandler=g.subscribe(j.UPDATE_AUTOREFRESH_CONFIG,this.updateAutoRefreshConfig.bind(this));this.updateRefreshTimeHandler=g.subscribe(j.UPDATE_LAST_REFRESH_TIME,this.updateLastRefreshTime.bind(this));i.onLeave(this.unload.bind(this));this.userActivity();this.uaToken=k.subscribe(this.userActivity.bind(this));this.autoRefreshInterval=setInterval(this.checkAutoPageRefresh.bind(this),this.checkAutoRefreshTimeInterval);this.activeRefreshInterval=setInterval(this.checkActiveRefresh.bind(this),this.checkActiveRefreshTimeInterval);this.enableAutoRefresh(p);g.subscribe(j.UPDATE_STREAM,h.loop.bind(h,true));g.subscribe(j.REFRESH_STREAM,h.loop.bind(h,true));}m(n,{DISABLE_AUTOREFRESH_TIME:4*60*1000,CHECK_AUTOREFRESH_INTERVAL:5*60*1000,AUTOREFRESH_INACTIVE_TIME:30*60*1000,CHECK_ACTIVE_REFRESH_TIME:5*60*1000,ACTIVE_REFRESH_TIME:30*1000});m(n.prototype,{updateAutoRefreshConfig:function(o,p){if(o==j.UPDATE_AUTOREFRESH_CONFIG)this.setAutoRefreshConfig(p);},updateLastRefreshTime:function(o){if(o==j.UPDATE_LAST_REFRESH_TIME)this.lastRefresh=Date.now();},setAutoRefreshConfig:function(o){o=o||{};var p=24*60*60*1000;if(!this.storyInterval)this.storyInterval=l(o.story_interval,null);this.allowAutoRefresh=l(o.allow_auto_refresh,false);this.inactiveThreshold=l(o.inactive_threshold,0);this.activeRefreshTime=l(o.fast_refresh_rate,p);this.inactiveRefreshTime=l(o.slow_refresh_rate,p);this.allowPolling=l(o.allow_polling,false);this.refreshFactor=l(o.refresh_factor,10);this.minRefreshInterval=l(o.min_refresh_interval,60*1000);this.activeRefresh=l(o.active_refresh,false);this.checkActiveRefreshTimeInterval=l(o.check_active_refresh_interval,n.CHECK_ACTIVE_REFRESH_TIME);this.activeRefreshTimeInterval=l(o.active_refresh_interval,n.ACTIVE_REFRESH_TIME);this.disableAutoRefreshTime=l(o.disable_autorefresh_time,n.DISABLE_AUTOREFRESH_TIME);this.checkAutoRefreshTimeInterval=l(o.check_autorefresh_time_interval,n.CHECK_AUTOREFRESH_INTERVAL);this.autoRefreshInactiveTime=l(o.autorefresh_inactive_time,n.AUTOREFRESH_INACTIVE_TIME);return this;},unload:function(){this.enableAutoRefresh(false);this.cleanupRefreshInterval();k.unsubscribe(this.uaToken);this.updateConfigHandler&&this.updateConfigHandler.unsubscribe();this.updateRefreshTimeHandler&&this.updateRefreshTimeHandler.unsubscribe();},userActivity:function(){var o=this.isInactive();this.lastActivity=Date.now();this.isAutoRefreshing=true;if(o&&this.canAutoRefresh())this.runAutoRefresh();return true;},isInactive:function(){return this.getMSSinceLastActivity()>this.inactiveThreshold;},getMSSinceLastActivity:function(){return Date.now()-this.lastActivity;},getMSSinceLastRefresh:function(){return Date.now()-this.lastRefresh;},getRefreshInterval:function(){if(this.isInactive()){return this.inactiveRefreshTime;}else if(this.storyInterval!=null){var o=this.storyInterval*this.refreshFactor;return Math.max(o,this.activeRefreshTime);}else return this.activeRefreshTime;},canAutoRefresh:function(){return this.isAutoRefreshing&&this.allowAutoRefresh;},cancelUpdate:function(){if(this.updateTask){clearTimeout(this.updateTask);this.updateTask=null;}},runUpdatePoll:function(){this.updateTask=null;if(this.canAutoRefresh())this.runAutoRefresh();},runAutoRefresh:function(){var o=50;if(this.getMSSinceLastRefresh()>=this.minRefreshInterval-o)g.inform(j.UPDATE_STREAM);this.schedulePoll(this.getRefreshInterval());},schedulePoll:function(o){this.cancelUpdate();if(this.allowPolling)this.updateTask=setTimeout(this.runUpdatePoll.bind(this),o);},enableAutoRefresh:function(o,p){this.isAutoRefreshing=o;if(o){var q=p?0:this.getRefreshInterval();this.schedulePoll(q);}else this.cancelUpdate();},checkAutoPageRefresh:function(){if(!this.allowAutoRefresh)return;if(this.isAutoRefreshing&&(this.getMSSinceLastActivity()>this.disableAutoRefreshTime))this.isAutoRefreshing=false;if(this.getMSSinceLastRefresh()<this.autoRefreshInactiveTime)return;var o=this.getMSSinceLastActivity();if(o>this.autoRefreshInactiveTime)g.inform(j.REFRESH_STREAM,{});},checkActiveRefresh:function(){if(!this.allowAutoRefresh)return;if(this.getMSSinceLastRefresh()<this.activeRefreshTimeInterval)return;if(this.getMSSinceLastActivity()<this.activeRefreshTimeInterval)g.inform(j.UPDATE_STREAM);},cleanupRefreshInterval:function(){if(this.autoRefreshInterval){clearInterval(this.autoRefreshInterval);this.autoRefreshInterval=null;}if(this.activeRefreshInterval){clearInterval(this.activeRefreshInterval);this.activeRefreshInterval=null;}}});e.exports=n;});
__d("UIIntentionalStream",["event-extensions","Animation","Arbiter","AsyncRequest","AsyncResponse","CSS","DataStore","DOM","DOMScroll","HTML","JSLogger","NavigationMessage","OnVisible","PageTransitions","Run","ScrollAwareDOM","Style","UIIntentionalStreamMessage","UIIntentionalStreamRefresh","UIPagelet","URI","Vector","$","clickRefAction","coalesce","copyProperties","createArrayFrom","ge","isEmpty","merge","reportData","startsWith","userAction"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Animation'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('AsyncResponse'),k=b('CSS'),l=b('DataStore'),m=b('DOM'),n=b('DOMScroll'),o=b('HTML'),p=b('JSLogger'),q=b('NavigationMessage'),r=b('OnVisible'),s=b('PageTransitions'),t=b('Run'),u=b('ScrollAwareDOM'),v=b('Style'),w=b('UIIntentionalStreamMessage'),x=b('UIIntentionalStreamRefresh'),y=b('UIPagelet'),z=b('URI'),aa=b('Vector'),ba=b('$'),ca=b('clickRefAction'),da=b('coalesce'),ea=b('copyProperties'),fa=b('createArrayFrom'),ga=b('ge'),ha=b('isEmpty'),ia=b('merge'),ja=b('reportData'),ka=b('startsWith'),la=b('userAction');function ma(){h.subscribe(w.SET_AUTO_INSERT,na);}function na(pa,qa){if(pa!=w.SET_AUTO_INSERT)return;var ra=oa.instance;if(ra)ra.pauseAutoInsert=qa.pause;}function oa(pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za){if(!pa)throw new Error('UIIntentionalStream instantiated with no root.');var ab={};this.initPageletCache(ab);ea(this,{id:pa.id,root:pa,instanceName:qa,newest:ab.newest||ra,oldest:sa,oldestMR:sa,shouldShowHidden:false,defaultFilter:ta,currentFilterKey:ya,sourceType:ua,lastSeenTime:za,hasPendingRefresh:false,pauseAutoInsert:false,error:m.scry(pa,'div.UIIntentionalStream_Error')[0],pager:m.scry(pa,'div.uiMorePager')[0],filterNullState:m.scry(pa,'div.friendListFilterNullState')[0],streamContent:m.find(pa,'.UIIntentionalStream_Content'),requestNum:0,scrollLoadCount:1,maxScrollLoadCount:1,scrollPosition:0,lastViewStateID:0,cachedScrollQID:0,jslog:p.create('stream'),scrollListener:null});this.addScrollTrace('init',{});t.onLeave(this.unload.bind(this));if(!oa.instances)oa.instances={};oa.instances[qa]=this;oa.instance=this;ma();this.setupSubscriptions();}ea(oa.prototype,{initPageletCache:function(pa){if(window.PageletCacheController){this._cache=window.PageletCacheController.registerController('pagelet_home_stream',this);if(this._cache){ea(pa,this._cache.loadData());this._cache.registerCleanup(w.UNLOAD);}}},subscribeToComposerPublish:function(){this.subscriptions.push(h.subscribe('composer/publish',function(event,pa){if(pa.streamStory)this.addComposerContent(pa.streamStory,500);}.bind(this)));},setupSubscriptions:function(){this.subscriptions=[];this.subscribeToComposerPublish();this.subscriptions.push(h.subscribe(w.UPDATE_STREAM,this.updateStream.bind(this)));this.subscriptions.push(h.subscribe(w.REFRESH_STREAM,this.refreshStream.bind(this)));this.scrollListener=Event.listen(window,'scroll',this.checkFirstScroll.bind(this));this.checkFirstScroll();t.onLoad(this.checkFirstStory.bind(this));},tearDownSubscriptions:function(){if(!this.subscriptions)return;this.subscriptions.forEach(h.unsubscribe);this.subscriptions=null;if(this.scrollListener){this.scrollListener.remove();this.scrollListener=null;}},unload:function(){this.addScrollTrace('unload',{});h.inform(w.UNLOAD);this.tearDownSubscriptions();oa.instance=null;oa.instances[this.instanceName]=null;this.clearScrollLoader(true);window.disableScrollLoad=null;x.instance&&x.instance.unload();},_getUpdateInsertType:function(){return oa.REFRESH_PREPEND;},updateStream:function(pa){if(pa!=w.UPDATE_STREAM||this.hasPendingRefresh||this.isAutoRefreshPaused())return;this.loadNewer({showLoader:false,ignoreSelf:true,insertType:this._getUpdateInsertType()});},clearScrollLoader:function(pa){if(this.currentScrollListener){this.currentScrollListener.remove();this.currentScrollListener=null;}if(pa||this.scrollLoadCount>=this.maxScrollLoadCount)window.disableScrollLoad=true;},loadOlderPosts:function(pa){var qa={filter:this.getCurrentFilterKey(),oldest:this.oldest,oldestMR:this.oldestMR,last_seen_time:this.lastSeenTime,scroll_count:this.scrollLoadCount,scroll_position:this.scrollPosition,last_viewstate_id:this.lastViewStateID,cached_scroll_qid:this.cachedScrollQID};qa=ia(qa,pa);this.loadWithParams(qa);},loadWithParams:function(pa){var qa=m.scry(this.root,'div.fbStreamPager.hasMorePosts')[0];if(qa){if(k.hasClass(qa,'async_saving'))return;k.addClass(qa,'async_saving');}this.addScrollTrace('loadwithparams',pa);y.loadFromEndpoint('MoreStoriesPagelet','home_stream',pa,{usePipe:true,append:true});},setScrollLoadCount:function(pa){this.maxScrollLoadCount=pa;},loadMoreOnScroll:function(pa,qa){if(window.disableScrollLoad)return;var ra=function(){if(window.disableScrollLoad)return;var ua=a.ArbiterMonitor;if(ua){ca('scroll',null,null,'FORCE',{gt:{ua_id:'stream:scroll:auto'}}).set_namespace('stream');var va=la('stream').uai('scroll','stream:scroll:auto');ua.initUA(va);}var wa={delay_load_count:qa};this.loadOlderPosts(wa);}.bind(this),sa=m.scry(this.root,'ul.uiStream li.genericStreamStory');if(!sa.length)return;this.addScrollTrace('loadmoreonscroll',{});var ta=sa[sa.length-pa-1];if(ta){this.currentScrollListener=new r(ta,ra,null,0);}else ra();},updateTimeRange:function(pa,qa){if(!this.newest||this.newest<pa){this.newest=pa;this.addScrollTrace('update_newest',{newest:this.newest});}if(!this.oldest||(qa&&(qa<this.oldest))){this.oldest=qa;this.addScrollTrace('update_oldest',{oldest:this.oldest});}},updateOldestMR:function(pa){if(!this.oldestMR||pa<this.oldestMR){this.oldestMR=pa;this.addScrollTrace('update_oldestmr',{oldestmr:this.oldestMR});}},updateScrollPosition:function(pa){this.scrollPosition=pa;this.addScrollTrace('update_scrollposition',{scrollposition:this.scrollPosition});},updateLastViewStateID:function(pa){this.lastViewStateID=pa;this.addScrollTrace('update_lastviewstateid',{lastviewstateid:this.lastViewStateID});},updateCachedScrollQID:function(pa){this.cachedScrollQID=pa;this.addScrollTrace('update_cachedscrollqid',{qid:this.cachedScrollQID});},getID:function(){return this.id;},getCurrentFilterKey:function(){if(this.currentFilterKey)return this.currentFilterKey;var pa=z.getMostRecentURI().getQueryData();if(pa&&pa.sk){this.currentFilterKey=pa.sk;}else if(pa&&pa.filter){this.currentFilterKey=pa.filter;}else if(this.defaultFilter)this.currentFilterKey=this.defaultFilter;return this.currentFilterKey;},resetFilterKey:function(pa){this.currentFilterKey=pa;},loadOlder:function(pa){pa=pa||{};if(!this.oldest)return;var qa=this.getCurrentParams();qa.oldest=this.oldest;this.refresh(oa.REFRESH_APPEND,qa,pa);return this;},loadNewer:function(pa){if(!this.newest)return;pa=pa||{};var qa=this.getCurrentParams();qa.newest=this.newest;if(pa.ignoreSelf)qa.ignore_self=true;qa.load_newer=true;var ra=da(pa.insertType,oa.REFRESH_PREPEND);this.refresh(ra,qa,pa);return this;},checkFirstStory:function(){this.logFirstStory('first_story_load');},checkFirstScroll:function(){if(this.scrollListener&&aa.getScrollPosition().y>0){this.scrollListener.remove();this.scrollListener=null;this.logFirstStory('first_scrolling');}},logFirstStory:function(pa){if(!ga('home_stream')||!ga('home_stream').childElementCount||!ga('home_stream').children[0].getAttribute('data-ft'))return;var qa=ga('home_stream').children[0].getAttribute('data-ft'),ra=JSON.parse(qa);if(!(("mf_story_key" in ra)&&("qid" in ra)))return;var sa={mf_story_key:ra.mf_story_key,qid:ra.qid};ja(pa,{ft:sa});},getCurrentParams:function(){var pa={},qa=z.getMostRecentURI().getQueryData();qa.filter=this.getCurrentFilterKey();var ra=this.getValidParams();if(ra){ra.forEach(function(sa){pa[sa]=qa[sa];});}else pa=qa;return pa;},setHomeFilter:function(pa){this._homeFilter=pa;},setHomeFilterLoading:function(pa){if(this._homeFilter)this._homeFilter.setLoading(pa);},refresh:function(pa,qa,ra){h.inform(w.UPDATE_LAST_REFRESH_TIME);this.addScrollTrace('refresh',{type:pa,data:qa,kwargs:ra});this.currentFilterKey=qa.filter;if(qa.filter==oa.FEED_FILTER_KEY_DUAL_NEWS_FEED){this.currentFilterKey=this.defaultFilter;}else if(oa.isHighlightsFilter(qa.filter)||qa.filter===oa.FEED_FILTER_KEY_NEWS_FEED)this.defaultFilter=this.currentFilterKey;ra=ra||{};var sa=++this.requestNum,ta=da(ra.showLoader,true),ua=this.instanceName,va=function(za){oa.getInstance(ua).handleResponse(sa,pa,za,ra);},wa=function(za){oa.getInstance(ua).handleError(sa,pa,za,ra);},xa=function(za){oa.getInstance(ua).handleFinally(pa,qa.filter,za);};if(!(qa.request_type=pa))qa.request_type='none';if(qa.filter){ra.show_hidden=qa.show_hidden?qa.show_hidden:false;}else ra.show_hidden=this.shouldShowHidden;qa=ea(this.getCurrentParams(),qa);this.hasPendingRefresh=true;var ya;if(pa==oa.REFRESH_APPEND&&ta)ya=this.pager;new i().setURI(this.getEndpoint()).setReadOnly(true).setOption('retries',0).setMethod(this.getRefreshMethod()).setData(qa).setHandler(va).setStatusElement(ya).setErrorHandler(wa).setFinallyHandler(xa).send();if(pa==oa.REFRESH_TRANSITION){if(this.pager)this.pager.style.display='none';this.clearScrollLoader();this.oldest=this.newest=null;}if(ta)this.setHomeFilterLoading(true);},addComposerContent:function(pa,qa){if(this.isOnNewsFeedFilter())k.addClass(pa,'uiStreamBoulderHighlight');this.addContentPrepend(pa,qa);},addContentPrepend:function(pa,qa){if(pa.length){fa(pa).reverse().forEach(function(wa){this.addContentPrepend(wa,qa);}.bind(this));return;}var ra,sa=aa.getScrollPosition().y,ta=aa.getElementPosition(this.streamContent).y,ua=this.scrollOnPrepend&&sa>=ta;if(ua){var va=function(wa){var xa=m.find(wa,'^li.uiStreamStory');if(!xa)return;l.set(xa,'origHeight',xa.offsetHeight);Event.listen(wa,'load',function(){var ya=l.get(xa,'origHeight');if(xa.offsetHeight!=ya){window.scrollBy(0,xa.offsetHeight-ya);l.set(xa,'origHeight',xa.offsetHeight);}});};ra=g.insert.curry(this.streamContent,pa,(function(wa,xa){m.prependContent(this.streamContent,xa);h.inform('reflow');window.scrollBy(0,xa.offsetHeight);m.scry(xa,'img').forEach(va);}).bind(this));}else ra=(function(){v.set(pa,'opacity',0);u.prependContent(this.streamContent,pa);h.inform('reflow');new g(pa).from('opacity',0).to('opacity',1).duration(400).ondone(function(){h.inform(w.UPDATE_HTML_CONTENT);}).go();}).bind(this);if(qa){k.hide(pa);m.appendContent(document.body,pa);setTimeout(function(){k.show(pa);ra();},qa);}else ra();},addContentAppend:function(pa){m.appendContent(this.streamContent,pa);},handleResponse:function(pa,qa,ra,sa){this.addScrollTrace('handle_response',{requestnum:pa,type:qa,kwargs:sa});sa=sa||{};var ta=ra.getPayload();this.filterNullState&&m.remove(this.filterNullState);if(ha(ta))return;if(ta.autoRefreshConfig)h.inform(w.UPDATE_AUTOREFRESH_CONFIG,ta.autoRefreshConfig);this.setHomeFilterLoading(false);if(qa==oa.REFRESH_EXPAND){var ua=m.find(ba(sa.expandStoryID),'div.UIIntentionalStory_CollapsedStories');k.hide(ua);k.removeClass(ua,'UIIntentionalStory_CollapsedStoriesLoading');}if(this.error)this.error.style.display='none';if(pa!=this.requestNum)return;if('show_hidden' in sa)this.shouldShowHidden=sa.show_hidden;if('newestStoryTime' in ta&&ta.newestStoryTime>this.newest)this.newest=ta.newestStoryTime;if(qa!=oa.REFRESH_PREPEND){if('oldestStoryTime' in ta&&(!this.oldest||ta.oldestStoryTime<this.oldest))this.oldest=ta.oldestStoryTime;if('scrollPosition' in ta)this.scrollPosition=ta.scrollPosition;if('lastViewStateID' in ta)this.lastViewStateID=ta.lastViewStateID;if('oldestMRStoryTime' in ta)this.oldestMR=ta.oldestMRStoryTime;if('cachedScrollQID' in ta){this.cachedScrollQID=ta.cachedScrollQID;}else this.cachedScrollQID=0;}if(ta.html){var va=o(ta.html).getNodes();switch(qa){case oa.REFRESH_PREPEND:this.addContentPrepend(va);break;case oa.REFRESH_APPEND:this.addContentAppend(va);this.clearScrollLoader(true);break;case oa.REFRESH_TRANSITION:m.setContent(this.streamContent,va);this.scrollLoadCount=1;if(!sa.noScroll)n.scrollTo(new aa(0,0,"document"),false);break;case oa.REFRESH_EXPAND:m.insertAfter(ba(sa.expandStoryID),va);break;case oa.DELAYED_STREAM:this.addContentAppend(va);break;}h.inform(w.UPDATE_HTML_CONTENT);}},handleError:function(pa,qa,ra,sa){if(pa!=this.requestNum)return;this.setHomeFilterLoading(false);var ta=ra.getError();if(ta==1357001)j.defaultErrorHandler(ra);if(qa==oa.REFRESH_EXPAND){var ua=m.find(ba(sa.expandStoryID),'div.UIIntentionalStory_CollapsedStories');k.removeClass(ua,'UIIntentionalStory_CollapsedStoriesLoading');}if(!sa.delayLoadCount&&qa!=oa.REFRESH_PREPEND&&this.error)v.set(this.error,'display','block');},handleFinally:function(pa,qa){if(pa==oa.REFRESH_TRANSITION){s.transitionComplete();h.inform(q.NAVIGATION_COMPLETED);}this.hasPendingRefresh=false;},getValidParams:function(){return oa.VALID_PARAMS;},getEndpoint:function(){return oa.ENDPOINT;},getRefreshMethod:function(){return oa.REFRESH_METHOD;},isOnNewHighlights:function(){var pa=this.getCurrentFilterKey();return (oa.isHighlightsFilter(pa)||(pa==oa.FEED_FILTER_KEY_DUAL_NEWS_FEED&&oa.isHighlightsFilter(this.defaultFilter)));},isLiveStreamBox:function(){var pa=this.getCurrentFilterKey();return pa&&pa.indexOf(oa.FEED_FILTER_KEY_LIVE_STREAM_BOX)===0;},isOnNewsFeedFilter:function(){var pa=this.getCurrentFilterKey();return (pa==oa.FEED_FILTER_KEY_NEWS_FEED||oa.isHighlightsFilter(pa)||pa==oa.FEED_FILTER_KEY_DUAL_NEWS_FEED);},isAutoRefreshPaused:function(){if(this.isOnNewHighlights()||this.isLiveStreamBox())return false;return this.pauseAutoInsert;},addScrollTrace:function(pa,qa){this.jslog.debug(pa,qa);},refreshStream:function(pa,qa){if(pa!=w.REFRESH_STREAM)return;var ra=this.getCurrentFilterKey(),sa={filter:ra},ta={filter:ra};qa.noScroll&&(ta.noScroll=1);this.refresh(oa.REFRESH_TRANSITION,sa,ta);},getNewest:function(){return this.newest;}});ea(oa,{ANIMATION_DURATION:300,REFRESH_METHOD:'GET',REFRESH_TRANSITION:1,REFRESH_PREPEND:2,REFRESH_APPEND:3,REFRESH_EXPAND:5,DELAYED_STREAM:6,FEED_FILTER_KEY_NEW_HIGHLIGHTS:'h',FEED_FILTER_KEY_NEWS_FEED:'lf',FEED_FILTER_KEY_DUAL_NEWS_FEED:'nf',FEED_FILTER_KEY_LIVE_STREAM_BOX:'pub',VALID_PARAMS:['filter','show_hidden'],ENDPOINT:'/ajax/intent.php',getInstance:function(pa){return oa.instances[pa];},isHighlightsFilter:function(pa){if(!pa)return false;return ka(pa,oa.FEED_FILTER_KEY_NEW_HIGHLIGHTS);},getStoriesByAssoc:function(pa){return m.scry(oa.instance.root,'div.aid_'+pa);}});e.exports=oa;});
__d("legacy:UIIntentionalStream",["UIIntentionalStream"],function(a,b,c,d){a.UIIntentionalStream=b('UIIntentionalStream');},3);
function HomeNavigationCache(a,b){this.parent.construct(this,a,b,['NavigationMessage.FAVORITES_UPDATED']);}Class.extend(HomeNavigationCache,'PageletCacheController');copyProperties(HomeNavigationCache.prototype,{handlePageletDOMOnSnapshot:function(a){var b=DOM.scry(a,'li.sideNavItem');if(b.length===0)return;for(var c=0;c<b.length;c++){var d=b[c];if(d.id=='navItem_app_4748854339'){CSS.addClass(d,'selectedItem');}else if(CSS.hasClass(d,'selectedItem')){CSS.removeClass(d,'selectedItem');CSS.removeClass(d,'open');}CSS.removeClass(d,'loading');}var e=DOM.scry(a,'.uiFutureSideNav')[0];if(e)CSS.addClass(e,'hideNavCounts');}});
var NewHigh={reset:function(){this.initialized=false;},ensureInitialized:function(){if(this.initialized)return;this.button=DOM.scry(document.body,'a.stream_header_button')[0];this.composer=DOM.scry(document.body,'div.UIComposer')[0];this.buttonArea=DOM.scry(this.composer,'div.UIComposer_ButtonArea')[0];this.initialized=true;},showComposer:function(a){this.ensureInitialized();if(this.composer){CSS.show(this.composer);UIComposer.focusInstance(this.composer.id);var b=UIComposer.getInstance(this.composer.id);b&&b.loadAttachment(parseInt(a,10));}this.button&&CSS.hide(this.button);},hideComposer:function(a){this.ensureInitialized();if(this.composer){var b=UIComposer.getInstance(this.composer.id);if(!a){b&&b.initialized&&b.blur();CSS.hide(this.composer);this.button&&CSS.show(this.button);}else{b&&b.initialized&&b.loadAttachment(0);CSS.show(this.composer);this.buttonArea&&CSS.hide(this.buttonArea);}}}};
function FutureHomeSideNav(){this.parent.construct(this);}Class.extend(FutureHomeSideNav,'FutureSideNav');copyProperties(FutureHomeSideNav.prototype,{init:function(){this.parent.init.apply(this,arguments);this.ajaxPipe=true;this.seeAllEndpoint="/ajax/home/generic.php";this.typeSections={favorites:'pinnedNav',profiles:'pinnedNav',apps:'appsNav',groups:'groupsNav',pages:'pagesNav',lists:'listsNav',interests:'interestsNav',connect_apps:'connectNav'};this.switchingFromTitanFixedFrame=false;this._arbiterSubscriptions.push(Arbiter.subscribe('titan_fixed_frame_changed',this.handleFixedFrameChanged.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_FAVORITE_UPDATE,this.updateFavorite.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_FIRST_RESPONSE,this.navigationFirstResponse.bind(this)));this._ensureHover('homeSideNav');this._initPageletCache();},_initPageletCache:function(a){if(window.PageletCacheController){this._cache=PageletCacheController.registerController('pagelet_navigation',this);if(this._cache){this._cache.registerCleanup('HomeNav/cleanup');onleaveRegister(function(){Arbiter.inform('HomeNav/cleanup');});}}},initMoreLink:function(a){this._eventHandlers.push(Event.listen(a,'click',this._showMoreSections.bind(this,a)));},_showMoreSections:function(a){var b=DOM.scry(this.root,'div.belowThreshold');CSS.hide(a);b.forEach(function(c){CSS.removeClass(c,'belowThreshold');});},handleFixedFrameChanged:function(a,b,c){if(b){var d=function(e,f){var g=DOMPosition.getElementPosition(ge(f)).y;UIPagelet.loadFromEndpoint(e,f,{fixed_frame:b,selected_key:c,v_pos:g});};d('PinnedNavigationPagelet','pagelet_pinned_nav');d('BookmarkNavigationPagelet','pagelet_bookmark_nav');if(ge('chatFriendsOnline'))CSS.hide(ge('chatFriendsOnline'));}else this.switchingFromTitanFixedFrame=true;},handlePageTransition:function(a){if(this.switchingFromTitanFixedFrame){this.switchingFromTitanFixedFrame=false;return false;}else return this.parent.handlePageTransition(a);},_initSection:function(a){var b=this.parent._initSection(a);for(var c in this.typeSections){var d=this.typeSections[c];if(b.id==d){var e=DOM.scry(b.node,'h4.navHeader')[0];if(e){var f='\/bookmarks\/('+c+')(\/)?';b.seeall=this._initItem({node:e,id:b.id,endpoint:this.seeAllEndpoint,key:['bookmarks'],path:[{regex:f}]});}}}return b;},_constructItem:function(a,b){return new FutureHomeSideNavItem(a,b);},_constructSection:function(a){return new FutureHomeSideNavSection(a);},getSection:function(a){return this.typeSections[a]&&this.sections[this.typeSections[a]];},_getItemForKey:function(a){var b=this.parent._getItemForKey("nf");if(b&&b.matchKey(a)){return b;}else return this.parent._getItemForKey(a);},_isCurrentPath:function(a){return ((a.getDomain()===this.uri.getDomain())&&(a.getPath()==='/'||a.getPath()==='/home.php'));},_handleMenuClick:function(a,b,c,event){if(CSS.hasClass(c,'favorite')){Arbiter.inform(NavigationMessage.NAVIGATION_FAVORITE_UPDATE,{key:b.numericKey,favorite:!a.equals(this.getSection("favorites")),movetop:CSS.hasClass(c,'movetop')});}else this.parent._handleMenuClick(a,b,c,event);},removeItemByKey:function(a){Arbiter.inform(NavigationMessage.NAVIGATION_ITEM_REMOVED,a);this.parent.removeItemByKey(a);},toggleItemByKey:function(a,b){var c=this.getNodeForKey(a);if(!b){Arbiter.inform(NavigationMessage.NAVIGATION_ITEM_HIDDEN,a);c&&CSS.hide(c);}else c&&CSS.show(c);var d=this._getItemForKey(a);this.getSection(d.type).refresh();},removeItem:function(a){var b=this.getSection(a.type);this.parent.removeItem(a);b.refresh();},updateFavorite:function(a,b){var c=this._findItem(function(l){return l.matchKey(b.key)&&l.canFavorite();}),d=this.getSection("favorites"),e=emptyFunction,f=b.favorite?d.addEndpoint:d.removeEndpoint;if(b.movetop)f=d.editEndpoint;if(!c&&(b.favorite||b.movetop)){if(b.movetop)var g=DOM.scry(this.root,'.expandableSideNav'),h=g&&g.length&&CSS.hasClass(g[0],'expandedMode');e=function(){UIPagelet.loadFromEndpoint('PinnedNavigationPagelet','pagelet_pinned_nav',{expanded:h});};}else if(!c){e=function(){UIPagelet.loadFromEndpoint('BookmarkNavigationPagelet','pagelet_bookmark_nav');};}else{if(b.movetop){CSS.show(c.node);this.moveItem(d,c);var i=Parent.byClass(c.node,'uiSideNav');if(i&&i.childNodes.length){var j=Parent.byClass(DOM.scry(i,'.sortableItem')[0],'sideNavItem');DOM.insertBefore(j,c.node);CSS.removeClass(c.node,'hidden');}}else{var k=this.getSection(c.type);if(b.favorite){CSS.show(c.node);this.moveItem(d,c);c.showFavorite();}else if(!k.equals(d)){this.moveItem(k,c,true);c.hideFavorite();}else this.removeItem(c);k.refresh();}d.refresh();b.key=c.numericKey;Arbiter.inform('NavigationMessage.FAVORITES_UPDATED');}new AsyncRequest().setURI(f).setData({id:b.key,movetop:b.movetop}).setHandler(e).send();},_doPageTransition:function(a,b){this._unloadStreams();var c=this.parent._doPageTransition(a,b);if(c&&(a.type=='groups'||a.type=='lists'||a.type=='interests')){a.setCount(0);a.hideUnreadDot();}return c;},_unloadStreams:function(){var a=window.UIIntentionalStream&&UIIntentionalStream.instances,b=['nile','global','friends','blade'];a&&b.forEach(function(c){a[c]&&a[c].unload();});},navigationFirstResponse:function(){this.setSelected(this.loading);}});function FutureHomeSideNavSection(a){this.parent.construct(this,a);this.editEndpoint='/ajax/bookmark/edit/';this.addEndpoint='/ajax/bookmark/add/';this.removeEndpoint='/ajax/bookmark/delete/';}Class.extend(FutureHomeSideNavSection,'FutureSideNavSection');copyProperties(FutureHomeSideNavSection.prototype,{refresh:function(){var a=DOM.scry(this.node,'li.sideNavItem'),b=DOM.scry(this.node,'div.actionLinks'),c=a.some(CSS.shown);CSS.conditionShow(DOM.find(this.node,'h4.navHeader'),c);b.length&&CSS.conditionShow(b[0],c);}});function FutureHomeSideNavItem(a,b){this.parent.construct(this,a,b);}Class.extend(FutureHomeSideNavItem,'FutureSideNavItem');copyProperties(FutureHomeSideNavItem.prototype,{canFavorite:function(){return !!this._getFavoriteLabel();},showFavorite:function(){DOM.setContent(this._getFavoriteLabel(),"Remove from Favorites");},hideFavorite:function(){DOM.setContent(this._getFavoriteLabel(),"Add to Favorites");},hideUnreadDot:function(){var a=DOM.scry(this.node,'img.unreadDot')[0];a&&CSS.hide(a);},_getFavoriteLabel:function(){return DOM.scry(this.node,'li.favorite span.itemLabel')[0];}});
__d("FeedTrackingAsync",["event-extensions","collectDataAttributes","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('collectDataAttributes'),h=b('copyProperties');function i(j){Event.listen(j,'AsyncRequest/send',function(event){var k=event.getTarget(),l=event.getData().request,m=l.getData(),n=g(k,['ft']);h(m,n);});}e.exports={init:i};});
function StreamPageletCacheController(a,b){this.parent.construct(this,a,b,[]);}Class.extend(StreamPageletCacheController,'PageletCacheController');copyProperties(StreamPageletCacheController.prototype,{getControllerDataOnSnapshot:function(a){return {newest:a.getNewest()};},updateAfterload:function(a){a.loadNewer();}});
__d("ContextualLayerAsyncRelative",["event-extensions","copyProperties","Parent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('copyProperties'),h=b('Parent');function i(j){this._layer=j;}g(i.prototype,{_layerSubscription:null,_listener:null,enable:function(){this._layerSubscription=this._layer.subscribe('show',this._attachListener.bind(this));if(this._layer.isShown())this._attachListener();},disable:function(){this._layerSubscription.unsubscribe();this._layerSubscription=null;if(this._listener){this._listener.remove();this._listener=null;}},_attachListener:function(){this._listener=Event.listen(this._layer.getRoot(),'click',this._onclick.bind(this));},_onclick:function(j){var k=h.byTag(j.getTarget(),'A');if(!k)return;var l=k.getAttribute('ajaxify'),m=k.href,n=l||m;if(k.rel==='async'||k.rel==='async-post'){d(['AsyncRequest'],function(o){o.bootstrap(n,this._layer.getContext(),k.rel==='async-post');}.bind(this));return false;}}});e.exports=i;});
__d("legacy:UIIntentionalStreamRefresh",["UIIntentionalStreamRefresh"],function(a,b,c,d){a.UIIntentionalStreamRefresh=b('UIIntentionalStreamRefresh');},3);